{
	"person": {
		"name": "Charlie Chrisman",
		"githubUsername": "cachrisman",
		"imageURL": "https://avatars.githubusercontent.com/u/6521666?v=4",
		"bio": "Solution Engineer @contentful",
		"primary": true
	},
	"plugins": [
		{
			"files": [
				{
					"path": "Web/nightscout.30s.js",
					"filename": "nightscout.30s.js",
					"content": "#!/usr/bin/env /usr/local/bin/node\n/* jshint esversion: 6 */\n\n/*\n\u003cbitbar.title\u003eBitBar Nightscout Plugin\u003c/bitbar.title\u003e\n\u003cbitbar.version\u003e1.0\u003c/bitbar.version\u003e\n\u003cbitbar.author\u003eCharlie Chrisman\u003c/bitbar.author\u003e\n\u003cbitbar.author.github\u003ecachrisman\u003c/bitbar.author.github\u003e\n\u003cbitbar.desc\u003eGets the most recent reading and trend arrow from nightscout\u003c/bitbar.desc\u003e\n\u003cbitbar.image\u003ehttps://raw.githubusercontent.com/cachrisman/bitbar-nightscout/master/screenshot.png\u003c/bitbar.image\u003e\n\u003cbitbar.dependencies\u003enode, npm, npm/fs, npm/got\u003c/bitbar.dependencies\u003e\n\u003cbitbar.abouturl\u003ehttps://github.com/cachrisman/bitbar-nightscout\u003c/bitbar.abouturl\u003e\n*/\n\n// user settings\nconst HOSTNAME = 'your_nightscout_site.herokuapp.com';\nconst TOKEN = 'your_nightscout_api_token_with_read_access';\nconst BG_HIGH_LEVEL = 180;\nconst BG_LOW_LEVEL = 70;\n\n// don't edit code below!\n\nconst fs = require('fs');\nconst got = require('got');\n\nconst requestUrl = `https://${HOSTNAME}/api/v1/entries.json?count=1\u0026TOKEN=${TOKEN}`;\nconst ver = '1.0';\n\nconst symbols = {\n  'NONE': '?',\n  'DoubleUp': '⇈',\n  'SingleUp': '↑',\n  'FortyFiveUp': '↗',\n  'Flat': '→',\n  'FortyFiveDown': '↘',\n  'SingleDown': '↓',\n  'DoubleDown': '⇊',\n  'NOT COMPUTABLE': '??',\n  'RATE OUT OF RANGE': '⇕'\n};\n\nconst data_dir = __dirname + '/nightscout/';\nif (!fs.existsSync(data_dir)) fs.mkdirSync(data_dir);\nconst last_reading_file = data_dir + 'last_reading';\n\nfunction getLastReading() {\n  let last_reading;\n  try {\n    last_reading = JSON.parse(fs.readFileSync(last_reading_file, 'utf8'))[0];\n  } catch (e) {\n    logger('error.log', JSON.stringify(e));\n    last_reading = {_id:''};\n  }\n  return last_reading;\n}\n\nfunction logger(file, data) {\n  if (fs.existsSync(data_dir + file)) \n    fs.appendFileSync(data_dir + file, data + '\\n');\n  else \n    fs.writeFileSync(data_dir + file, data + '\\n');\n}\n\nfunction writeOutput(data) {\n  let glucose = parseInt(data.sgv);\n  let date = new Date(data.date);\n  let trend = data.trend;\n  let direction = data.direction;\n\n  let top_line = `BG: ${glucose} ${symbols[direction]}`;\n\n  if (glucose \u003e BG_HIGH_LEVEL)\n    top_line += ' | color=yellow';\n  else if (glucose \u003c BG_LOW_LEVEL)\n    top_line += ' | color=red';\n\n  console.log(`${top_line}\n---\nLast Reading: ${date.toLocaleString()}\nBlood Glucose: ${glucose}\nTrend: ${trend}\nDirection: ${direction} ${symbols[direction]}\n---\nRefresh | refresh=true terminal=false\n---\nBitBar Nightscout Plugin v${ver}\n--by Charlie Chrisman | href=http://www.charliechrisman.com\n-----\n--GitHub Page | href=https://github.com/cachrisman/bitbar-nightscout\n--Changelog | href=https://github.com/cachrisman/bitbar-nightscout/blob/master/CHANGELOG.md`);\n}\n\ngot(requestUrl).then(response =\u003e {\n  let last_reading = getLastReading();\n  let data = JSON.parse(response.body)[0];\n  if (data._id !== last_reading._id) {\n    logger('readings.log', response.body);\n    fs.writeFileSync(last_reading_file, response.body);\n  }\n  writeOutput(data);\n}).catch(err =\u003e {\n  writeOutput(last_reading);\n  logger('error.log', `${new Date()} - ${JSON.stringify(err)}`);\n});\n"
				}
			],
			"path": "Web/nightscout.30s.js",
			"filename": "nightscout.30s.js",
			"dir": "Web",
			"docsPlugin": "Web/nightscout.30s.js.html",
			"docsCategory": "Web.html",
			"pathSegments": [
				"Web"
			],
			"categoryPathSegments": [
				{
					"path": "Web",
					"text": "Web",
					"isLast": true
				}
			],
			"title": "BitBar Nightscout Plugin",
			"version": "1.0",
			"author": "Charlie Chrisman",
			"authors": [
				{
					"name": "Charlie Chrisman",
					"githubUsername": "cachrisman",
					"imageURL": "https://avatars.githubusercontent.com/u/6521666?v=4",
					"bio": "Solution Engineer @contentful",
					"primary": true
				}
			],
			"desc": "Gets the most recent reading and trend arrow from nightscout",
			"imageURL": "https://raw.githubusercontent.com/cachrisman/bitbar-nightscout/master/screenshot.png",
			"dependencies": [
				"node",
				"npm",
				"npm/fs",
				"npm/got"
			],
			"aboutURL": "https://github.com/cachrisman/bitbar-nightscout",
			"lastUpdated": "2021-03-08T15:22:10.07372Z",
			"vars": null
		}
	]
}