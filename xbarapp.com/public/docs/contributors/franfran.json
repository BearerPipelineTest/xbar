{
	"person": {
		"name": "Francis Mak",
		"githubUsername": "franfran",
		"imageURL": "https://avatars.githubusercontent.com/u/1584365?v=4",
		"bio": "",
		"primary": true
	},
	"plugins": [
		{
			"files": [
				{
					"path": "AWS/ec2-start-stop.1h.sh",
					"filename": "ec2-start-stop.1h.sh",
					"content": "#!/bin/sh\n\n# \u003cbitbar.title\u003eAmazon EC2 Instance Start/Stop\u003c/bitbar.title\u003e\n# \u003cbitbar.version\u003ev1.0\u003c/bitbar.version\u003e\n# \u003cbitbar.author\u003eFrancis Mak\u003c/bitbar.author\u003e\n# \u003cbitbar.author.github\u003efranfran\u003c/bitbar.author.github\u003e\n# \u003cbitbar.desc\u003eLet you start/stop Amazon EC2 instances\u003c/bitbar.desc\u003e\n# \u003cbitbar.dependencies\u003eawscli,jq\u003c/bitbar.dependencies\u003e\n\n# Dependencies:\n# awscli (https://aws.amazon.com/cli/)\n# jq (https://stedolan.github.io/jq/)\n\n# Installation:\n# 1. Copy this script to your BitBar plugin folder\n# 2. Ensure the plugin file is executable by running chmod +x ec2-start-stop.1h.sh\n# 3. Change your AWS profile in the AWS_CLI_PROFILE variable below\n# Notes: Optionally, to display the instace name in bitbar, use the key \"Name\" in AWS EC2 Tags\nAWS_CLI_PROFILE=\"default\"\n\nexport PATH=\"$PATH:/usr/local/bin\"\n\nCMD_AWS=$(command -v aws)\nCMD_JQ=$(command -v jq)\nDISABLED_ITEM_COLOR=\"#C0C0C0\"\nARG1_INSTANCE_ID=\"$1\"\nARG2_NAME=\"$2\"\nARG3_ACTION=\"$3\"\nSTATUS_STOPPED=\"üçé\"\nSTATUS_STARTED=\"üçè\"\n\n# function print_instance()\n# print out menu for each instance\n# parameters:\n#   $1, instance details in format:\n#   \"\u003cinstance_id\u003e__--SEP--__\u003cinstance_tag_name\u003e__--SEP--__\u003cinstance_status\u003e\"\nprint_instance(){\n  instance_id=$(echo \"$1\" | awk -F \"__--SEP--__\" '{print $1}')\n  instance_tag_name=$(echo \"$1\" | awk -F \"__--SEP--__\" '{print $2}')\n  instance_status=$(echo \"$1\" | awk -F \"__--SEP--__\" '{print $3}')\n  \n  if [ \"$instance_status\" = \"running\" ]; then\n    echo \"$STATUS_STARTED $instance_tag_name\"\n  else\n    echo \"$STATUS_STOPPED $instance_tag_name\"\n  fi\n  echo \"----\"\n  echo \"--status: $instance_status\"\n  if [ \"$instance_status\" = \"running\" ]; then\n    echo \"--start | color=$DISABLED_ITEM_COLOR\"\n    echo \"--stop | bash='$0' param1=$instance_id param2=$instance_tag_name param3=stop-instances refresh=false terminal=false\"\n  elif [ \"$instance_status\" = \"stopped\" ]; then\n    echo \"--start | bash='$0' param1=$instance_id param2=$instance_tag_name param3=start-instances refresh=false terminal=false\"\n    echo \"--stop | color=$DISABLED_ITEM_COLOR\"\n  fi\n}\n\nmain() {\n  json=$( $CMD_AWS --profile $AWS_CLI_PROFILE ec2 describe-instances --output json )\n  #shellcheck disable=SC2016\n  instances=$( echo \"$json\" | $CMD_JQ -r 'def count(s): reduce s as $_ (0;.+1);.Reservations | .[] | .Instances | .[] | .InstanceId as $i | $i +\"__--SEP--__\" + (if count (.Tags[]? | select(.Key==\"Name\")) == 0 then $i else (.Tags[] | select(.Key==\"Name\")|.Value) end) +\"__--SEP--__\" + .State.Name' )\n  #if no Name tag found, it will use instance id instead\n\n  for row in $instances; do\n    print_instance \"$row\"\n  done\n\n  if [ \"$ARG3_ACTION\" ]; then\n    CMD_NOTIFY=$(command -v osascript)\n    if [ \"$CMD_NOTIFY\" ]; then\n      osascript -e \"display notification \\\"$ARG2_NAME $ARG3_ACTION\\\" \"\n    fi\n    $CMD_AWS --profile $AWS_CLI_PROFILE ec2 \"$ARG3_ACTION\" --instance-ids \"$ARG1_INSTANCE_ID\"\n  fi\n}\n\necho \"EC2 Instances\"\necho \"---\"\n\nif [ \"$CMD_AWS\" ] \u0026\u0026 [ \"$CMD_JQ\" ]; then\n  main\nelse\n  echo \"aws/jq command not found\"\nfi\necho \"Refresh status | refresh=true\""
				}
			],
			"path": "AWS/ec2-start-stop.1h.sh",
			"filename": "ec2-start-stop.1h.sh",
			"dir": "AWS",
			"docsPlugin": "AWS/ec2-start-stop.1h.sh.html",
			"docsCategory": "AWS.html",
			"pathSegments": [
				"AWS"
			],
			"categoryPathSegments": [
				{
					"path": "AWS",
					"text": "AWS",
					"isLast": true
				}
			],
			"title": "Amazon EC2 Instance Start/Stop",
			"version": "v1.0",
			"author": "Francis Mak",
			"authors": [
				{
					"name": "Francis Mak",
					"githubUsername": "franfran",
					"imageURL": "https://avatars.githubusercontent.com/u/1584365?v=4",
					"bio": "",
					"primary": true
				}
			],
			"desc": "Let you start/stop Amazon EC2 instances",
			"imageURL": "https://xbarapp.com/public/img/xbar-2048.png",
			"dependencies": [
				"awscli",
				"jq"
			],
			"aboutURL": "",
			"lastUpdated": "2021-03-08T15:21:44.371515Z",
			"vars": null
		}
	]
}