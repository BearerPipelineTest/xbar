
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>GitLab Projects in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='List of your last active GitLab projects. Now supports API v4 - install xbar for free to get started.'>
	<meta name='author' content='Shelton Koskie'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='http://i.imgur.com/4X40XIK.png'>
	<meta itemprop='name' content='GitLab Projects in your macOS menu bar'>
	<meta itemprop='description' content='List of your last active GitLab projects. Now supports API v4 - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='GitLab Projects in your macOS menu bar'>
	<meta name='twitter:description' content='List of your last active GitLab projects. Now supports API v4 - install xbar for free to get started.'>
	<meta name='twitter:image' content='http://i.imgur.com/4X40XIK.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='GitLab Projects in your macOS menu bar'>
	<meta property='og:description' content='List of your last active GitLab projects. Now supports API v4 - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Dev/Gitlab/gitlab_projects.js.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='http://i.imgur.com/4X40XIK.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='http://i.imgur.com/4X40XIK.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='http://i.imgur.com/4X40XIK.png'>
	<link rel='shortcut icon' href='http://i.imgur.com/4X40XIK.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>💜</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>GitLab Projects</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/eightygrit.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/50476396?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/eightygrit.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Eighty Grit (<code style='color:white;'>@eightygrit</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						List of your last active GitLab projects. Now supports API v4
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Dev%2fGitlab%2fgitlab_projects.js'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>🖥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='http://i.imgur.com/4X40XIK.png' 
				alt='Image preview of GitLab Projects plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>gitlab_projects.js</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Dev/Gitlab/gitlab_projects.js'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Dev/Gitlab/gitlab_projects.js'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env /usr/local/bin/node
// jshint asi:true
// &lt;bitbar.title&gt;GitLab Projects&lt;/bitbar.title&gt;
// &lt;bitbar.version&gt;v2.0&lt;/bitbar.version&gt;
// &lt;bitbar.author&gt;Shelton Koskie&lt;/bitbar.author&gt;
// &lt;bitbar.author.github&gt;eightygrit&lt;/bitbar.author.github&gt;
// &lt;bitbar.desc&gt;List of your last active GitLab projects. Now supports API v4&lt;/bitbar.desc&gt;
// &lt;bitbar.dependencies&gt;node.js&lt;/bitbar.dependencies&gt;
// &lt;bitbar.image&gt;http://i.imgur.com/4X40XIK.png&lt;/bitbar.image&gt;

/**
 * Information
 *
 * This was inspired by the work of Sylvain Baronnet (@sylvainbaronnet), who made the
 * first version of the &#34;GITLAB Projects&#34; for API v3. What started as a couple of edits
 * became a total rewrite.
 *
 * @see   GitLab API Documentation    https://docs.gitlab.com/ee/api/README.html
 * @see   Create GitLab Access Token  https://gitlab.com/profile/personal_access_tokens
 * @see   BitBar Node Module Docs     https://github.com/sindresorhus/bitbar
 */



/**
 * The domain your instance is hosted on. Leave the default if using gitlab.com
 *
 * @var       {string}
 */
var gitlab_domain = &#39;gitlab.com&#39;;

/**
 * Your private access token.
 *
 * @var       {string}
 * @see       Create a token  https://gitlab.com/profile/personal_access_tokens
 */
var private_token = &#39;&#39;;

/**
 * When you select a project, which sub-page should it take you to?
 *
 * @var  {string}
 *
 * Options include:
 * - /issues
 * - /activity
 * - /commits
 */
var default_page  = &#39;/issues&#39;;

/**
 * How would you like results ordered?
 *
 * @var  {string}
 *
 * Options include:
 * - last_activity_at
 * - id
 * - name
 * - path
 * - created_at
 * - updated_at
 */
var order_by      = &#39;last_activity_at&#39;;

/**
 * Total number of results you want returned
 *
 * @var       {string}
 */
var result_count  = &#39;30&#39;;

/**
 * Font size of the project list
 *
 * @var       {string}
 */
var font_size     = &#39;15&#39;;

/////////////////////////////////////////////////////////////////////////
// Do not edit below this line unless you know what you&#39;re doing. :)  //
///////////////////////////////////////////////////////////////////////
var bitbar;

// Verify bitbar node module is available or try to install it globally.
try { bitbar = require(&#39;bitbar&#39;); }
catch(e) {

  try { bitbar = globalRequire(&#39;bitbar&#39;); }
  catch(e) {

    installBitbarModule();

    // Not catching error if one is thrown.
    bitbar = globalRequire(&#39;bitbar&#39;);
  }
}

/**
 * Performs the GET request for a projects list for authenticated user
 *
 * @param   {Function}  callback  The function to call to handle the response
 *
 * @return  {void}                Does not return anything
 */
(function(callback) {
    &#39;use strict&#39;;

    const httpTransport = require(&#39;https&#39;);
    const responseEncoding = &#39;utf8&#39;;
    const httpOptions = {
        hostname: gitlab_domain,
        port: &#39;443&#39;,
        path: &#39;/api/v4/projects?order_by=&#39; &#43; order_by &#43; &#39;&amp;sort=desc&amp;archived=false&amp;per_page=&#39; &#43; result_count &#43; &#39;&amp;owned=true&#39;,
        method: &#39;GET&#39;,
        headers: {&#34;PRIVATE-TOKEN&#34;:private_token}
    };
    httpOptions.headers[&#39;User-Agent&#39;] = &#39;bitbar/gitlab_projects - node &#39; &#43; process.version;

    const request = httpTransport.request(httpOptions, (res) =&gt; {
        let responseBufs = [];
        let responseStr = &#39;&#39;;

        res.on(&#39;data&#39;, (chunk) =&gt; {
            if (Buffer.isBuffer(chunk)) {
                responseBufs.push(chunk);
            }
            else {
                responseStr = responseStr &#43; chunk;
            }
        }).on(&#39;end&#39;, () =&gt; {
            responseStr = responseBufs.length &gt; 0 ?
                Buffer.concat(responseBufs).toString(responseEncoding) : responseStr;

            callback(null, res.statusCode, res.headers, responseStr);
        });

    })
    .setTimeout(0)
    .on(&#39;error&#39;, (error) =&gt; {
        callback(error);
    });
    request.write(&#34;&#34;)
    request.end();


})((error, statusCode, headers, body) =&gt; {
    // console.log(&#39;ERROR:&#39;, error);
    // console.log(&#39;STATUS:&#39;, statusCode);
    // console.log(&#39;HEADERS:&#39;, JSON.stringify(headers));

    const bitbar = globalRequire(&#39;bitbar&#39;);
    var content = [];

    content.push({
      text: &#39;GitLab&#39;,
      color: bitbar.darkMode ? &#39;white&#39; : &#39;black&#39;,
      dropdown: true
    });

    content.push(bitbar.separator);

    var projects = JSON.parse(body);

    for(var p in projects) {

      var project = projects[p];
      var ta = timeago();
      var last_activity = ta.ago(project.last_activity_at);

      content.push({
        text: project.name &#43; &#39; ⤏ &#39; &#43; &#39;Last activity: &#39; &#43; last_activity &#43; &#39; | href=&#34;&#39; &#43; project.web_url &#43; &#39;/activity&#39; &#43; &#39;&#34; size=&#39; &#43; font_size
      });

      content.push({
        text: project.name &#43; &#39; ⤏ &#39; &#43; project.open_issues_count &#43; &#39; issue&#39; &#43; (project.open_issues_count &gt; 1 ? &#39;s&#39; : &#39;&#39;) &#43; &#39; | alternate=true href=&#34;&#39; &#43; project.web_url &#43; &#39;/issues&#34; size=&#39; &#43; font_size
      });

      // Uncomment if you want a separator after each project.
      //content.push(bitbar.separator);
    }

    // Execute the dispaly.
    bitbar(content);


});

/* Source : https://github.com/digplan/time-ago */
function timeago() {

  var o = {
    second: 1000,
    minute: 60 * 1000,
    hour: 60 * 1000 * 60,
    day: 24 * 60 * 1000 * 60,
    week: 7 * 24 * 60 * 1000 * 60,
    month: 30 * 24 * 60 * 1000 * 60,
    year: 365 * 24 * 60 * 1000 * 60
  };
  var obj = {};

  obj.ago = function(nd) {
    var r = Math.round,
      pl = function(v, n) {
        return n &#43; &#39; &#39; &#43; v &#43; (n &gt; 1 ? &#39;s&#39; : &#39;&#39;) &#43; &#39; ago&#39;
      },
      ts = new Date().getTime() - new Date(nd).getTime(),
      ii;
      if(ts &lt; 0) {
        return &#39;Just now&#39;;
      }

    for (var i in o) {
      if (r(ts) &lt; o[i]) return pl(ii || &#39;m&#39;, r(ts / (o[ii] || 1)))
      ii = i;
    }
    return pl(i, r(ts / o[i]));
  }
  return obj;
}

/**
 * Sets up the ability to require global node packages.
 *
 * @return     {object}  Returns the required node package object
 */
function globalRequire(package){
  var childProcess = require(&#39;child_process&#39;);
  var path = require(&#39;path&#39;);
  var fs = require(&#39;fs&#39;);
  var env = Object.assign({}, process.env);
  env.PATH = path.resolve(&#34;/usr/local/bin&#34;) &#43; &#39;:&#39; &#43; env.PATH;


  var globalNodeModulesDir = childProcess.execSync(npmBin() &#43; &#39; root -g&#39;, {env: env}).toString().trim() &#43; &#39;/&#39;;
  var packageDir = path.join(globalNodeModulesDir, package, &#39;/&#39;);

  //find package required by older versions of npm
  if (!fs.existsSync(packageDir)){
    packageDir = path.join(globalNodeModulesDir, &#39;npm/node_modules/&#39;, package);
  }

  // Package not found
  if (!fs.existsSync(packageDir)){
    throw new Error(&#39;Cannot find global module \&#39;&#39; &#43; package &#43; &#39;\&#39;&#39;);
  }

  var packageMeta = JSON.parse(fs.readFileSync(path.join(packageDir, &#39;package.json&#39;)).toString());
  var main = path.join(packageDir, packageMeta.files[0]);

  return require(main);
}

/**
 * Installs Bitbar node module if it doesn&#39;t exits.
 *
 * @see    BitBar node module on github    https://github.com/sindresorhus/bitbar
 */
function installBitbarModule() {

    // Allows one to run the npm command as if on the command line.
    var childProcess = require(&#39;child_process&#39;);
    var execSync = childProcess.execSync;
    var path = require(&#39;path&#39;);
    var fs = require(&#39;fs&#39;);

    var env = Object.assign({}, process.env);
    env.PATH = path.resolve(&#34;/usr/local/bin&#34;) &#43; &#39;:&#39; &#43; env.PATH;

    // Get the path to npm bin
    var npm = npmBin();

    // The install command
    var cmd = npm &#43; &#39; install -g bitbar&#39;;

    console.log(&#34;Installing the BitBar Node module...&#34;);

    var output = execSync(cmd, {
        cwd: process.cwd(),
        env: env
    }).toString(&#39;utf8&#39;).trim();

    console.log(&#34;Installation complete.&#34;);

}

/**
 * Gets the path to your npm executable.
 *
 * @return  {string}  The full path to your npm executable
 */
function npmBin(){
  var path = require(&#39;path&#39;);
  var childProcess = require(&#39;child_process&#39;);
  var execSync = childProcess.execSync;
  var env = Object.assign({}, process.env);
  env.PATH = path.resolve(&#34;/usr/local/bin&#34;) &#43; &#39;:&#39; &#43; env.PATH;
  var buffs = [];

  // Get the path to npm bin
  return execSync(&#39;which npm&#39;, {env: env}).toString(&#39;utf8&#39;).trim();
}</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						•
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors • <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
