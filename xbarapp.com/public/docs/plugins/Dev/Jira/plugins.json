{
	"plugins": [
		{
			"files": [
				{
					"path": "Dev/Jira/jira-issues.10m.py",
					"filename": "jira-issues.10m.py",
					"content": "#!/usr/local/bin/python3\n\n# \u003cbitbar.title\u003eJira issues\u003c/bitbar.title\u003e\n# \u003cbitbar.version\u003ev1.0\u003c/bitbar.version\u003e\n# \u003cbitbar.author\u003eStefano Teodorani\u003c/bitbar.author\u003e\n# \u003cbitbar.author.github\u003eteopost\u003c/bitbar.author.github\u003e\n# \u003cbitbar.desc\u003eShow your jira issues\u003c/bitbar.desc\u003e\n# \u003cbitbar.image\u003ehttps://i.ibb.co/3SZ6D30/Schermata-2019-11-23-alle-19-26-24.png\u003c/bitbar.image\u003e\n# \u003cbitbar.dependencies\u003epython\u003c/bitbar.dependencies\u003e\n# \u003cbitbar.abouturl\u003ehttps://www.stefanoteodorani.it/\u003c/bitbar.abouturl\u003e\n\n\nimport requests\nimport json\nimport base64\n\nfrom urllib.parse import quote\nfrom requests.packages.urllib3.exceptions import InsecureRequestWarning\n\nclass Jira:\n    base_url = \"\"\n    juser = \"\"\n    jpwd = \"\"\n    s = \"\"\n    issue_count = 0\n    issue_results = \"\"\n    max_results = 50\n    active_jql = \"\"\n\n    def __init__(self, BaseUrl, UserName, Password):\n        self.base_url = BaseUrl\n        self.juser = UserName\n        self.jpwd = Password\n\n        self.s = requests.Session()\n\n        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)\n\n    def Query(self, jql):\n        self.active_jql = jql\n        #expansion = 'summary,issuetype,status,assignee,renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations'\n        expansion = 'summary,issuetype,status,assignee'\n        payload = {'jql' : jql, 'maxResults' : self.max_results, 'fields' : expansion}\n        # renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations\n        r = self.s.get(self.base_url + \"/rest/api/2/search\", params=payload, verify=False, auth=(self.juser, self.jpwd))\n        parsed = json.loads(r.text)\n        self.issue_count, self.issue_results = parsed['total'],parsed['issues']\n\n    def PrintIssues(self, filter, assignee=''):\n        # print gray title\n        print(filter)\n        for issue in self.issue_results:\n            #print(issue)\n            status = issue['fields']['status']['name']\n            summary = issue['fields']['summary'].replace('|', '-')\n\n            if filter.upper() == 'DEBUG':\n                print('DEBUG: ' + status + '-' + summary)\n\n            try:\n                assignee = \" ▸\" + issue['fields']['assignee']['name']\n            except:\n                assignee = \"\"\n\n            assignee = \"\"\n            iconurl = issue['fields']['issuetype']['iconUrl']\n            key = issue['key']\n\n            line = key + ': ' + summary + assignee + ' | href=' + self.base_url + '/browse/' + key + ' image=' + self.render_icon_string(iconurl)\n            if status.upper() != 'DEBUG':\n                if status.upper() == filter.upper():\n                    if assignee == '':\n                        print(line)\n                    elif assignee == assignee:\n                        print(line)\n\n    def render_icon_string(self, iconurl):\n        if 'viewavatar' in iconurl:\n            retvalue = iconurl + '\u0026format=png'\n            retvalue = retvalue.replace('size=medium', 'size=xsmall')\n        else:\n            retvalue = iconurl\n        return str(base64.b64encode(self.s.get(retvalue).content))[2:-1]\n\ndef print_title(toprint):\n    print(toprint)\n    print('---')\n\ndef print_separator():\n    print('---')\n\n# ====\n# MAIN\n# ====\nif __name__ == '__main__':\n\n    QUERY_NAME = \"Issues\"\n\n    JIRAURL = \"\u003center-jira-url\u003e\"\n    USERNAME = \"\u003cput here usernema\u003e\"\n    PASSWORD = \"\u003cput here password\u003e\"\n    JQL = \"resolution = Unresolved\"\n\n    Cloud = Jira(JIRAURL, USERNAME, PASSWORD)\n    Cloud.Query(JQL)\n\n    tot_count=str(Cloud.issue_count)\n\n    if tot_count == 0:\n        print_title(QUERY_NAME)\n    else:\n        print_title(QUERY_NAME + \": \" + tot_count)\n\n    Cloud.PrintIssues('Triage')\n    Cloud.PrintIssues('Riaperta')\n    Cloud.PrintIssues('Waiting for support')\n    Cloud.PrintIssues('Waiting for customer')\n    Cloud.PrintIssues('In corso')\n    # Add here your preferrend jira workflow steps\n\n    print_separator()\n\n    print(\"▸ Go to Jira...\" + ' | href=' + Cloud.base_url + '/issues/?jql=' + quote(Cloud.active_jql, ''))\n"
				}
			],
			"path": "Dev/Jira/jira-issues.10m.py",
			"filename": "jira-issues.10m.py",
			"dir": "Dev/Jira",
			"docsPlugin": "Dev/Jira/jira-issues.10m.py.html",
			"docsCategory": "Dev/Jira.html",
			"pathSegments": [
				"Dev",
				"Jira"
			],
			"categoryPathSegments": [
				{
					"path": "Dev",
					"text": "Dev",
					"isLast": false
				},
				{
					"path": "Dev/Jira",
					"text": "Jira",
					"isLast": true
				}
			],
			"title": "Jira issues",
			"version": "v1.0",
			"author": "Stefano Teodorani",
			"authors": [
				{
					"name": "Stefano Teodorani",
					"githubUsername": "teopost",
					"imageURL": "https://avatars.githubusercontent.com/u/2573389?v=4",
					"bio": "",
					"primary": true
				}
			],
			"desc": "Show your jira issues",
			"imageURL": "https://i.ibb.co/3SZ6D30/Schermata-2019-11-23-alle-19-26-24.png",
			"dependencies": [
				"python"
			],
			"aboutURL": "https://www.stefanoteodorani.it/",
			"lastUpdated": "2021-03-08T15:21:49.486823Z",
			"vars": null
		},
		{
			"files": [
				{
					"path": "Dev/Jira/jira.1m.sh",
					"filename": "jira.1m.sh",
					"content": "#!/bin/bash\n\n# bitbar plugins for devs that use https://www.atlassian.com/software/jira\n#\n# gets all assigned tasks and displays them on different sorting behaviors.\n# also shows when there are open blockers\n#\n# metadata\n# \u003cbitbar.title\u003ejira\u003c/bitbar.title\u003e\n# \u003cbitbar.version\u003ev1.1\u003c/bitbar.version\u003e\n# \u003cbitbar.author\u003eNicolas Gehlert\u003c/bitbar.author\u003e\n# \u003cbitbar.author.github\u003engehlert\u003c/bitbar.author.github\u003e\n# \u003cbitbar.desc\u003edisplay all tasks that are assigned to you. There are currently two sorting options. Either by type (e.g. Task, Story, Block) or by status (in progress, resolved, ...).\u003c/bitbar.desc\u003e\n# \u003cbitbar.image\u003ehttp://i.imgur.com/HwBF2JX.png\u003c/bitbar.image\u003e\n\nUSER=\"\"\nPASSWORD=\"\"\nJIRA_BASE_URL=\"https://example.com/jira\"\nPROJECT=\"PROJECT\"\nCOOKIE_LOCATION=\"$HOME/.jira-cookie\"\nORDER_BY=\"TYPE\" # available options are [TYPE, STATUS]\n# I think those are the default values, however you should still check your jira configuration\n# Also they are only needed if you want to order by `STATUS`\nSTATUSES=(\"to do\" \"in progress\" \"resolved\" \"done\" \"closed\")\n\nfunction getJsonValue() {\n  KEY=$1\n  num=$2\n  awk -F\"[,:}]\" '{for(i=1;i\u003c=NF;i++){if($i~/'\"$KEY\"'\\042/){print $(i+1)}}}' | tr -d '\"' | sed -n \"${num}\"p\n}\n# stupid hack because json parsing in bash sucks :D find better solution later\nfunction getTextWithCommaJsonValue() {\n  KEY=$1\n  num=$2\n  awk -F\"[:}]\" '{for(i=1;i\u003c=NF;i++){if($i~/'\"$KEY\"'\\042/){print $(i+1)}}}' | tr -d '\"' | sed -n \"${num}\"p\n}\n\nfunction echoAllIssues() {\n  json=$1\n  numberOfTasks=$2\n  color=$3\n  i=\"1\"\n  while [ $i -le \"$numberOfTasks\" ]\n  do\n    issues=$(echo \"$json\" | getTextWithCommaJsonValue summary $i)\n    key=$(echo \"$json\" | getJsonValue key $i)\n    url=\"${JIRA_BASE_URL}/browse/${key}\"\n    echo \"$key: $issues | bash='$0' param1=$url terminal=false color=$color\"\n    ((i+=1))\n  done\n}\n\nfunction jqlEscape() {\n  param=$*\n  echo \"\\\"${param/ /%20}\\\"\"\n}\n\nfunction login() {\n  curl --insecure --silent -X POST -H \"Content-Type: application/json\" -H \"X-Atlassian-Token: nocheck\" -c \"${COOKIE_LOCATION}\" --data \"{\\\"username\\\":\\\"${USER}\\\",\\\"password\\\":\\\"${PASSWORD}\\\"}\" \"${JIRA_BASE_URL}/rest/auth/1/session\"\n}\n\nfunction runType() {\n  recursive=$1\n  blocker=$(curl --insecure --silent -X GET -b \"${COOKIE_LOCATION}\" -H \"Content-Type: application/json\" $JIRA_BASE_URL/rest/api/2/search?jql=sprint%20in%20openSprints\\(\\)AND%20priority=Blocker%20AND%20project=${PROJECT}%20AND%20status\\!=done\\\u0026fields=summary)\n\n  assignedTasks=$(curl --insecure --silent -X GET -b \"${COOKIE_LOCATION}\" -H \"Content-Type: application/json\" $JIRA_BASE_URL/rest/api/2/search?jql=assignee%20in\\(currentUser\\(\\)\\)AND%20sprint%20in%20openSprints\\(\\)AND%20status\\!=done\\\u0026fields=summary)\n\n  stories=$(curl  --insecure --silent -X GET -b \"${COOKIE_LOCATION}\" -H \"Content-Type: application/json\" $JIRA_BASE_URL/rest/api/2/search?jql=sprint%20in%20openSprints\\(\\)%20AND%20issuetype=story%20AND%20project=${PROJECT}%20AND%20status\\!=done\\\u0026fields=summary)\n\n  totalBlocker=$(echo \"$blocker\" | getJsonValue total 1)\n  totalAssignedTasks=$(echo \"$assignedTasks\" | getJsonValue total 1)\n  totalStories=$(echo \"$stories\" | getJsonValue total 1)\n  if [[ -z \"$totalBlocker\" || -z \"$totalAssignedTasks\" || -z \"$totalStories\" ]]\n    then\n      # if data loading failed on the second attempt there is probably a bigger issue\n      if [[ \"$recursive\" = true ]]\n        then\n          echo There seems to be a problem with the jira login. Check your configuration\n          exit\n      fi\n      # token is expired. login again and try to load data\n      login\n      runType true\n  fi\n\n  if [ \"$totalBlocker\" -gt 0 ]\n    then\n      echo \"Blocker: ${totalBlocker} | color=#F44336\"\n    else\n      echo \"Tasks assigned: ${totalAssignedTasks} | color=#333333\"\n  fi\n\n  echo \"---\"\n\n  echo \"Blocker: ${totalBlocker} | color=#333333\"\n  echoAllIssues \"$blocker\" \"$totalBlocker\" \"#F44336\"\n  echo \"---\"\n\n  echo \"Tasks assigned: ${totalAssignedTasks} | color=#333333\"\n  echoAllIssues \"$assignedTasks\" \"$totalAssignedTasks\" \"#333333\"\n  echo \"---\"\n\n  echo \"Open Stories: ${totalStories} | color=#333333\"\n  echoAllIssues \"$stories\" \"$totalStories\" \"#333333\"\n\n  exit\n}\n\nfunction runStatus() {\n  recursive=$1\n  blocker=$(curl --insecure --silent -X GET -b \"${COOKIE_LOCATION}\" -H \"Content-Type: application/json\" $JIRA_BASE_URL/rest/api/2/search?jql=sprint%20in%20openSprints\\(\\)AND%20priority=Blocker%20AND%20project=${PROJECT}%20AND%20status\\!=done\\\u0026fields=summary)\n\n  assignedTasks=$(curl --insecure --silent -X GET -b \"${COOKIE_LOCATION}\" -H \"Content-Type: application/json\" $JIRA_BASE_URL/rest/api/2/search?jql=assignee%20in\\(currentUser\\(\\)\\)AND%20sprint%20in%20openSprints\\(\\)AND%20status\\!=done\\\u0026fields=summary)\n  totalBlocker=$(echo \"$blocker\" | getJsonValue total 1)\n  totalAssignedTasks=$(echo \"$assignedTasks\" | getJsonValue total 1)\n  if [[ -z \"$totalBlocker\" || -z \"$totalAssignedTasks\" ]]\n    then\n      # if data loading failed on the second attempt there is probably a bigger issue\n      if [[ \"$recursive\" = true ]]\n        then\n          echo There seems to be a problem with the jira login. Check your configuration\n          exit\n      fi\n      # token is expired. login again and try to load data\n      login\n      runStatus true\n  fi\n\n  if [ \"$totalBlocker\" -gt 0 ]\n    then\n      echo \"Blocker: ${totalBlocker} | color=#F44336\"\n    else\n      echo \"Tasks assigned: ${totalAssignedTasks} | color=#333333\"\n  fi\n\n  echo \"---\"\n  echo \"Blocker: ${totalBlocker} | color=#333333\"\n  echoAllIssues \"$blocker\" \"$totalBlocker\" \"#F44336\"\n  echo \"---\"\n  for index in ${!STATUSES[*]}\n  do\n    status=${STATUSES[$index]}\n    ecapedStatus=$(jqlEscape \"$status\")\n\n    statusResponse=$(curl  --insecure --silent -X GET -b \"${COOKIE_LOCATION}\" -H \"Content-Type: application/json\" $JIRA_BASE_URL/rest/api/2/search?jql=assignee%20in\\(currentUser\\(\\)\\)AND%20sprint%20in%20openSprints\\(\\)%20AND%20project=${PROJECT}%20AND%20status=\"${ecapedStatus}\"\\\u0026fields=summary)\n    totalTasks=$(echo \"$statusResponse\" | getJsonValue total 1)\n\n    echo \"${status}: ${totalTasks} | color=#333333\"\n    echoAllIssues \"$statusResponse\" \"$totalTasks\" \"#333333\"\n    echo \"---\"\n  done\n  exit\n}\n\n# the program starts here\n\n# opens jira issue page if one entry was clicked\nif [[ \"$1\" == http* ]]; then\n  open \"$1\"\n  exit\nfi\n\n# only login if there is not already a auth token\nif [ ! -f \"${COOKIE_LOCATION}\" ]\n  then\n    login\nfi\n\nif [[ \"${ORDER_BY}\" == \"TYPE\" ]]; then\n  runType\nelif [[ \"${ORDER_BY}\" == \"STATUS\" ]]; then\n  runStatus\nfi\n"
				}
			],
			"path": "Dev/Jira/jira.1m.sh",
			"filename": "jira.1m.sh",
			"dir": "Dev/Jira",
			"docsPlugin": "Dev/Jira/jira.1m.sh.html",
			"docsCategory": "Dev/Jira.html",
			"pathSegments": [
				"Dev",
				"Jira"
			],
			"categoryPathSegments": [
				{
					"path": "Dev",
					"text": "Dev",
					"isLast": false
				},
				{
					"path": "Dev/Jira",
					"text": "Jira",
					"isLast": true
				}
			],
			"title": "jira",
			"version": "v1.1",
			"author": "Nicolas Gehlert",
			"authors": [
				{
					"name": "Nicolas Gehlert",
					"githubUsername": "ngehlert",
					"imageURL": "https://avatars.githubusercontent.com/u/8989483?v=4",
					"bio": "",
					"primary": true
				}
			],
			"desc": "display all tasks that are assigned to you. There are currently two sorting options. Either by type (e.g. Task, Story, Block) or by status (in progress, resolved, ...).",
			"imageURL": "http://i.imgur.com/HwBF2JX.png",
			"dependencies": null,
			"aboutURL": "",
			"lastUpdated": "2021-03-08T15:21:49.670598Z",
			"vars": null
		}
	]
}