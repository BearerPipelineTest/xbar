
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>COVID-19 Today in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='Displays changes in daily and average COVID-19 cases for a given country. - install xbar for free to get started.'>
	<meta name='author' content='CartoonChess'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png'>
	<meta itemprop='name' content='COVID-19 Today in your macOS menu bar'>
	<meta itemprop='description' content='Displays changes in daily and average COVID-19 cases for a given country. - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='COVID-19 Today in your macOS menu bar'>
	<meta name='twitter:description' content='Displays changes in daily and average COVID-19 cases for a given country. - install xbar for free to get started.'>
	<meta name='twitter:image' content='https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='COVID-19 Today in your macOS menu bar'>
	<meta property='og:description' content='Displays changes in daily and average COVID-19 cases for a given country. - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Environment/covid-19_today.15m.sh.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png'>
	<link rel='shortcut icon' href='https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>💜</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>COVID-19 Today</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/cartoonchess.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/43363630?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/cartoonchess.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										CartoonChess (<code style='color:white;'>@cartoonchess</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						Displays changes in daily and average COVID-19 cases for a given country.
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Environment%2fcovid-19_today.15m.sh'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>🖥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png' 
				alt='Image preview of COVID-19 Today plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>covid-19_today.15m.sh</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Environment/covid-19_today.15m.sh'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Environment/covid-19_today.15m.sh'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/bin/bash

# &lt;bitbar.title&gt;COVID-19 Today&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.0.0&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;CartoonChess&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;cartoonchess&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;Displays changes in daily and average COVID-19 cases for a given country.&lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png&lt;/bitbar.image&gt;
# &lt;bitbar.dependencies&gt;bash,jq&lt;/bitbar.dependencies&gt;
# &lt;bitbar.abouturl&gt;https://github.com/cartoonchess/bitbar-covid-19-today&lt;/bitbar.abouturl&gt;

# ==============================CONFIGURATION================================
# Set these variables to configure the output to your liking.
# The country must be a two- or three-letter country code.
COUNTRY=&#34;kr&#34;
SHOW_CASES_TODAY_BESIDE_ICON=true
# ===========================================================================



# ==============================DEPENDENCIES=================================
# This script requires jq for manipulating JSON data.
# Requires: https://stedolan.github.io/jq/
# Install via brew:  `brew install jq`
# ===========================================================================

# ===============================DATA SOURCE=================================
# This script curls JSON data from disease.sh, the Open Disease API:
# https://disease.sh/
# GitHub: https://github.com/disease-sh/api
# ===========================================================================

# ================================PRIOR ART==================================
# This script is a modified version of:
# covid-bitbar
# https://github.com/wilsongoode/covid-bitbar
# by Wilson Good
# Check there for a version with detailed stats for the US.
# Many thanks!
# ===========================================================================



# Setting my Bitbar path to include /usr/local/bin. Systems may vary
# jq fails without this
PATH=/usr/local/bin:${PATH}
export PATH
LANG=en_US.UTF-8 # needed in BitBar env for awk to format numbers
export LANG



# Test for jq

JSON_PARSER=&#34;jq&#34;
if [ ! $(command -v $JSON_PARSER) ]; then
    echo &#34;⚠&#34;
    echo &#34;---&#34;
    echo &#34;$JSON_PARSER Not Installed&#34;
    echo &#34;Install ${JSON_PARSER}… | href=https://stedolan.github.io/${JSON_PARSER}/download/&#34;
    echo &#34;---&#34;
    echo &#34;Refresh | refresh=true&#34;
    exit
fi



# Methods

# Return the singular or plural form of a word based on some count
# Usage:
# COUNT=15
# echo &#34;I have $COUNT $(plural $COUNT &#39;bee&#39; &#39;bees&#39;)&#34;
# Output: I have 15 bees
plural() {
    COUNT=$1
    SINGULAR=$2
    PLURAL=$3
    if [ $COUNT = 1 ]; then
        echo $SINGULAR
    else
        echo $PLURAL
    fi
}

# Return number with comma as thousands place separator
# Usage:
# BIG_NUM=1500
# echo &#34;I have $(commas $BIG_NUM) bees&#34;
# Output: I have 1,500 bees
commas() {
    echo $(awk &#39;BEGIN{printf &#34;%\047d\n&#34;, &#39;$1&#39;}&#39;)
}



# Get the three-letter country code to link to a detailed graph

COUNTRY_DATA=$(curl -s https://disease.sh/v3/covid-19/countries/$COUNTRY)

# Maybe the server is down?
if [ -z &#34;$COUNTRY_DATA&#34; ]; then
    echo &#34;⚠&#34;
    echo &#34;---&#34;
    echo &#34;No Information&#34;
    echo &#34;Refresh | refresh=true&#34;
    exit
fi

COUNTRY_CODE=$(echo $COUNTRY_DATA |
    jq &#39;.countryInfo.iso3&#39; |
    sed -E &#39;s/&#34;//g&#39;
    )

# If there&#39;s no country code, there&#39;s a problem with the data
# jq returns a literal string &#34;null&#34;, NOT a null value
if [ $COUNTRY_CODE = &#34;null&#34; ]; then
    echo &#34;⚠&#34;
    echo &#34;---&#34;
    echo &#34;Invalid Country Code&#34;
    echo &#34;Use a two- or three-letter code in the script&#34;
    echo &#34;Open Plugin Folder… | href=file://${0%/*}/&#34;
    echo &#34;---&#34;
    echo &#34;Refresh | refresh=true&#34;
    exit
fi

    

# Fetch various numbers
# Somehow this data seems more reliable than the data above.
# Namely, it often reports zero new cases when that simply isn&#39;t true.

HISTORICAL_DATA=$(curl -s https://disease.sh/v3/covid-19/historical/$COUNTRY\?lastdays=3)
COUNTRY_NAME=$(echo $HISTORICAL_DATA |
    jq &#39;.country&#39; |
    # Remove quotation marks
    sed -E &#39;s/&#34;//g&#39;
    )

CASES_TODAY=$(echo $HISTORICAL_DATA |
    jq &#39;[.timeline.cases[]] | sort | .[-1] - .[-2]&#39;
    )
    
CASES_YESTERDAY=$(echo $HISTORICAL_DATA |
    jq &#39;[.timeline.cases[]] | sort | .[-2] - .[-3]&#39;
    )
    
TOTAL_CASES=$(
    echo $HISTORICAL_DATA |
    jq &#39;[.timeline.cases[]] | sort | .[-1]&#39;
    )
   
   
    
# Calculate daily stats

TODAY=$(date &#43;%s)
# Data begins at 2020-01-22
# Mac-specific formatting; Linux would require a change
DAY_ONE=$(date -jf &#34;%Y-%m-%d&#34; &#34;2020-01-22&#34; &#43;%s)
TOTAL_DAYS=$((($TODAY-$DAY_ONE)/(3600*24)))
DAILY_AVERAGE=$(($TOTAL_CASES/$TOTAL_DAYS))

TODAY_VS_YESTERDAY=$(($CASES_TODAY-$CASES_YESTERDAY))
TODAY_VS_AVERAGE=$(($CASES_TODAY-$DAILY_AVERAGE))



# Determine differences and format strings

# Absolute value of difference between new cases today and yesterday
if [ $TODAY_VS_YESTERDAY = 0 ]; then
    DAILY_DIFFERENCE=&#34;▶ No more&#34; # —
elif [ $TODAY_VS_YESTERDAY -lt 0 ]; then
    DAILY_DIFFERENCE=$((-$TODAY_VS_YESTERDAY))
    # awk prints numbers with comma as thousands place separators
    DAILY_DIFFERENCE=$(commas $DAILY_DIFFERENCE)
    DAILY_DIFFERENCE=&#34;▼ $DAILY_DIFFERENCE fewer&#34;
else
    DAILY_DIFFERENCE=$(commas $TODAY_VS_YESTERDAY)
    DAILY_DIFFERENCE=&#34;▲ $DAILY_DIFFERENCE more&#34;
fi

# Absolute value of difference between total cases today and daily average
if [ $TODAY_VS_AVERAGE = 0 ]; then
    AVERAGE_DIFFERENCE=&#34;⦵ No more&#34; # —⃝
elif [ $TODAY_VS_AVERAGE -lt 0 ]; then
    AVERAGE_DIFFERENCE=$((-$TODAY_VS_AVERAGE))
    AVERAGE_DIFFERENCE=$(commas $AVERAGE_DIFFERENCE)
    AVERAGE_DIFFERENCE=&#34;—̥ $AVERAGE_DIFFERENCE fewer&#34; # ⏁—̥⃝
else
    AVERAGE_DIFFERENCE=$(commas $TODAY_VS_AVERAGE)
    AVERAGE_DIFFERENCE=&#34;—̊ $AVERAGE_DIFFERENCE more&#34; # ⏂—̊⃝
fi



# Show menu bar item
# TODO: What about &#34;break even&#34; icons??

# ⤉⤈⤒⤓ ▼̅▼̲▲̅▲̲ ⤉⃝⤈⃝⤒⃝⤓⃝ ▼̅⃝▼̲⃝▲̅⃝▲̲⃝
if [ $TODAY_VS_YESTERDAY = 0 ]; then
    if [ $TODAY_VS_AVERAGE = 0 ]; then
        ICON=&#34;⦵&#34;
    elif [ $TODAY_VS_AVERAGE -lt 0 ]; then
        ICON=&#34;—̥&#34;
    else
        ICON=&#34;—̊&#34;
    fi
elif [ $TODAY_VS_YESTERDAY -lt 0 ]; then
    if [ $TODAY_VS_AVERAGE = 0 ]; then
        # This and its upward equivalent render without strikethrough without other text
        # i.e. If not showing daily count, only the triangle appears
        ICON=&#34;▽̶&#34;
    elif [ $TODAY_VS_AVERAGE -lt 0 ]; then
        ICON=&#34;⤈&#34;
    else
        ICON=&#34;⤓&#34;
    fi
else
    if [ $TODAY_VS_AVERAGE = 0 ]; then
        ICON=&#34;△̶&#34;
    elif [ $TODAY_VS_AVERAGE -lt 0 ]; then
        ICON=&#34;⤒&#34;
    else
        ICON=&#34;⤉&#34;
    fi
fi

CASES_TODAY_FORMATTED=$(commas $CASES_TODAY)
if [ $SHOW_CASES_TODAY_BESIDE_ICON = true ]; then
    ICON=&#34;$ICON $CASES_TODAY_FORMATTED&#34;
fi

echo $ICON
echo &#34;---&#34;



# Show dropdown details

# Total new cases today
# Add &#34;s&#34; for plural, if plural
echo &#34;$CASES_TODAY_FORMATTED new $(plural $CASES_TODAY &#39;case&#39; &#39;cases&#39;) today in $COUNTRY_NAME | href=https://ourworldindata.org/coronavirus-data-explorer?interval=daily&amp;country=$COUNTRY_CODE&#34;

echo $DAILY_DIFFERENCE&#34; new $(plural $TODAY_VS_YESTERDAY &#39;case&#39; &#39;cases&#39;) than yesterday&#34;
echo $AVERAGE_DIFFERENCE&#34; daily $(plural $TODAY_VS_AVERAGE &#39;case&#39; &#39;cases&#39;) than average&#34;



# Options

echo &#34;---&#34;
echo &#34;Update | refresh=true&#34;
echo &#34;Settings&#34;
echo &#34;-- Edit the plugin directly to:&#34;
echo &#34;-- • Change the country&#34;
echo &#34;-- • Show or hide daily cases beside icon&#34;
echo &#34;-----&#34;
echo &#34;-- Open Plugin Folder… | href=file://${0%/*}/&#34;
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						•
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors • <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
