{
	"plugin": {
		"files": [
			{
				"path": "Environment/covid-19_today.15m.sh",
				"filename": "covid-19_today.15m.sh",
				"content": "#!/bin/bash\n\n# \u003cbitbar.title\u003eCOVID-19 Today\u003c/bitbar.title\u003e\n# \u003cbitbar.version\u003ev1.0.0\u003c/bitbar.version\u003e\n# \u003cbitbar.author\u003eCartoonChess\u003c/bitbar.author\u003e\n# \u003cbitbar.author.github\u003ecartoonchess\u003c/bitbar.author.github\u003e\n# \u003cbitbar.desc\u003eDisplays changes in daily and average COVID-19 cases for a given country.\u003c/bitbar.desc\u003e\n# \u003cbitbar.image\u003ehttps://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png\u003c/bitbar.image\u003e\n# \u003cbitbar.dependencies\u003ebash,jq\u003c/bitbar.dependencies\u003e\n# \u003cbitbar.abouturl\u003ehttps://github.com/cartoonchess/bitbar-covid-19-today\u003c/bitbar.abouturl\u003e\n\n# ==============================CONFIGURATION================================\n# Set these variables to configure the output to your liking.\n# The country must be a two- or three-letter country code.\nCOUNTRY=\"kr\"\nSHOW_CASES_TODAY_BESIDE_ICON=true\n# ===========================================================================\n\n\n\n# ==============================DEPENDENCIES=================================\n# This script requires jq for manipulating JSON data.\n# Requires: https://stedolan.github.io/jq/\n# Install via brew:  `brew install jq`\n# ===========================================================================\n\n# ===============================DATA SOURCE=================================\n# This script curls JSON data from disease.sh, the Open Disease API:\n# https://disease.sh/\n# GitHub: https://github.com/disease-sh/api\n# ===========================================================================\n\n# ================================PRIOR ART==================================\n# This script is a modified version of:\n# covid-bitbar\n# https://github.com/wilsongoode/covid-bitbar\n# by Wilson Good\n# Check there for a version with detailed stats for the US.\n# Many thanks!\n# ===========================================================================\n\n\n\n# Setting my Bitbar path to include /usr/local/bin. Systems may vary\n# jq fails without this\nPATH=/usr/local/bin:${PATH}\nexport PATH\nLANG=en_US.UTF-8 # needed in BitBar env for awk to format numbers\nexport LANG\n\n\n\n# Test for jq\n\nJSON_PARSER=\"jq\"\nif [ ! $(command -v $JSON_PARSER) ]; then\n    echo \"⚠\"\n    echo \"---\"\n    echo \"$JSON_PARSER Not Installed\"\n    echo \"Install ${JSON_PARSER}… | href=https://stedolan.github.io/${JSON_PARSER}/download/\"\n    echo \"---\"\n    echo \"Refresh | refresh=true\"\n    exit\nfi\n\n\n\n# Methods\n\n# Return the singular or plural form of a word based on some count\n# Usage:\n# COUNT=15\n# echo \"I have $COUNT $(plural $COUNT 'bee' 'bees')\"\n# Output: I have 15 bees\nplural() {\n    COUNT=$1\n    SINGULAR=$2\n    PLURAL=$3\n    if [ $COUNT = 1 ]; then\n        echo $SINGULAR\n    else\n        echo $PLURAL\n    fi\n}\n\n# Return number with comma as thousands place separator\n# Usage:\n# BIG_NUM=1500\n# echo \"I have $(commas $BIG_NUM) bees\"\n# Output: I have 1,500 bees\ncommas() {\n    echo $(awk 'BEGIN{printf \"%\\047d\\n\", '$1'}')\n}\n\n\n\n# Get the three-letter country code to link to a detailed graph\n\nCOUNTRY_DATA=$(curl -s https://disease.sh/v3/covid-19/countries/$COUNTRY)\n\n# Maybe the server is down?\nif [ -z \"$COUNTRY_DATA\" ]; then\n    echo \"⚠\"\n    echo \"---\"\n    echo \"No Information\"\n    echo \"Refresh | refresh=true\"\n    exit\nfi\n\nCOUNTRY_CODE=$(echo $COUNTRY_DATA |\n    jq '.countryInfo.iso3' |\n    sed -E 's/\"//g'\n    )\n\n# If there's no country code, there's a problem with the data\n# jq returns a literal string \"null\", NOT a null value\nif [ $COUNTRY_CODE = \"null\" ]; then\n    echo \"⚠\"\n    echo \"---\"\n    echo \"Invalid Country Code\"\n    echo \"Use a two- or three-letter code in the script\"\n    echo \"Open Plugin Folder… | href=file://${0%/*}/\"\n    echo \"---\"\n    echo \"Refresh | refresh=true\"\n    exit\nfi\n\n    \n\n# Fetch various numbers\n# Somehow this data seems more reliable than the data above.\n# Namely, it often reports zero new cases when that simply isn't true.\n\nHISTORICAL_DATA=$(curl -s https://disease.sh/v3/covid-19/historical/$COUNTRY\\?lastdays=3)\nCOUNTRY_NAME=$(echo $HISTORICAL_DATA |\n    jq '.country' |\n    # Remove quotation marks\n    sed -E 's/\"//g'\n    )\n\nCASES_TODAY=$(echo $HISTORICAL_DATA |\n    jq '[.timeline.cases[]] | sort | .[-1] - .[-2]'\n    )\n    \nCASES_YESTERDAY=$(echo $HISTORICAL_DATA |\n    jq '[.timeline.cases[]] | sort | .[-2] - .[-3]'\n    )\n    \nTOTAL_CASES=$(\n    echo $HISTORICAL_DATA |\n    jq '[.timeline.cases[]] | sort | .[-1]'\n    )\n   \n   \n    \n# Calculate daily stats\n\nTODAY=$(date +%s)\n# Data begins at 2020-01-22\n# Mac-specific formatting; Linux would require a change\nDAY_ONE=$(date -jf \"%Y-%m-%d\" \"2020-01-22\" +%s)\nTOTAL_DAYS=$((($TODAY-$DAY_ONE)/(3600*24)))\nDAILY_AVERAGE=$(($TOTAL_CASES/$TOTAL_DAYS))\n\nTODAY_VS_YESTERDAY=$(($CASES_TODAY-$CASES_YESTERDAY))\nTODAY_VS_AVERAGE=$(($CASES_TODAY-$DAILY_AVERAGE))\n\n\n\n# Determine differences and format strings\n\n# Absolute value of difference between new cases today and yesterday\nif [ $TODAY_VS_YESTERDAY = 0 ]; then\n    DAILY_DIFFERENCE=\"▶ No more\" # —\nelif [ $TODAY_VS_YESTERDAY -lt 0 ]; then\n    DAILY_DIFFERENCE=$((-$TODAY_VS_YESTERDAY))\n    # awk prints numbers with comma as thousands place separators\n    DAILY_DIFFERENCE=$(commas $DAILY_DIFFERENCE)\n    DAILY_DIFFERENCE=\"▼ $DAILY_DIFFERENCE fewer\"\nelse\n    DAILY_DIFFERENCE=$(commas $TODAY_VS_YESTERDAY)\n    DAILY_DIFFERENCE=\"▲ $DAILY_DIFFERENCE more\"\nfi\n\n# Absolute value of difference between total cases today and daily average\nif [ $TODAY_VS_AVERAGE = 0 ]; then\n    AVERAGE_DIFFERENCE=\"⦵ No more\" # —⃝\nelif [ $TODAY_VS_AVERAGE -lt 0 ]; then\n    AVERAGE_DIFFERENCE=$((-$TODAY_VS_AVERAGE))\n    AVERAGE_DIFFERENCE=$(commas $AVERAGE_DIFFERENCE)\n    AVERAGE_DIFFERENCE=\"—̥ $AVERAGE_DIFFERENCE fewer\" # ⏁—̥⃝\nelse\n    AVERAGE_DIFFERENCE=$(commas $TODAY_VS_AVERAGE)\n    AVERAGE_DIFFERENCE=\"—̊ $AVERAGE_DIFFERENCE more\" # ⏂—̊⃝\nfi\n\n\n\n# Show menu bar item\n# TODO: What about \"break even\" icons??\n\n# ⤉⤈⤒⤓ ▼̅▼̲▲̅▲̲ ⤉⃝⤈⃝⤒⃝⤓⃝ ▼̅⃝▼̲⃝▲̅⃝▲̲⃝\nif [ $TODAY_VS_YESTERDAY = 0 ]; then\n    if [ $TODAY_VS_AVERAGE = 0 ]; then\n        ICON=\"⦵\"\n    elif [ $TODAY_VS_AVERAGE -lt 0 ]; then\n        ICON=\"—̥\"\n    else\n        ICON=\"—̊\"\n    fi\nelif [ $TODAY_VS_YESTERDAY -lt 0 ]; then\n    if [ $TODAY_VS_AVERAGE = 0 ]; then\n        # This and its upward equivalent render without strikethrough without other text\n        # i.e. If not showing daily count, only the triangle appears\n        ICON=\"▽̶\"\n    elif [ $TODAY_VS_AVERAGE -lt 0 ]; then\n        ICON=\"⤈\"\n    else\n        ICON=\"⤓\"\n    fi\nelse\n    if [ $TODAY_VS_AVERAGE = 0 ]; then\n        ICON=\"△̶\"\n    elif [ $TODAY_VS_AVERAGE -lt 0 ]; then\n        ICON=\"⤒\"\n    else\n        ICON=\"⤉\"\n    fi\nfi\n\nCASES_TODAY_FORMATTED=$(commas $CASES_TODAY)\nif [ $SHOW_CASES_TODAY_BESIDE_ICON = true ]; then\n    ICON=\"$ICON $CASES_TODAY_FORMATTED\"\nfi\n\necho $ICON\necho \"---\"\n\n\n\n# Show dropdown details\n\n# Total new cases today\n# Add \"s\" for plural, if plural\necho \"$CASES_TODAY_FORMATTED new $(plural $CASES_TODAY 'case' 'cases') today in $COUNTRY_NAME | href=https://ourworldindata.org/coronavirus-data-explorer?interval=daily\u0026country=$COUNTRY_CODE\"\n\necho $DAILY_DIFFERENCE\" new $(plural $TODAY_VS_YESTERDAY 'case' 'cases') than yesterday\"\necho $AVERAGE_DIFFERENCE\" daily $(plural $TODAY_VS_AVERAGE 'case' 'cases') than average\"\n\n\n\n# Options\n\necho \"---\"\necho \"Update | refresh=true\"\necho \"Settings\"\necho \"-- Edit the plugin directly to:\"\necho \"-- • Change the country\"\necho \"-- • Show or hide daily cases beside icon\"\necho \"-----\"\necho \"-- Open Plugin Folder… | href=file://${0%/*}/\"\n"
			}
		],
		"path": "Environment/covid-19_today.15m.sh",
		"filename": "covid-19_today.15m.sh",
		"dir": "Environment",
		"docsPlugin": "Environment/covid-19_today.15m.sh.html",
		"docsCategory": "Environment.html",
		"pathSegments": [
			"Environment"
		],
		"categoryPathSegments": [
			{
				"path": "Environment",
				"text": "Environment",
				"isLast": true
			}
		],
		"title": "COVID-19 Today",
		"version": "v1.0.0",
		"author": "CartoonChess",
		"authors": [
			{
				"name": "CartoonChess",
				"githubUsername": "cartoonchess",
				"imageURL": "https://avatars.githubusercontent.com/u/43363630?v=4",
				"bio": "",
				"primary": true
			}
		],
		"desc": "Displays changes in daily and average COVID-19 cases for a given country.",
		"imageURL": "https://user-images.githubusercontent.com/43363630/93694795-da7d0700-fb4a-11ea-875b-02f29152e929.png",
		"dependencies": [
			"bash",
			"jq"
		],
		"aboutURL": "https://github.com/cartoonchess/bitbar-covid-19-today",
		"lastUpdated": "2021-03-08T15:21:53.251459Z",
		"vars": null
	}
}