
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>Yahoo Stock Ticker in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='Shows major stock indices in the menu bar and stock symbols in the dropdown menu by pulling data from the Yahoo Finance API. Similar to finance.yahoo.com the prices are delayed, but no API key is necessary. You can also set price alarms for BUY/SELL limits, which will notify you when the limit is reached. - install xbar for free to get started.'>
	<meta name='author' content='Long Do'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='https://github.com/longpdo/bitbar-plugins-custom/raw/master/images/yahoo-stock-ticker.png'>
	<meta itemprop='name' content='Yahoo Stock Ticker in your macOS menu bar'>
	<meta itemprop='description' content='Shows major stock indices in the menu bar and stock symbols in the dropdown menu by pulling data from the Yahoo Finance API. Similar to finance.yahoo.com the prices are delayed, but no API key is necessary. You can also set price alarms for BUY/SELL limits, which will notify you when the limit is reached. - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='Yahoo Stock Ticker in your macOS menu bar'>
	<meta name='twitter:description' content='Shows major stock indices in the menu bar and stock symbols in the dropdown menu by pulling data from the Yahoo Finance API. Similar to finance.yahoo.com the prices are delayed, but no API key is necessary. You can also set price alarms for BUY/SELL limits, which will notify you when the limit is reached. - install xbar for free to get started.'>
	<meta name='twitter:image' content='https://github.com/longpdo/bitbar-plugins-custom/raw/master/images/yahoo-stock-ticker.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='Yahoo Stock Ticker in your macOS menu bar'>
	<meta property='og:description' content='Shows major stock indices in the menu bar and stock symbols in the dropdown menu by pulling data from the Yahoo Finance API. Similar to finance.yahoo.com the prices are delayed, but no API key is necessary. You can also set price alarms for BUY/SELL limits, which will notify you when the limit is reached. - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Finance/yahoo_stock_ticker.10m.py.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='https://github.com/longpdo/bitbar-plugins-custom/raw/master/images/yahoo-stock-ticker.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='https://github.com/longpdo/bitbar-plugins-custom/raw/master/images/yahoo-stock-ticker.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='https://github.com/longpdo/bitbar-plugins-custom/raw/master/images/yahoo-stock-ticker.png'>
	<link rel='shortcut icon' href='https://github.com/longpdo/bitbar-plugins-custom/raw/master/images/yahoo-stock-ticker.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>ðŸ’œ</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>Yahoo Stock Ticker</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/longpdo.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/33006592?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/longpdo.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Long Do (<code style='color:white;'>@longpdo</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						Shows major stock indices in the menu bar and stock symbols in the dropdown menu by pulling data from the Yahoo Finance API. Similar to finance.yahoo.com the prices are delayed, but no API key is necessary. You can also set price alarms for BUY/SELL limits, which will notify you when the limit is reached.
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Finance%2fyahoo_stock_ticker.10m.py'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>ðŸ–¥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='https://github.com/longpdo/bitbar-plugins-custom/raw/master/images/yahoo-stock-ticker.png' 
				alt='Image preview of Yahoo Stock Ticker plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>yahoo_stock_ticker.10m.py</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Finance/yahoo_stock_ticker.10m.py'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Finance/yahoo_stock_ticker.10m.py'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env LC_ALL=en_US.UTF-8 /usr/local/bin/python3
#
# &lt;bitbar.title&gt;Yahoo Stock Ticker&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.1&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Long Do&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;longpdo&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;Shows major stock indices in the menu bar and stock symbols in the dropdown menu by pulling data from the Yahoo Finance API. Similar to finance.yahoo.com the prices are delayed, but no API key is necessary. You can also set price alarms for BUY/SELL limits, which will notify you when the limit is reached.&lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;https://github.com/longpdo/bitbar-plugins-custom/raw/master/images/yahoo-stock-ticker.png&lt;/bitbar.image&gt;
# &lt;bitbar.dependencies&gt;python3&lt;/bitbar.dependencies&gt;
# &lt;bitbar.abouturl&gt;https://github.com/longpdo/bitbar-plugins-custom/blob/master/README.md#yahoo-stock-ticker&lt;/bitbar.abouturl&gt;
#
# by longpdo (https://github.com/longpdo)

from datetime import datetime
import json
import os
import re
import sys
import subprocess

# ---------------------------------------------------------------------------------------------------------------------
# Enter your stock symbols here in the format: [&#34;symbol1&#34;, &#34;symbol2&#34;, ...]
symbols = [&#34;FB&#34;, &#34;AAPL&#34;, &#34;AMZN&#34;, &#34;NFLX&#34;, &#34;GOOG&#34;, &#34;BIDU&#34;, &#34;BABA&#34;, &#34;TCEHY&#34;]

# Enter the order how you want to sort the stock list:
# &#39;name&#39;                     : Sort alphabetically by name from A to Z
# &#39;market_change_winners&#39;    : Sort by value from top winners to losers
# &#39;market_change_losers&#39;     : Sort by value from top losers to winners
# &#39;market_change_volatility&#39; : Sort by absolute value from top to bottom
# &#39;&#39; or other values         : Sort by your custom order from the symbols array above
sort_by = &#39;market_change_winners&#39;
# ---------------------------------------------------------------------------------------------------------------------

# ---------------------------------------------------------------------------------------------------------------------
# CODE STARTING BELOW HERE, DO NOT EDIT IF YOU ARE A REGULAR USER
# Variables
indices_dict = {
    &#39;^GSPC&#39;: &#39;ðŸ‡ºðŸ‡¸ S&amp;P 500&#39;,
    &#39;^DJI&#39;: &#39;ðŸ‡ºðŸ‡¸ DOW 30&#39;,
    &#39;^IXIC&#39;: &#39;ðŸ‡ºðŸ‡¸ NASDAQ&#39;,
    &#39;^GDAXI&#39;: &#39;ðŸ‡©ðŸ‡ª DAX&#39;,
    &#39;^FTSE&#39;: &#39;ðŸ‡¬ðŸ‡§ FTSE 100&#39;,
    &#39;^FCHI&#39;: &#39;ðŸ‡«ðŸ‡· CAC 40&#39;,
    &#39;^STOXX50E&#39;: &#39;ðŸ‡ªðŸ‡º EURO STOXX 50&#39;,
}
GREEN = &#39;\033[32m&#39;
RED = &#39;\033[31m&#39;
RESET = &#39;\033[0m&#39;
FONT = &#34;| font=&#39;Menlo&#39;&#34;
# ---------------------------------------------------------------------------------------------------------------------


# macOS Alerts, Prompts and Notifications -----------------------------------------------------------------------------
# Display a macOS specific alert dialog to get confirmation from user to continue
def alert(alert_title=&#39;&#39;, alert_text=&#39;&#39;, alert_buttons=[&#39;Cancel&#39;, &#39;OK&#39;]):
    try:
        d = locals()
        user_input = subprocess.check_output([&#39;osascript&#39;, &#39;-l&#39;, &#39;JavaScript&#39;, &#39;-e&#39;, &#39;&#39;&#39;
            const app = Application.currentApplication()
            app.includeStandardAdditions = true
            const response = app.displayAlert(&#39;{alert_title}&#39;, {{
                message: &#39;{alert_text}&#39;,
                as: &#39;critical&#39;,
                buttons: [&#39;{alert_buttons[0]}&#39;, &#39;{alert_buttons[1]}&#39;],
                defaultButton: &#39;{alert_buttons[1]}&#39;,
                cancelButton: &#39;{alert_buttons[0]}&#39;
            }})
            response
        &#39;&#39;&#39;.format(**d)]).decode(&#39;ascii&#39;).rstrip()
        return user_input
    except subprocess.CalledProcessError:
        pass


# Display a macOS specific prompt dialog to get text input from the user
def prompt(prompt_text=&#39;&#39;):
    try:
        d = locals()
        user_input = subprocess.check_output([&#39;osascript&#39;, &#39;-l&#39;, &#39;JavaScript&#39;, &#39;-e&#39;, &#39;&#39;&#39;
            const app = Application.currentApplication()
            app.includeStandardAdditions = true
            const response = app.displayDialog(&#39;{prompt_text}&#39;, {{
                defaultAnswer: &#39;&#39;,
                buttons: [&#39;Cancel&#39;, &#39;OK&#39;],
                defaultButton: &#39;OK&#39;
            }})
            response.textReturned
        &#39;&#39;&#39;.format(**d)]).decode(&#39;ascii&#39;).rstrip()
        if user_input == &#39;&#39;:
            sys.exit()
        return user_input
    except subprocess.CalledProcessError:
        pass


# Display a macOS specific prompt dialog prompting user for a choice from a list
def prompt_selection(prompt_text=&#39;&#39;, choices=&#39;&#39;):
    try:
        d = locals()
        user_selection = subprocess.check_output([&#39;osascript&#39;, &#39;-l&#39;, &#39;JavaScript&#39;, &#39;-e&#39;, &#39;&#39;&#39;
            const app = Application.currentApplication()
            app.includeStandardAdditions = true
            var choices = {choices}
            const response = app.chooseFromList(choices, {{
                withPrompt: &#39;{prompt_text}&#39;,
                defaultItems: [choices[0]]
            }})
            response
        &#39;&#39;&#39;.format(**d)]).decode(&#39;ascii&#39;).rstrip()
        if user_selection == &#39;false&#39;:
            sys.exit()
        return user_selection
    except subprocess.CalledProcessError:
        pass


# Display a macOS specific notification
def notify(text, title, subtitle, sound=&#39;Glass&#39;):
    cmd = &#39;osascript -e \&#39;display notification &#34;{}&#34; with title &#34;{}&#34; subtitle &#34;{}&#34; sound name &#34;{}&#34;\&#39;&#39;
    os.system(cmd.format(text, title, subtitle, sound))
# ---------------------------------------------------------------------------------------------------------------------


# Methods to read, write, remove data from the hidden .db file --------------------------------------------------------
def read_data_file(data_file):
    with open(data_file, &#39;r&#39;) as f:
        content = f.readlines()
    f.close()
    content = [x.strip() for x in content]
    return content


def write_data_file(data_file, imit_type, symbol, price):
    with open(data_file, &#39;a&#39;) as f:
        f.write(limit_type &#43; &#39; &#39; &#43; symbol &#43; &#39; &#39; &#43; price &#43; &#39;\n&#39;)
    f.close()


def remove_line_from_data_file(data_file, line_to_be_removed):
    with open(data_file, &#39;r&#39;) as f:
        content = f.readlines()
    with open(data_file, &#39;w&#39;) as f:
        for line in content:
            if line.strip(&#39;\n&#39;) != line_to_be_removed:
                f.write(line)
    f.close()
# ---------------------------------------------------------------------------------------------------------------------


# Curl the yahoo api for data
def get_stock_data(symbol):
    # Building the curl command as a string
    library = &#39;curl --silent &#39;
    api = &#39;https://query1.finance.yahoo.com/v7/finance/quote?&#39;
    fields = [&#39;symbol&#39;, &#39;marketState&#39;, &#39;regularMarketTime&#39;, &#39;regularMarketPrice&#39;, &#39;regularMarketChangePercent&#39;,
              &#39;fullExchangeName&#39;, &#39;currency&#39;, &#39;regularMarketPreviousClose&#39;, &#39;regularMarketOpen&#39;, &#39;bid&#39;, &#39;ask&#39;,
              &#39;regularMarketDayRange&#39;, &#39;fiftyTwoWeekRange&#39;, &#39;fiftyDayAverage&#39;, &#39;twoHundredDayAverage&#39;, &#39;shortName&#39;,
              &#39;fiftyDayAverageChangePercent&#39;, &#39;twoHundredDayAverageChangePercent&#39;]
    fields_string = &#39;fields=&#39; &#43; &#39;,&#39;.join(fields)
    cmd = library &#43; &#34;&#39;&#34; &#43; api &#43; fields_string &#43; &#39;&amp;symbols=&#39; &#43; symbol &#43; &#34;&#39;&#34;

    # Popen to run the curl command and retrieve the output
    output = os.popen(cmd).read()
    # Jsonify the output from the curl command
    json_output = json.loads(output)

    # Check if a valid symbol was used
    try:
        stock_data = json_output[&#39;quoteResponse&#39;][&#39;result&#39;][0]
    except IndexError:
        alert(&#39;Error&#39;, &#39;Invalid stock symbol: &#39; &#43; symbol)
        sys.exit()

    return stock_data


# Check a given stock symbol against the price limit list
def check_price_limits(symbol_to_be_checked, current_price, price_limit_list, data_file):
    for limit_entry in price_limit_list:
        if symbol_to_be_checked in limit_entry:
            # Get the limit price, limits are saved in the format: TYPE SYMBOL PRICE
            limit_price = float(limit_entry.split()[2])
            notification_text = &#39;Current price is: &#39; &#43; str(current_price)
            notification_title = &#39;Price Alarm&#39;

            # Notify user if current price is lower than the BUY limit, then remove the limit from list
            if &#39;BUY&#39; in limit_entry and current_price &lt; limit_price:
                notification_subtitle = &#39;BUY Limit: &#39; &#43; str(limit_price)
                notify(notification_text, notification_title, notification_subtitle)
                remove_line_from_data_file(data_file, limit_entry)

            # Notify user if current price is higher than the SELL limit, then remove the limit from list
            if &#39;SELL&#39; in limit_entry and current_price &gt; limit_price:
                notification_subtitle = &#39;SELL Limit: &#39; &#43; str(limit_price)
                notify(notification_text, notification_title, notification_subtitle)
                remove_line_from_data_file(data_file, limit_entry)


# Print the indices information in the menu bar
def print_index(index, name):
    market_state = index[&#39;marketState&#39;]
    change = index[&#39;regularMarketChangePercent&#39;]

    # Setting color and emojis depending on the market state and the market change
    if market_state != &#39;REGULAR&#39;:
        # Set change with a moon emoji for closed markets
        colored_change = &#39;ðŸŒ›&#39; &#43; &#39;(&#39; &#43; &#39;{:.2f}&#39;.format(change) &#43; &#39;%) &#39;
    if market_state == &#39;REGULAR&#39;:
        # Set color for positive and negative values
        color = &#39;&#39;
        if change &gt; 0:
            color = GREEN &#43; &#39;â–²&#39;
        if change &lt; 0:
            color = RED &#43; &#39;â–¼&#39;
        # Format change to decimal with a precision of two and reset ansi color at the end
        colored_change = color &#43; &#39;(&#39; &#43; &#39;{:.2f}&#39;.format(change) &#43; &#39;%) &#39; &#43; RESET

    # Print the index info only to the menu bar
    print(name, colored_change, &#39;| dropdown=false&#39;, sep=&#39; &#39;)


# Print the stock info in the dropdown menu with additional info in the submenu
def print_stock(s):
    market_state = s[&#39;marketState&#39;]
    change = s[&#39;regularMarketChangePercent&#39;]

    # Setting color and emojis depending on the market state and the market change
    if market_state != &#39;REGULAR&#39;:
        market = &#39;CLOSED&#39;
        # Set change with a moon emoji for closed markets
        colored_change = &#39;ðŸŒ›&#39; &#43; &#39;(&#39; &#43; &#39;{:.2f}&#39;.format(change) &#43; &#39;%) &#39;
    if market_state == &#39;REGULAR&#39;:
        # Set color for positive and negative values
        color = &#39;&#39;
        market = &#39;OPEN&#39;
        if change &gt; 0:
            color = GREEN &#43; &#39;â–²&#39;
        if change &lt; 0:
            color = RED &#43; &#39;â–¼&#39;
        # Format change to decimal with a precision of two and reset ansi color at the end
        change_in_percent = &#39;(&#39; &#43; &#39;{:.2f}&#39;.format(change) &#43; &#39;%)&#39;
        colored_change = color &#43; change_in_percent &#43; RESET

    # Remove appending stock exchange symbol for foreign exchanges, e.g. Apple stock symbol in Frankfurt: APC.F -&gt; APC
    symbol = s[&#39;symbol&#39;].split(&#39;.&#39;)[0]
    # Convert epoch to human readable time HH:MM:SS
    time = datetime.fromtimestamp(s[&#39;regularMarketTime&#39;]).strftime(&#39;%X&#39;)
    # Convert float values to decimals with a precision of two
    fifty_day = &#39;{:.2f}&#39;.format(s[&#39;fiftyDayAverage&#39;])
    two_hundred_day = &#39;{:.2f}&#39;.format(s[&#39;twoHundredDayAverage&#39;])
    fifty_day_change = &#39;(&#39; &#43; &#39;{:.2f}&#39;.format(s[&#39;fiftyDayAverageChangePercent&#39;] * 100) &#43; &#39;%)&#39;
    two_hundred_day_change = &#39;(&#39; &#43; &#39;{:.2f}&#39;.format(s[&#39;twoHundredDayAverageChangePercent&#39;] * 100) &#43; &#39;%)&#39;

    # Print the stock info seen in the dropdown menu
    stock_info = &#39;{:&lt;5} {:&gt;10} {:&lt;10}&#39; &#43; FONT
    print(stock_info.format(symbol, s[&#39;regularMarketPrice&#39;], colored_change))
    # Print additional stock info in the submenu
    stock_submenu = &#39;{:&lt;17} {:&lt;17}&#39; &#43; FONT
    print(&#39;--&#39; &#43; s[&#39;shortName&#39;] &#43; FONT)
    print(&#39;--&#39; &#43; s[&#39;fullExchangeName&#39;] &#43; &#39; - Currency in &#39; &#43; s[&#39;currency&#39;] &#43; FONT)
    print(&#39;--&#39; &#43; time &#43; &#39; - Market is &#39; &#43; market &#43; FONT)
    print(&#39;-----&#39;)
    print(stock_submenu.format(&#39;--Previous Close:&#39;, s[&#39;regularMarketPreviousClose&#39;]))
    print(stock_submenu.format(&#39;--Open:&#39;, s[&#39;regularMarketOpen&#39;]))
    print(stock_submenu.format(&#39;--Bid:&#39;, s[&#39;bid&#39;]))
    print(stock_submenu.format(&#39;--Ask:&#39;, s[&#39;ask&#39;]))
    print(stock_submenu.format(&#34;--Day&#39;s Range:&#34;, s[&#39;regularMarketDayRange&#39;]))
    print(stock_submenu.format(&#39;--52 Week Range:&#39;, s[&#39;fiftyTwoWeekRange&#39;]))
    print(stock_submenu.format(&#39;--50 MA:&#39;, fifty_day &#43; &#39; &#39; &#43; fifty_day_change))
    print(stock_submenu.format(&#39;--200 MA:&#39;, two_hundred_day &#43; &#39; &#39; &#43; two_hundred_day_change))


# Print the price limits in the dropdown menu
def print_price_limits(price_limit_list):
    PARAMETERS = FONT &#43; &#34; refresh=true terminal=&#39;false&#39; bash=&#39;&#34; &#43; __file__ &#43; &#34;&#39;&#34;

    print(&#39;---&#39;)
    print(&#39;Price Limits&#39; &#43; FONT)
    # Print available price limits in the submenu
    for limit_entry in price_limit_list:
        # Split the limit entry, limits are saved in the format: TYPE SYMBOL PRICE
        limit_type = limit_entry.split()[0]
        symbol = limit_entry.split()[1]
        limit_price = limit_entry.split()[2]
        price_limit_submenu = &#39;{:&lt;6} {:&lt;4} {:&lt;10}&#39;
        # Print the price limit data into the submenu
        # onClick will rerun this script with parameters &#39;remove&#39; and the {limit_entry} to remove clicked the limit
        print(price_limit_submenu.format(&#39;--&#39; &#43; limit_type, symbol, limit_price &#43; PARAMETERS &#43; &#34; param1=&#39;remove&#39; param2=&#39;&#34; &#43; limit_entry &#43; &#34;&#39;&#34;))
    print(&#39;-----&#39;)
    print(&#39;--To remove a limit, click on it.&#39; &#43; FONT)
    # Print the clickable fields to set new limits or clear all price limits
    # onClick will rerun this script with parameters &#39;set&#39; to set a new limit
    print(&#39;Set new Price Limit...&#39; &#43; PARAMETERS &#43; &#34; param1=&#39;set&#39;&#34;)
    # onClick will rerun this script with parameters &#39;clear&#39; to clear the hidden .db file
    print(&#39;Clear all Price Limits...&#39; &#43; PARAMETERS &#43; &#34; param1=&#39;clear&#39;&#34;)


if __name__ == &#39;__main__&#39;:
    data_file = os.path.join(os.path.dirname(os.path.realpath(__file__)), &#39;.&#39; &#43; os.path.basename(__file__) &#43; &#39;.db&#39;)

    # Normal execution by BitBar without any parameters
    if len(sys.argv) == 1:
        stocks = []

        # Check if hidden .db file exists
        try:
            price_limit_list = read_data_file(data_file)
        except FileNotFoundError:
            price_limit_list = []

        # Print the menu bar information
        for symbol, name in indices_dict.items():
            # For each symbol: curl the data, then print it
            index = get_stock_data(symbol)
            print_index(index, name)

        # For each symbol: curl the data, check against the .db file for limits
        for symbol in symbols:
            stock = get_stock_data(symbol)
            stocks.append(stock)
            check_price_limits(symbol, stock[&#39;regularMarketPrice&#39;], price_limit_list, data_file)

        # Set order of stocks
        if sort_by == &#39;name&#39;:
            stocks = sorted(stocks, key=lambda k: k[&#39;shortName&#39;])
        if sort_by == &#39;market_change_winners&#39;:
            stocks = sorted(stocks, key=lambda k: k[&#39;regularMarketChangePercent&#39;], reverse=True)
        if sort_by == &#39;market_change_losers&#39;:
            stocks = sorted(stocks, key=lambda k: k[&#39;regularMarketChangePercent&#39;])
        if sort_by == &#39;market_change_volatility&#39;:
            stocks = sorted(stocks, key=lambda k: abs(k[&#39;regularMarketChangePercent&#39;]), reverse=True)

        # Print the stock information inside the dropdown menu
        print(&#39;---&#39;)
        for stock in stocks:
            print_stock(stock)

        # Print the price limit section inside the dropdown
        print_price_limits(price_limit_list)

    # Script execution with parameter &#39;set&#39; to set new price limits
    if len(sys.argv) == 2 and sys.argv[1] == &#39;set&#39;:
        # Run this until user does not want to continue
        while True:
            # Get the user selection of whether he wants to set &#39;BUY&#39; or &#39;SELL&#39;
            limit_type_prompt = &#39;Select the type of your limit: BUY (SELL) limits are triggered, when the price is lower (higher) than the limit.&#39;
            limit_type_choices = &#39;[&#34;BUY&#34;, &#34;SELL&#34;]&#39;
            limit_type = prompt_selection(limit_type_prompt, limit_type_choices)

            # Get the user selection of all tracked symbols
            symbol = prompt_selection(&#39;Select stock symbol:&#39;, symbols)

            # Get the user input for a price limit, info message includes the current market price
            price = prompt(&#39;Current price of &#39; &#43; symbol &#43; &#39; is &#39; &#43; str(get_stock_data(symbol)[&#39;regularMarketPrice&#39;]) &#43; &#39;. Enter a value for your price limit.&#39;)
            # Check if the user input are decimals with a precision of two
            if not re.match(r&#39;^\d&#43;(\.\d{1,2})?$&#39;, price):
                # Alert the user on invalid value and stop the script
                alert(&#39;Error&#39;, &#39;You entered an invalid value: &#39; &#43; price &#43; &#39; - valid values are decimals with a precision of 2, e.g 25.70!&#39;)
                sys.exit()

            # Write the limit to the hidden .db file
            write_data_file(data_file, limit_type, symbol, price)

            # Ask user if he wants to add another limit
            add_another_limit = alert(&#39;Question&#39;, &#39;Do you want to add another price limit?&#39;, [&#39;No&#39;, &#39;Yes&#39;])
            # If the user clicked the &#39;No&#39; button, stop the script
            if add_another_limit is None:
                sys.exit()

    # Script execution with parameter &#39;clear&#39; to clear the .db file
    if len(sys.argv) == 2 and sys.argv[1] == &#39;clear&#39;:
        # Ask for user confirmation
        warning = alert(&#39;Warning&#39;, &#39;This will clear your price limits! Do you want to continue?&#39;)
        if warning is None:
            sys.exit()

        # Clear the file
        open(data_file, &#39;w&#39;).close()

    # Script execution with the parameters &#39;remove&#39; and the line to be removed
    if len(sys.argv) == 3 and sys.argv[1] == &#39;remove&#39;:
        limit_to_be_removed = sys.argv[2]
        remove_line_from_data_file(data_file, limit_to_be_removed)
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						â€¢
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors â€¢ <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
