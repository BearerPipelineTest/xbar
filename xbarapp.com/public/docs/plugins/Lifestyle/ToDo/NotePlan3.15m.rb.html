
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>Todo Today for NotePlan v3 in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='A todo list taken from NotePlan v3 and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo.NotePlan&#34; by Richard Guay which in turn was based on &#34;Todo Colour&#34; plugin by Srdgh. - install xbar for free to get started.'>
	<meta name='author' content='Jonathan Clark'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='https://noteplan.co/static/icon-aef6fdb335c829b1363315ef21c3146d.png'>
	<meta itemprop='name' content='Todo Today for NotePlan v3 in your macOS menu bar'>
	<meta itemprop='description' content='A todo list taken from NotePlan v3 and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo.NotePlan&#34; by Richard Guay which in turn was based on &#34;Todo Colour&#34; plugin by Srdgh. - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='Todo Today for NotePlan v3 in your macOS menu bar'>
	<meta name='twitter:description' content='A todo list taken from NotePlan v3 and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo.NotePlan&#34; by Richard Guay which in turn was based on &#34;Todo Colour&#34; plugin by Srdgh. - install xbar for free to get started.'>
	<meta name='twitter:image' content='https://noteplan.co/static/icon-aef6fdb335c829b1363315ef21c3146d.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='Todo Today for NotePlan v3 in your macOS menu bar'>
	<meta property='og:description' content='A todo list taken from NotePlan v3 and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo.NotePlan&#34; by Richard Guay which in turn was based on &#34;Todo Colour&#34; plugin by Srdgh. - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Lifestyle/ToDo/NotePlan3.15m.rb.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='https://noteplan.co/static/icon-aef6fdb335c829b1363315ef21c3146d.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='https://noteplan.co/static/icon-aef6fdb335c829b1363315ef21c3146d.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='https://noteplan.co/static/icon-aef6fdb335c829b1363315ef21c3146d.png'>
	<link rel='shortcut icon' href='https://noteplan.co/static/icon-aef6fdb335c829b1363315ef21c3146d.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>💜</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>Todo Today for NotePlan v3</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/jgclark.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/1671754?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/jgclark.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Jonathan Clark (<code style='color:white;'>@jgclark</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						A todo list taken from NotePlan v3 and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo.NotePlan&#34; by Richard Guay which in turn was based on &#34;Todo Colour&#34; plugin by Srdgh.
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Lifestyle%2fToDo%2fNotePlan3.15m.rb'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>🖥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='https://noteplan.co/static/icon-aef6fdb335c829b1363315ef21c3146d.png' 
				alt='Image preview of Todo Today for NotePlan v3 plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>NotePlan3.15m.rb</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Lifestyle/ToDo/NotePlan3.15m.rb'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Lifestyle/ToDo/NotePlan3.15m.rb'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env ruby
# coding: utf-8

# &lt;bitbar.title&gt;Todo Today for NotePlan v3&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v2.2&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Jonathan Clark&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;jgclark&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;A todo list taken from NotePlan v3 and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo.NotePlan&#34; by Richard Guay which in turn was based on &#34;Todo Colour&#34; plugin by Srdgh.&lt;/bitbar.desc&gt;
# &lt;bitbar.dependencies&gt;ruby&lt;/bitbar.dependencies&gt;
# &lt;bitbar.image&gt;https://noteplan.co/static/icon-aef6fdb335c829b1363315ef21c3146d.png&lt;/bitbar.image&gt;
# &lt;bitbar.abouturl&gt;https://noteplan.co/&lt;/bitbar.abouturl&gt;
#
# Modifications by Jonathan Clark
#   v2.2, 2021/01/29:
#     - tweak default &#39;priority_label&#39; to suit planned change in NP3
#   v2.1, 2020/11/29:
#     - auto-detect storage type (CloudKit &gt; iCloud Drive &gt; Drobpox if there are multiple)
#     - add option to specify the file extension in use (default to md, but can be txt)
#   v2.0, 2020/10/30:
#     - Update NP data storage filepaths for NotePlan 3 beta
#       (including CloudKit change at v3.0.15 beta)
#     - Make CloudKit location the default
#     - tweak colours and falgs to suit my needs
#     - ignore tasks with dates scheduled into the future
#     - improve some non-tasks it was including
#     - code clean up
#
# Modifications by Guillaume Barrette
#   2017/07/01:
#     - Added option to show subtasks
#   2017/06/15:
#     - Changed TRUE/FALSE constant to true/false since uppercase are deprecated in ruby 2.4
#     - Changed labels to start with &#39;#&#39; to follow NotePlan way of tagging
#     - Allow to change Fonts by the user
#     - Added a new parameter for users to specify if want the task to be archived
#       at the end of the file or not
#     - Added alternate action to mark as cancelled instead of done (using the
#       Option modifier key)
#     - Allow indentation at beginning of task
#   2017/06/03:
#     - Added &#39;divide_with_header&#39; to allow to show sections separated by headers
#     - Updated the algorithm to skip all items that are not a task (Skip anything that
#       doesn&#39;t starts with &#39;- &#39; or &#39;* &#39; and if followed by [x], [&gt;], [-])
#   2017/05/28:
#     - Fixed the line number of item to mark as done by getting the id before stripping
#       the lines that are not a task
#     - Scheduled task (to another day - [&gt;]) are now skipped also
#   2017/05/20:
#     - Added Black and White NotePlan menubar icon
#     - Repaired a bug when there was no newline on the last line the done task would
#       get appended to the last line instead of a new line at the end
#     - Added the time in the @done(YYYY-MM-DD HH:MM) so it&#39;s like NotePlan preference
#     - Added User Parameters so it&#39;s easy to determine if we want to append the
#       @done(...) string at the end of the done task and if we want the black or white
#       menubar icon
#     - Changed the menubar icon to a templateImage so the color changes automatically
#       when using a dark menubar (removed the white icon)
#     - Removed &#39;use_black_icon&#39; parameters since now it&#39;s automatic
#     - Changed encoding method and removed the use of &#39;force_encoding(&#34;utf-8&#34;)&#39;
#     - Repaired a bug if there was no file already created for that day in NotePlan
#
# Modifications by Richard Guay
#   2017/05/20:
#       - Added using emoji option
#       - fixed character encoding on removing an item
#       - Proper parsing of [ ] in the todo.
#       - cleanup
require &#39;date&#39;

#################################
# User Parameters:
insert_date_on_done_task = true  # If true, the date would be inserted with the @done tag
use_emoji_as_icon = false        # If true, will show emoji, otherwise it will use the black or white icon.
use_star = true                  # if true, will look for and use &#39;*&#39; instead of &#39;-&#39;
show_alt_task = true             # If true, tasks marked with the alternate character (&#39;* &#39; if use_star is FALSE or &#39;- &#39; if use_star is TRUE) would be shown in the task list. For example, this could be useful to use them as bullet list.
show_subtasks = true             # If true, subtasks would be shown in the list
divide_with_header = true        # If true, headers would be listed and a separator is put between lists
archive_task_at_end = false      # If true, the task would get archived to the end of the note
file_extension = &#39;.md&#39;           # Defaults to file extension type &#39;md&#39; -- can change to &#39;.txt&#39;
priority_labels = [&#39;@urgent&#39;, &#39;#high&#39;, &#39;#⭐️&#39;]
priority_marker = &#39;⭐&#39;
standard_font = &#39;&#39;               # Font used for tasks
header_font   = &#39;Helvetica-Bold&#39; # Font used for headers if listed with &#39;divide_with_header&#39;
#################################

Encoding.default_internal = Encoding::UTF_8
Encoding.default_external = Encoding::UTF_8

USERNAME = ENV[&#39;LOGNAME&#39;] # pull username from environment
USER_DIR = ENV[&#39;HOME&#39;] # pull home directory from environment
DROPBOX_DIR = &#34;#{USER_DIR}/Dropbox/Apps/NotePlan/Documents&#34;.freeze
ICLOUDDRIVE_DIR = &#34;#{USER_DIR}/Library/Mobile Documents/iCloud~co~noteplan~NotePlan/Documents&#34;.freeze
CLOUDKIT_DIR = &#34;#{USER_DIR}/Library/Containers/co.noteplan.NotePlan3/Data/Library/Application Support/co.noteplan.NotePlan3&#34;.freeze
data_root_filepath = DROPBOX_DIR if Dir.exist?(DROPBOX_DIR) &amp;&amp; Dir[File.join(DROPBOX_DIR, &#39;**&#39;, &#39;*&#39;)].count { |file| File.file?(file) } &gt; 1
data_root_filepath = ICLOUDDRIVE_DIR if Dir.exist?(ICLOUDDRIVE_DIR) &amp;&amp; Dir[File.join(ICLOUDDRIVE_DIR, &#39;**&#39;, &#39;*&#39;)].count { |file| File.file?(file) } &gt; 1
data_root_filepath = CLOUDKIT_DIR if Dir.exist?(CLOUDKIT_DIR) &amp;&amp; Dir[File.join(CLOUDKIT_DIR, &#39;**&#39;, &#39;*&#39;)].count { |file| File.file?(file) } &gt; 1

todo_file_loc = File.expand_path(data_root_filepath &#43; &#39;/Calendar/&#39; &#43; Date.today.strftime(&#39;%Y%m%d&#39;) &#43; file_extension)

if ARGV.empty?
  # Customise label color-code here:
  labels = {
    &#39;@admin&#39; =&gt; &#39;orange&#39;,
    &#39;@liz&#39; =&gt; &#39;yellow&#39;,
    &#39;@home&#39; =&gt; &#39;green&#39;,
    &#39;@martha&#39; =&gt; &#39;purple&#39;, # pink is too light
    &#39;@Health&#39; =&gt; &#39;cadetblue&#39;,
    &#39;@church&#39; =&gt; &#39;blue&#39;, # lightblue is too light
    &#39;@tutorials&#39; =&gt; &#39;violet&#39;,
    &#39;@Envato&#39; =&gt; &#39;darkorange&#39;,
    &#39;@workflow&#39; =&gt; &#39;purple&#39;,
    &#39;@tutorial&#39; =&gt; &#39;cobaltblue&#39;
  }

  lines_in_file = File.exist?(todo_file_loc.to_s) ? IO.readlines(todo_file_loc.to_s) : []
  lines = []

  # Remove all lines that are not a todo. Stop at the first empty line.
  line_number = []
  line_number_id = 0
  task_style_to_search = show_alt_task ? [&#39;- &#39;, &#39;* &#39;] : use_star ? [&#39;* &#39;] : [&#39;- &#39;]
  lines_in_file.each_index do |key|
    # Clean out leading and trailing white spaces (space, tabs, etc)
    line = lines_in_file[key].gsub(/\s&#43;$/, &#39;&#39;)
    task_line = show_subtasks ? line.gsub(/^\s&#43;/, &#39;&#39;) : line
    if task_line.start_with?(*task_style_to_search) &amp;&amp; !task_line[2..4].start_with?(&#39;[x]&#39;, &#39;[&gt;]&#39;, &#39;[-]&#39;)  # Get only active Task items
      # Now check if doesn&#39;t have a &gt;YYYY-MM-DD that schedules it into the future
      break if task_line =~ /\s&gt;\d{4}\-\d{2}\-\d{2}/

      # It&#39;s a todo line to display. Remove the leading task marker and add to the list.
      if use_star
        lines.push(line.gsub(/^(\s*)\*\s*(\[ \]\s*)*/, &#39;\1&#39;))
      else
        lines.push(line.gsub(/^(\s*)\-\s*(\[ \]\s*)*/, &#39;\1&#39;))
      end
      line_number.push(line_number_id)
    elsif divide_with_header &amp;&amp; line =~ /^#&#43;\s&#43;/ # i.e. this is a header line
      lines.push(line)
      line_number.push(line_number_id)
    end
    line_number_id &#43;= 1
  end

  # Give the header. It&#39;s the NotePlan icon or an emoji briefcase with the number of items todo
  icon_base64 = &#39;iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAQAAAACj/OVAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAHdElNRQfkChwAHRNqrC5wAAABSElEQVRYw2NgGAWjYBRQCXAy8AIxnYAxw384NKKHhf9R4KiFoxYOpIXGDPxkWsjFYEKqZQ5Q476QYSFMRpfcYJtDgoU3yQvuZ2iG/mfwIsLCBgxdl8hLFhD4h0EMj4VKWPX8p8RCEHzPwILVwv84IZGgHY8RG9H4t/GodSU&#43;FmPwGEMsVCI1axygwLIF5Gb&#43;V2RY9oGy8oaV4R9J1rFQo5BLIdIyR2qWrBcJWLaL2nXELwIWnqCmZROJDNIsalgmT1KS&#43;cMgTIllzCSmUAh8A0zZZIEXFGT8Y6Ra1kCFoq2IeOt24DEG3Skb8Khtprx6wlYfMjJ8pbR6wq8Zm6gwZRZextCoRUQTwx1D113yGlGrSWhEbSG3zapOQTPxO1RGhdSsIUd2y5uNQWa0bzFq4ciyMAjJOnF6jdXYMrgwmI6Oj42CUUAVAABntNYrW391eQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMC0xMC0yOFQwMDoyOToxOSswMDowMDOfhXoAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjAtMTAtMjhUMDA6Mjg6MjMrMDA6MDCH/w5VAAAAAElFTkSuQmCC&#39;

  line_count = 0
  lines.each { |line|  line_count &#43;= 1 unless line.start_with?(&#39;#&#39;) }
  if use_emoji_as_icon
    puts &#34;💼#{line_count}&#34;
  else
    puts &#34;#{line_count} |templateImage=#{icon_base64}&#34;
  end

  puts &#39;---&#39;

  cfn = File.expand_path(__FILE__)

  # Create the list of items to do in the menu.
  item_number = 0
  lines.each do |item|
    line_color = &#39;&#39;
    line = item.chomp
    if priority_labels.any? { |s| line.include? s }
      # If line contains priority label, display in priority color
      # line_color = priority_color
      # If line contains priority label, prefix item with priority_marker
      line = priority_marker &#43; &#39; &#39; &#43; line
    else
      # If line contains no priority label, cycle through labels hash,
      # and if line contains a label display in corresponding color
      labels.each { |label, label_color| line_color = label_color if line.include?(label) }
    end
    # If the line contains no label, display in default color. Otherwise, in
    # chosen color. Clicking line launches this script with line number as
    # the parameter.
    line_font = standard_font
    if line.start_with?(&#39;#&#39;)
      puts(&#39;---&#39;) unless line.start_with?(&#39;##&#39;)
      line_font = header_font
    end
    line_params = &#34;#{line_color.empty? ? &#39;&#39; : &#39;color=&#39; &#43; line_color} #{line_font.empty? ? &#39;&#39; : &#39;font=&#39; &#43; line_font} bash=&#39;#{cfn}&#39; param1=#{line_number[item_number]}&#34;
    puts(&#34;#{line} | &#34; &#43; line_params &#43; &#34; param2=x terminal=false trim=false refresh=\n&#34;)
    puts(&#34;#{line} | alternate=true &#34; &#43; line_params &#43; &#34; param2=- terminal=false trim=false refresh=\n&#34;)
    item_number &#43;= 1
  end
  puts &#39;---&#39;
  puts &#34;Click an item to mark as &#39;done&#39;&#34;
  puts &#34;Click an item to mark as &#39;cancelled&#39; | alternate=true&#34;
  puts &#39;Refresh now (normally every 15m) | refresh=&#39;
else
  # This is what to do when clicking on an item. We want to move
  # the item to the Archive section and set it as done. If there
  # isn&#39;t an Archive area, create it and add the task to it.

  # Get the task number to archive.
  do_num = ARGV[0].to_i
  mark = ARGV[1]

  # Get the list of todos and setup variables
  todo_file = File.open(todo_file_loc.to_s)
  lines_in_file = IO.readlines(todo_file)

  unless lines_in_file[do_num].start_with?(&#39;#&#39;) # Do nothing if the item is a header
    task = &#39;&#39;
    lines = []
    line_number = 0

    lines_in_file[-1] = lines_in_file[-1] &#43; &#34;\n&#34; unless lines_in_file[-1].include? &#34;\n&#34;

    # Process the todo list lines
    lines_in_file.each do |line|
      if line_number != do_num
        # It is one of the other lines. Just push it into the stack
        lines.push(line)
      else
        # Get the line to be moved to the archive area
        task = if insert_date_on_done_task
                 line.chomp &#43; (mark == &#39;x&#39; ? &#34; @done(#{Time.new.strftime(&#39;%Y-%m-%d %H:%M&#39;)})\n&#34; : &#34;\n&#34;)
               else
                 task = line.chomp &#43; &#34;\n&#34;
               end
        task = task.gsub(/^(\s*)([\-\*]&#43;)\s*(\[ \]\s*)*/, &#39;\1\2 [&#39; &#43; mark &#43; &#39;] &#39;) # Works with both task style, useful if mix with &#39;show_alt_task&#39;, also it keeps the indentation at beginning of the line
        lines.push(task) if archive_task_at_end
      end
      line_number &#43;= 1
    end

    # Add the task to the bottom
    lines.push(task) if archive_task_at_end

    # Save the file
    IO.write(todo_file, lines.join)
  end
end
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						•
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors • <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
