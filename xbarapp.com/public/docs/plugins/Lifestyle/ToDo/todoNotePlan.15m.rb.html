
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>NotePlan Todo in Colour in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='A todo list taken from NotePlan and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo Colour&#34; plugin by Srdgh. - install xbar for free to get started.'>
	<meta name='author' content='Richard Guay'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='http://customct.com/images/NotePlanPlugin-01.png'>
	<meta itemprop='name' content='NotePlan Todo in Colour in your macOS menu bar'>
	<meta itemprop='description' content='A todo list taken from NotePlan and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo Colour&#34; plugin by Srdgh. - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='NotePlan Todo in Colour in your macOS menu bar'>
	<meta name='twitter:description' content='A todo list taken from NotePlan and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo Colour&#34; plugin by Srdgh. - install xbar for free to get started.'>
	<meta name='twitter:image' content='http://customct.com/images/NotePlanPlugin-01.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='NotePlan Todo in Colour in your macOS menu bar'>
	<meta property='og:description' content='A todo list taken from NotePlan and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo Colour&#34; plugin by Srdgh. - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Lifestyle/Todo/todoNotePlan.15m.rb.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='http://customct.com/images/NotePlanPlugin-01.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='http://customct.com/images/NotePlanPlugin-01.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='http://customct.com/images/NotePlanPlugin-01.png'>
	<link rel='shortcut icon' href='http://customct.com/images/NotePlanPlugin-01.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>ðŸ’œ</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>NotePlan Todo in Colour</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/raguay.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/2487495?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/raguay.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Richard Guay (<code style='color:white;'>@raguay</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						A todo list taken from NotePlan and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo Colour&#34; plugin by Srdgh.
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Lifestyle%2fTodo%2ftodoNotePlan.15m.rb'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>ðŸ–¥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='http://customct.com/images/NotePlanPlugin-01.png' 
				alt='Image preview of NotePlan Todo in Colour plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>todoNotePlan.15m.rb</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Lifestyle/Todo/todoNotePlan.15m.rb'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Lifestyle/Todo/todoNotePlan.15m.rb'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env ruby
# coding: utf-8

# &lt;bitbar.title&gt;NotePlan Todo in Colour&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.5&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Richard Guay&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;raguay&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;A todo list taken from NotePlan and displayed with customizable color-code. Mark tasks &#34;done&#34; simply by clicking on them in the menubar drop-down list. This was based on &#34;Todo Colour&#34; plugin by Srdgh.&lt;/bitbar.desc&gt;
# &lt;bitbar.dependencies&gt;ruby&lt;/bitbar.dependencies&gt;
# &lt;bitbar.image&gt;http://customct.com/images/NotePlanPlugin-01.png&lt;/bitbar.image&gt;
# &lt;bitbar.abouturl&gt;http://customct.com/bitbar&lt;/bitbar.abouturl&gt;
#
# Modifications by Guillaume Barrette
#   2017/07/01:
#     - Added option to show subtasks
#   2017/06/15:
#     - Changed TRUE/FALSE constant to true/false since uppercase are deprecated in ruby 2.4
#     - Changed labels to start with &#39;#&#39; to follow NotePlan way of tagging
#     - Allow to change Fonts by the user
#     - Added a new parameter for users to specify if want the task to be archived at the end of the file or not
#     - Added alternate action to mark as cancelled instead of done (using the Option modifier key)
#     - Allow indentation at beginning of task
#   2017/06/03:
#     - Added &#39;divide_with_header&#39; to allow to show sections separated by headers
#     - Updated the algorithm to skip all items that are not a task (Skip anything that doesn&#39;t starts with &#39;- &#39; or &#39;* &#39; and if followed by [x], [&gt;], [-])
#   2017/05/28:
#     - Fixed the line number of item to mark as done by getting the id before stripping the lines that are not a task
#     - Scheduled task (to another day - [&gt;]) are now skipped also
#   2017/05/20:
#     - Added Black and White NotePlan menubar icon
#     - Repaired a bug when there was no newline on the last line the done task would get appended to the last line instead of a new line at the end
#     - Added the time in the @done(YYYY-MM-DD HH:MM) so it&#39;s like NotePlan preference
#     - Added User Parameters so it&#39;s easy to determine if we want to append the @done(...) string at the end of the done task and if we want the black or white menubar icon
#     - Changed the menubar icon to a templateImage so the color changes automatically when using a dark menubar (removed the white icon)
#     - Removed &#39;use_black_icon&#39; parameters since now it&#39;s automatic
#     - Changed encoding method and removed the use of &#39;force_encoding(&#34;utf-8&#34;)&#39;
#     - Repaired a bug if there was no file already created for that day in NotePlan
#
# Modifications by Richard Guay
#   05/20/2017:
#       - Added using emoji option
#       - fixed character encoding on removing an item
#       - Proper parsing of [ ] in the todo.
#       - cleanup
require &#39;date&#39;

#################################
# User Parameters:
insert_date_on_done_task = true  # If true, the date would be inserted with the @done tag
use_emoji = false                # If true, will show emoji, otherwise it will use the black or white icon.
use_star = false                 # if true, will look for and use &#39;*&#39; instead of &#39;-&#39;
show_alt_task = true             # If true, tasks marked with the alternate character (&#39;* &#39; if use_star is FALSE or &#39;- &#39; if use_star is TRUE) would be shown in the task list. For example, this could be useful to use them as bullet list.
show_subtasks = true             # If true, subtasks would be shown in the list
divide_with_header = true        # If true, headers would be listed and a separator is put between lists
archive_task_at_end = false      # If true, the task would get archived to the end of the note
use_icloud = true                # If true, files will be checked from iCloud. Otherwise:
use_container = true             # If true and not iCloud, it will treat as MAS store version. Otherwise, it is non-MAS store version

standard_font = &#39;&#39;               # Font used for tasks
header_font   = &#39;Helvetica-Bold&#39; # Font used for headers if listed with &#39;divide_with_header&#39;
#################################

Encoding.default_internal = Encoding::UTF_8
Encoding.default_external = Encoding::UTF_8

todo_file_loc = &#39;&#39;
if use_icloud
  todo_file_loc = File.expand_path(&#39;~/Library/Mobile Documents/iCloud~co~noteplan~NotePlan/Documents/Calendar/&#39; &#43; Date.today.strftime(&#39;%Y%m%d&#39;) &#43; &#39;.txt&#39;)
else
  if use_container
    todo_file_loc = File.expand_path(&#39;~/Library/Containers/co.noteplan.NotePlan/Data/Library/Application Support/co.noteplan.NotePlan/Calendar/&#39; &#43; Date.today.strftime(&#39;%Y%m%d&#39;) &#43; &#39;.txt&#39;)
  else
    todo_file_loc = File.expand_path(&#39;~/Library/Application Support/co.noteplan/Calendar/&#39; &#43; Date.today.strftime(&#39;%Y%m%d&#39;) &#43; &#39;.txt&#39;)
  end
end

if ARGV.empty?
  #
  # Add further priority labels here
  #
  priority_labels = [&#39;@urgent&#39;, &#39;@due&#39;]

  #
  # Change priority color here
  #
  priority_color = &#39;red&#39;

  #
  # Customise label color-code here:
  #
  labels = {
    &#39;@Work&#39; =&gt; &#39;orange&#39;,
    &#39;@Play&#39; =&gt; &#39;yellow&#39;,
    &#39;@home&#39; =&gt; &#39;green&#39;,
    &#39;@daily&#39; =&gt; &#39;blue&#39;,
    &#39;@Health&#39; =&gt; &#39;cadetblue&#39;,
    &#39;@church&#39; =&gt; &#39;lightblue&#39;,
    &#39;@tutorials&#39; =&gt; &#39;violet&#39;,
    &#39;@Envato&#39; =&gt; &#39;darkorange&#39;,
    &#39;@workflow&#39; =&gt; &#39;purple&#39;,
    &#39;@tutorial&#39; =&gt; &#39;cobaltblue&#39;
  }

  linesInFile = File.exist?(todo_file_loc.to_s) ? IO.readlines(todo_file_loc.to_s) : []
  lines = []

  #
  # Remove all lines that are not a todo. Stop at the first empty line.
  #
  line_number = []
  line_number_id = 0
  taskStyleToSearch = (show_alt_task) ? [&#39;- &#39;, &#39;* &#39;] : (use_star) ? [&#39;* &#39;] : [&#39;- &#39;]
  linesInFile.each_index do |key|
    #
    # Clean out leading and trailing white spaces (space, tabs, etc)
    #
    line = linesInFile[key].gsub(/\s&#43;$/, &#39;&#39;)
    taskLine = show_subtasks ? line.gsub(/^\s&#43;/, &#39;&#39;) : line
    if (taskLine.start_with?(*taskStyleToSearch)) &amp;&amp; (!taskLine[2..4].start_with?(&#39;[x]&#39;, &#39;[&gt;]&#39;, &#39;[-]&#39;))  # Get only active Task items
      #
      # It&#39;s a todo line to display. Remove the leading &#39;-&#39; and add
      # to the list.
      #
      if use_star
        lines.push(line.gsub(/^(\s*)\*\s*(\[ \]\s*)*/, &#39;\1&#39;))
      else
        lines.push(line.gsub(/^(\s*)\-\s*(\[ \]\s*)*/, &#39;\1&#39;))
      end
      line_number.push(line_number_id)
    elsif divide_with_header &amp;&amp; line.start_with?(&#39;#&#39;)
      lines.push(line)
      line_number.push(line_number_id)
    end
    line_number_id &#43;= 1
  end

  #
  # Give the header. It&#39;s the NotePlan icon or an emoji briefcase with the number of items todo
  #
  iconBase64 = &#39;iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAViAAAFYgBxNdAoAAABCRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIgogICAgICAgICAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyI&#43;CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ&#43;CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjU8L3RpZmY6Q29tcHJlc3Npb24&#43;CiAgICAgICAgIDx0aWZmOlhSZXNvbHV0aW9uPjE0MDwvdGlmZjpYUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24&#43;MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WVJlc29sdXRpb24&#43;MTQwPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24&#43;MzI8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjE8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgICAgPGRjOnN1YmplY3Q&#43;CiAgICAgICAgICAgIDxyZGY6QmFnLz4KICAgICAgICAgPC9kYzpzdWJqZWN0PgogICAgICAgICA8eG1wOk1vZGlmeURhdGU&#43;MjAxNzowNToyMCAwMDowNToyMDwveG1wOk1vZGlmeURhdGU&#43;CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w&#43;UGl4ZWxtYXRvciAzLjY8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24&#43;CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE&#43;CpI9t/8AAAPASURBVFgJtZdLSFRRGMfn/aJRZ5wITQwqCAkzUlrYJrGCLITIateiRbugh7iQCKqVm2pRywgLitBFtchFCVlERQshowckSIllIc44Os44r35nune4c71z5s5gB86c73W&#43;/3e&#43;851zz9gta9wCgUCj2&#43;0&#43;ZrVa51KpVBT3WRmEXaYsRxcMBtsBvgzwDebZnE5nq9frnYrH479lfhwypRmd3&#43;/f43A4&#43;rLZbJfNZnMwJuijSiAf8DEh82OTKUvovKR7AHAB1o1tbjGAjxBIMzI3dEcJH5aKAqihAT4MSB8AAiiHw5hC9pzxqJBBt4VCIb8siEoCcON4kN6lAqsA8K8ymUwdGdigyBooxC2q3mgsOwAW3w94tx4cmfD/BPAeVYfMAb/VCFiVlVWEpL2Zib0qgOqEMYXsNYBiC7Zp9WSkQWO3iiwrAzg&#43;B4BP9QJtQTZG3&#43;1yuQ4hXwVGAO2qvdFoOgBSvwnAI9rVQYvquxQOh8dnZ2eX0un0I0RJHVC1ji9gTQcAeBe9pmD2Pya3&#43;YJErwcX4jfip1gzVQOsvgUHZ7SrVxyCaR2gNk4r/C1Gp0LnBrvd/lXL6&#43;l89HqFyldXV&#43;&#43;jkh/Ah1SZwRhXZB6dLpFMJnctLi5&#43;0snzrDQDrHwnK7yPtQxcONMDi&#43;0QBfoecGkGitZAVVVVECeD9PX5cMskCOA2U9KyaUUDYO&#43;uAL7DYN9l/vI65k3wdRzKC4oQhjXA6g/ykXlaKThY4mLq4Xg&#43;LoKbFxu&#43;B7hURG1ElPRXsgUTgF/Ah/QxIqIw3IJoNPolEolc5EHRxk12ALuXwriMtoxtxoy99BTMzMzEcPKM05AgG2NmHGJnIWj1WJacYpgB/ayVlZVv7GlCL5fwUxJdgcpMAE6PxxNgVj89LFaobXpe0Y1rbWR0yQC4CU&#43;y&#43;ocU1TVutXbSeweHSwrwNPxd&#43;B9qINimkb2VgZrW1dfX&#43;9j/SV68vdpJ8NvpJ2prazcKOd&#43;CRuyGkGWhJxF5tfYyWlqEsVhsP9&#43;BzaxKvO/zjc9ujBU3kZXcRTM/P/8d5XGCOMsYpItTYKpJAyCVvwAawVOr1hu35CmCEi/hqxp5loCua3hTpLQGFhYW3uFF3GrTwpvP56sjzcOQ5wnuJqP0nhdzSjVpAEx20VvYhkXxvOZuF&#43;BNBPSCi&#43;peKedm9IVnSjdDfBGVB8VHtmIdwG5MDnMalvnM/tGZV8SWqgHxrLbQ9wL&#43;k7Fzbm5OFNyaNekW8AdTXMEp0Eb5g9EB&#43;Oc1QzbpyMFF1ImtqIX/0v4CwBRdmE9e8GAAAAAASUVORK5CYII=&#39;

  lineCount = 0
  lines.each { |line|  lineCount &#43;= 1 unless line.start_with?(&#39;#&#39;) }
  if use_emoji
    puts &#34;ðŸ’¼#{lineCount}&#34;
  else
    puts &#34;#{lineCount} |templateImage=#{iconBase64}&#34;
  end

  puts &#39;---&#39;

  cfn = File.expand_path(__FILE__)

  #
  # Create the list of items to do in the menu.
  #
  item_number = 0
  lines.each do |item|
    line_color = &#34;&#34;
    line = item.chomp
    if priority_labels.any? { |s| line.include? s }
      #
      # If line contains priority label, display in priority color
      #
      line_color = priority_color
    else
      #
      # If line contains no priority label, cycle through labels hash,
      # and if line contains a label display in corresponding color
      #
      labels.each { |label, label_color| line_color = label_color if line.include?(label) }
    end
    #
    # If the line contains no label, display in default color. Otherwise, in
    # chosen color. Clicking line launches this script with line number as
    # the parameter.
    #
    line_font = standard_font
    if line.start_with?(&#39;#&#39;)
      puts(&#39;---&#39;) unless line.start_with?(&#39;##&#39;)
      line_font = header_font
    end
    lineParams = &#34;#{line_color.empty? ? &#39;&#39; : &#39;color=&#39;&#43;line_color} #{line_font.empty? ? &#39;&#39; : &#39;font=&#39;&#43;line_font} bash=&#39;#{cfn}&#39; param1=#{line_number[item_number]}&#34;
    puts(&#34;#{line} | &#34; &#43; lineParams &#43; &#34; param2=x terminal=false trim=false refresh=\n&#34;)
    puts(&#34;#{line} | alternate=true &#34; &#43; lineParams &#43; &#34; param2=- terminal=false trim=false refresh=\n&#34;)
    item_number &#43;= 1
  end
  puts &#39;---&#39;
  puts &#34;Click an item to mark as &#39;done&#39;&#34;
  puts &#34;Click an item to mark as &#39;cancelled&#39; | alternate=true&#34;
  puts &#39;Refresh | refresh=&#39;
else
  #
  # This is what to do when clicking on an item. We want to move
  # the item to the Archive section and set it as done. If there
  # isn&#39;t an Archive area, create it and add the task to it.
  #
  # Get the task number to archive.
  #
  doNum = ARGV[0].to_i
  mark = ARGV[1]

  #
  # Get the list of todos and setup variables
  #
  todo_file = File.open(todo_file_loc.to_s)
  linesInFile = IO.readlines(todo_file)

  if !linesInFile[doNum].start_with?(&#39;#&#39;)  # Do nothing if the item is a header
    task = &#39;&#39;
    lines = []
    line_number = 0

    linesInFile[-1] = linesInFile[-1] &#43; &#34;\n&#34; unless linesInFile[-1].include? &#34;\n&#34;

    #
    # Process the todo list lines.
    #
    linesInFile.each do |line|
      if line_number != doNum
        #
        # It is one of the other lines. Just push it into the stack.
        #
        lines.push(line)
      else
        #
        # Get the line to be moved to the archive area.
        #
        if insert_date_on_done_task
          task = line.chomp &#43; (mark == &#39;x&#39; ? &#34; @done(#{Time.new.strftime(&#39;%Y-%m-%d %H:%M&#39;)})\n&#34; : &#34;\n&#34;)
        else
          task = line.chomp &#43; &#34;\n&#34;
        end
        task = task.gsub(/^(\s*)([\-\*]&#43;)\s*(\[ \]\s*)*/, &#39;\1\2 [&#39; &#43; mark &#43; &#39;] &#39;)  # Works with both task style, useful if mix with &#39;show_alt_task&#39;, also it keeps the indentation at beginning of the line
        lines.push(task) unless archive_task_at_end
      end
      line_number &#43;= 1
    end

    #
    # Add the task to the bottom.
    #
    lines.push(task) if archive_task_at_end

    #
    # Save the file.
    #
    IO.write(todo_file, lines.join)
  end
end
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						â€¢
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors â€¢ <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
