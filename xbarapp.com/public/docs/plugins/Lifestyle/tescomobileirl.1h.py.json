{
	"plugin": {
		"files": [
			{
				"path": "Lifestyle/tescomobileirl.1h.py",
				"filename": "tescomobileirl.1h.py",
				"content": "#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\n# \u003cbitbar.title\u003eTesco Mobile Ireland Balance\u003c/bitbar.title\u003e\n# \u003cbitbar.version\u003ev1.0.0\u003c/bitbar.version\u003e\n# \u003cbitbar.author\u003eJack Higgins\u003c/bitbar.author\u003e\n# \u003cbitbar.author.github\u003eskhg\u003c/bitbar.author.github\u003e\n# \u003cbitbar.desc\u003eDisplays your current Tesco Mobile Ireland balance and available data, text and voice allowances\u003c/bitbar.desc\u003e\n# \u003cbitbar.image\u003ehttps://github.com/skhg/BitBar-Plugins/blob/master/TescoMobileIrl/tescobalance.jpg?raw=true\u003c/bitbar.image\u003e\n# \u003cbitbar.dependencies\u003epython 2.7 or 3.6, pytescomobileirl\u003c/bitbar.dependencies\u003e\n# \u003cbitbar.abouturl\u003ehttps://github.com/skhg/BitBar-Plugins/tree/master/TescoMobileIrl\u003c/bitbar.abouturl\u003e\n\n\n\n\n\n\n\n# START USER DETAILS\n\n# Enter your tescomobile.ie login details here. These are sent only to the tesco mobile\n# website and never stored or transmitted anywhere else.\n\nphone_num = \"MyPhoneNumber\"\npassword = \"MyPassword\"\n\n# END USER DETAILS\n\n\n\n\n\n\nfrom sys import exit\n\n# VERIFY DEPENDENCIES\ntry:\n    from pytescomobileirl import TescoSession\nexcept ImportError:\n    print(\"Tesco Mobile Ireland\")\n    print(\"---\")\n    print(\"Looks like the package 'pytescomobileirl' isn't installed.\")\n    print(\"You need it to run this tool. To install, click 'Install Now',\")\n    print(\"then click 'Preferences' -\u003e 'Refresh All...'\")\n    print(\"Install Now. | bash='sudo /usr/local/bin/pip install pytescomobileirl'\")\n    exit()\n\n\n\n\n\n\n# START APP\n\nimport pickle\nimport os\nimport subprocess\n\nclass StateMgmt:\n    \n    def __init__(self):\n        os.chdir(self.get_bitbar_plugins_dir())\n        self.relative_state_dir = \"./.tescomobileirl_state/\"\n        self.state_dump_file = self.relative_state_dir+\"tescomobileirl_last_state.pickle\"\n\n    def get_bitbar_plugins_dir(self):\n        bitbar_defaults = subprocess.check_output([\"defaults\", \"read\", \"com.matryer.BitBar\"]).split(\";\")\n        for entry in bitbar_defaults:\n            if \"pluginsDirectory\" in entry:\n                return entry.split(\"\\\"\")[1]\n\n        raise IOError(\"BitBar plugins directory could not be found\")\n    \n    def check_state_dir_exists(self, state_dir):\n        if os.path.exists(state_dir) is False:\n            os.mkdir(state_dir)\n    \n    def load_state(self):\n        self.check_state_dir_exists(self.relative_state_dir)\n\n        if os.path.exists(self.state_dump_file) is False:\n            return None\n        else:\n            try:\n                with open(self.state_dump_file,\"r\") as f_read:\n                    return pickle.load(f_read)\n            except:\n                return None\n    \n    def dump_state(self, current_state):\n        self.check_state_dir_exists(self.relative_state_dir)\n\n        with open(self.state_dump_file,\"w\") as f_write:\n            pickle.dump(current_state,f_write)\n\nclass ResultsFormatter:\n\tdef print_output(self, balances, is_live):\n\t\tprint(balances.remaining_total(\"data\").summary())\n\t\tprint(\"---\")\n\t\tif is_live is False:\n\t\t    print(\"❌ : Using cached data, last update failed\")\n\t\t    print(\"---\")\n\n\t\tprint(\"Number: \"+phone_num)\n\t\tprint(\"---\")\n\t\tprint(u'€{:,.2f} credit'.format(balances.credit_remaining).encode(\"utf-8\"))\n\t\tprint(\"---\")\n\t\tprint(\"Active bundles:\")\n\t\tfor bundle in balances.active_balances():\n\t\t    print(bundle.summary() + \" for \"+ str(bundle.days_remaining())+\" days\")\n\t\tprint(\"---\")\n\n\t\tprint(\"tescomobile.ie | href=https://my.tescomobile.ie/tmi-selfcare-web/login\")\n    \n\tdef print_error_message(self):\n\t\tprint(\"❌\")\n\t\tprint(\"---\")\n\t\tprint(\"Error: Unable to retrieve Tesco Mobile state.\")\n\t\tprint(\"---\")\n\n\t\tprint(\"tescomobile.ie | href=https://my.tescomobile.ie/tmi-selfcare-web/login\")\n\ndef run():\n    login_ok= False\n\n    session = TescoSession()\n\n    try:\n        login_ok = session.login(phone_num, password)\n    except Exception:\n        pass\n\n    state = StateMgmt()\n    formatter = ResultsFormatter()\n\n    if login_ok:\n        balances = session.get_balances()\n        \n        state.dump_state(balances)\n        formatter.print_output(balances,True)\n    else:\n        loaded_state = state.load_state()\n        if loaded_state is not None:\n            formatter.print_output(loaded_state,False)\n        else:\n            formatter.print_error_message()\n\nrun()\n"
			}
		],
		"path": "Lifestyle/tescomobileirl.1h.py",
		"filename": "tescomobileirl.1h.py",
		"dir": "Lifestyle",
		"docsPlugin": "Lifestyle/tescomobileirl.1h.py.html",
		"docsCategory": "Lifestyle.html",
		"pathSegments": [
			"Lifestyle"
		],
		"categoryPathSegments": [
			{
				"path": "Lifestyle",
				"text": "Lifestyle",
				"isLast": true
			}
		],
		"title": "Tesco Mobile Ireland Balance",
		"version": "v1.0.0",
		"author": "Jack Higgins",
		"authors": [
			{
				"name": "Jack Higgins",
				"githubUsername": "skhg",
				"imageURL": "https://avatars.githubusercontent.com/u/1479627?v=4",
				"bio": "Product Manager and Software Engineer",
				"primary": true
			}
		],
		"desc": "Displays your current Tesco Mobile Ireland balance and available data, text and voice allowances",
		"imageURL": "https://github.com/skhg/BitBar-Plugins/blob/master/TescoMobileIrl/tescobalance.jpg?raw=true",
		"dependencies": [
			"python 2.7 or 3.6",
			"pytescomobileirl"
		],
		"aboutURL": "https://github.com/skhg/BitBar-Plugins/tree/master/TescoMobileIrl",
		"lastUpdated": "2021-03-08T15:21:56.304789Z",
		"vars": null
	}
}