
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>Plex Status - Improved in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='See what&#39;s currently playing on your Plex Server - install xbar for free to get started.'>
	<meta name='author' content='Patrick Coffey'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='https://res.cloudinary.com/cyberge/image/upload/v1550627901/icons/plex_878759_eey690.png'>
	<meta itemprop='name' content='Plex Status - Improved in your macOS menu bar'>
	<meta itemprop='description' content='See what&#39;s currently playing on your Plex Server - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='Plex Status - Improved in your macOS menu bar'>
	<meta name='twitter:description' content='See what&#39;s currently playing on your Plex Server - install xbar for free to get started.'>
	<meta name='twitter:image' content='https://res.cloudinary.com/cyberge/image/upload/v1550627901/icons/plex_878759_eey690.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='Plex Status - Improved in your macOS menu bar'>
	<meta property='og:description' content='See what&#39;s currently playing on your Plex Server - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Music/plex-status-improved-30s.py.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='https://res.cloudinary.com/cyberge/image/upload/v1550627901/icons/plex_878759_eey690.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='https://res.cloudinary.com/cyberge/image/upload/v1550627901/icons/plex_878759_eey690.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='https://res.cloudinary.com/cyberge/image/upload/v1550627901/icons/plex_878759_eey690.png'>
	<link rel='shortcut icon' href='https://res.cloudinary.com/cyberge/image/upload/v1550627901/icons/plex_878759_eey690.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>💜</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>Plex Status - Improved</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/patricktcb.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/15157503?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/patricktcb.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Patrick (<code style='color:white;'>@patricktcb</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						See what&#39;s currently playing on your Plex Server
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Music%2fplex-status-improved-30s.py'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>🖥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='https://res.cloudinary.com/cyberge/image/upload/v1550627901/icons/plex_878759_eey690.png' 
				alt='Image preview of Plex Status - Improved plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>plex-status-improved-30s.py</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Music/plex-status-improved-30s.py'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Music/plex-status-improved-30s.py'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>import xml.etree.ElementTree as ET
import os
import urllib.request
import ssl

# &lt;bitbar.title&gt;Plex Status - Improved&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.0&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Patrick Coffey&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;patricktcb&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;See what&#39;s currently playing on your Plex Server&lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;https://res.cloudinary.com/cyberge/image/upload/v1550627901/icons/plex_878759_eey690.png&lt;/bitbar.image&gt;
# &lt;bitbar.dependencies&gt;python&lt;/bitbar.dependencies&gt;
# plextoken will need to be set manually. You can follow this guide from Plex on how to get one: https://support.plex.tv/articles/204059436-finding-an-authentication-token-x-plex-token/
# plexhost should be whatever IP/domain name your local machine uses to connect.
# myip is used in two ways. The first is to show where media is being played if it&#39;s not local, the second is when there are multiple streams being played to prefer the local one over another.
# myuserid is the id of your preferred watcher. This is typically 1, but depending on how your server admin set things up it could be different

def plexMusicInfo(el):
    trackInfo = &#34;[&#34; &#43; el.attrib[&#39;title&#39;] &#43; &#34; by &#34; &#43; el.attrib[&#39;grandparentTitle&#39;] &#43; &#34;]\n---\nAlbum: &#34; &#43; el.attrib[&#39;parentTitle&#39;]
    if el.find(&#34;Player&#34;).attrib[&#34;state&#34;] == &#34;paused&#34;:
        trackInfo = &#34;  &#34; &#43; trackInfo
    return trackInfo

def plexMovieInfo(el):
    trackInfo = &#34;[🎥  &#34; &#43; el.attrib[&#39;title&#39;]
    return trackInfo

def plexTVInfo(el):
    trackInfo = &#34;[📺  &#34; &#43; el.attrib[&#39;grandparentTitle&#39;] &#43; &#34; - &#34; &#43; el.attrib[&#39;title&#39;] &#43; &#34;]\n---\n&#34; &#43; el.attrib[&#39;parentTitle&#39;] &#43; &#34; Episode &#34; &#43; el.attrib[&#39;parentIndex&#39;]
    return trackInfo

def plexMediaInfo(mc, myip, myuserid):
    trackInfo = &#34;❯\n---\nNothing Playing&#34;
    if mc.find(&#34;User&#34;).attrib[&#34;id&#34;] == myuserid:
        if str(mc.tag) == &#34;Track&#34;:
            if mc.find(&#34;Player&#34;).attrib[&#34;state&#34;] == &#34;playing&#34;:
                trackInfo = plexMusicInfo(mc)
        elif str(mc.tag) == &#34;Video&#34;:
            if mc.find(&#34;Player&#34;).attrib[&#34;state&#34;] == &#34;playing&#34;:
                if mc.attrib[&#39;type&#39;] == &#34;movie&#34;:
                    trackInfo = plexMovieInfo(mc)
                elif mc.attrib[&#39;type&#39;] == &#34;episode&#34;:
                    trackInfo = plexTVInfo(mc)
        if mc.find(&#34;Player&#34;).attrib[&#39;address&#39;] != myip:
            trackInfo = trackInfo &#43; &#34;\n&#34; &#43; mc.find(&#34;Player&#34;).attrib[&#39;product&#39;] &#43; &#34; on &#34; &#43; mc.find(&#34;Player&#34;).attrib[&#39;platform&#39;]
    return trackInfo

def getPlexStatus(plextoken, plexhost):
    ctx = ssl.create_default_context()
    ctx.check_hostname = False
    ctx.verify_mode = ssl.CERT_NONE
    # Plex uses self signed certs, so they can&#39;t be verified.
    plexAddress = &#39;https://&#39; &#43; plexhost &#43; &#39;:32400/status/sessions?X-Plex-Token=&#39; &#43; plextoken 
    plexXML = urllib.request.urlopen(plexAddress, context=ctx).read()
    return plexXML

def parseXML(rawXML, myip, myuserid):
    tree = ET.ElementTree(ET.fromstring(rawXML))
    root = tree.getroot()
    trackInfo = &#34;❯\n---\nNothing Playing&#34;
    if root.attrib[&#39;size&#39;] == &#34;1&#34;:
        trackInfo = plexMediaInfo(root[0], myip, myuserid)
    else:
        for mc in root:
            if mc.find(&#34;Player&#34;).attrib[&#39;address&#39;] == myip:
                trackInfo = plexMediaInfo(mc, myip, myuserid)
    return trackInfo

#This is the function to be used with the script is called by itself by BitBar. But the file is written so that if you want, you can just import these functions into another python script if you want to.
if __name__ == &#39;__main__&#39;:
    plextoken = &#34;YOUR TOKEN&#34;
    plexhost = &#34;YOUR PLEX HOST&#34;
    myip = &#34;YOUR IP&#34; #This is your IP, from the Plex Host&#39;s perspective. So your local IP if the server is on your network, and public IP if it&#39;s not
    myuserid = &#34;1&#34; #This is usually 1, but might not be.
    try:
        plexXML = getPlexStatus(plextoken, plexhost)
        print(parseXML(plexXML, myip, myuserid))
    except:
        print(&#34;🚫\n---\nCould not connect to Plex server &#34; &#43; plexhost &#43; &#34;\nServer may be offline, or token may be invalid.&#34;)
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						•
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors • <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
