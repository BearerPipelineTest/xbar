
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>SonosBar in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='Control you Sonos system from you Mac Menu Bar. - install xbar for free to get started.'>
	<meta name='author' content='Jonas Marcello'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='https://raw.githubusercontent.com/anergictcell/SonosBar/master/resources/SonosBar.png'>
	<meta itemprop='name' content='SonosBar in your macOS menu bar'>
	<meta itemprop='description' content='Control you Sonos system from you Mac Menu Bar. - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='SonosBar in your macOS menu bar'>
	<meta name='twitter:description' content='Control you Sonos system from you Mac Menu Bar. - install xbar for free to get started.'>
	<meta name='twitter:image' content='https://raw.githubusercontent.com/anergictcell/SonosBar/master/resources/SonosBar.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='SonosBar in your macOS menu bar'>
	<meta property='og:description' content='Control you Sonos system from you Mac Menu Bar. - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Music/sonosBar.py.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='https://raw.githubusercontent.com/anergictcell/SonosBar/master/resources/SonosBar.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='https://raw.githubusercontent.com/anergictcell/SonosBar/master/resources/SonosBar.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='https://raw.githubusercontent.com/anergictcell/SonosBar/master/resources/SonosBar.png'>
	<link rel='shortcut icon' href='https://raw.githubusercontent.com/anergictcell/SonosBar/master/resources/SonosBar.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>ðŸ’œ</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>SonosBar</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/anergictcell.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/875703?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/anergictcell.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Jonas Marcello (<code style='color:white;'>@anergictcell</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						Control you Sonos system from you Mac Menu Bar.
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Music%2fsonosBar.py'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>ðŸ–¥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='https://raw.githubusercontent.com/anergictcell/SonosBar/master/resources/SonosBar.png' 
				alt='Image preview of SonosBar plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>sonosBar.py</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Music/sonosBar.py'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Music/sonosBar.py'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env python
# -*- coding: utf-8 -*-
&#34;&#34;&#34;
Control you Sonos system from you Mac Menu Bar
&#34;&#34;&#34;

# &lt;bitbar.title&gt;SonosBar&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.0&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Jonas Marcello&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;anergictcell&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;Control you Sonos system from you Mac Menu Bar.&lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;https://raw.githubusercontent.com/anergictcell/SonosBar/master/resources/SonosBar.png&lt;/bitbar.image&gt;
# &lt;bitbar.dependencies&gt;python,SoCo&lt;/bitbar.dependencies&gt;
# &lt;bitbar.abouturl&gt;https://github.com/anergictcell/SonosBar/&lt;/bitbar.abouturl&gt;

import argparse
import socket
import os
import sys
import warnings

try:
    import soco
    from soco.music_services import MusicService
    from soco.data_structures import DidlItem, to_didl_string
except ImportError:
    print(&#34;Error&#34;)
    print(&#34;---&#34;)
    print(&#34;You need to install &gt;&gt;soco&lt;&lt; | href=https://github.com/SoCo/SoCo&#34;)
    sys.exit(0)

def parse_ip(ip_string):
    &#34;&#34;&#34;Parsing the user supplied IP address to use on the local subnet&#34;&#34;&#34;
    host_ip = socket.gethostbyname(socket.gethostname())
    subnets = host_ip.split(&#34;.&#34;)
    sonos_subnets = ip_string.split(&#34;.&#34;)
    new_ip = subnets[0:(4-len(sonos_subnets))] &#43; sonos_subnets
    return &#34;.&#34;.join(new_ip)


def parse_cli_arguments():
    &#34;&#34;&#34;Main function that parses command line arguments&#34;&#34;&#34;
    parser = argparse.ArgumentParser(description=&#39;Control your Sonos&#39;)

    player_args = parser.add_mutually_exclusive_group()
    player_args.add_argument(
        &#34;-p&#34;, &#34;--player&#34;,
        metavar=&#34;SPEAKER_NAME&#34;,
        type=str,
        # default=&#34;Living Room&#34;,
        help=&#34;The name of the player/zone&#34;)

    player_args.add_argument(
        &#34;-i&#34;, &#34;--ip&#34;,
        metavar=&#34;IP_ADDRESS&#34;,
        type=str,
        help=&#34;The IP address of the player/zone&#34;)

    control_args = parser.add_mutually_exclusive_group()
    control_args.add_argument(
        &#34;-l&#34;, &#34;--playlist&#34;,
        metavar=&#34;PLAYLIST_NAME&#34;,
        type=str,
        help=&#34;The name of the playlist to play&#34;)

    control_args.add_argument(
        &#34;-r&#34;, &#34;--radio&#34;,
        metavar=&#34;RADIO_STATION&#34;,
        type=str,
        help=&#34;The name of the radio station to play&#34;)

    control_args.add_argument(
        &#34;-v&#34;, &#34;--vol&#34;,
        metavar=&#34;VOLUME&#34;,
        type=int,
        choices=range(0, 101),
        help=&#34;0-100&#34;)

    control_args.add_argument(
        &#34;-j&#34;, &#34;--join&#34;,
        metavar=&#34;SPEAKER_NAME&#34;,
        type=str,
        help=&#34;Name of the speaker to join&#34;)

    control_args.add_argument(
        &#34;-k&#34;, &#34;--ipjoin&#34;,
        metavar=&#34;SPEAKER_IP&#34;,
        type=str,
        help=&#34;IP of the speaker to join&#34;)

    control_args.add_argument(
        &#34;-u&#34;, &#34;--unjoin&#34;,
        action=&#39;store_const&#39;,
        const=True,
        help=&#34;Unjoin the player from all groups&#34;)

    control_args.add_argument(
        &#39;action&#39;,
        metavar=&#39;action&#39;,
        nargs=&#34;?&#34;,
        choices=[&#34;play&#34;, &#34;pause&#34;, &#34;next&#34;, &#34;previous&#34;, &#34;shuffle&#34;, &#34;normal&#34;],
        help=&#34;&#34;&#34;Action to take if non is set via flags.
          Can be either: play, pause, next, previous, shuffle, normal&#34;&#34;&#34;)

    parser.add_argument(
        &#34;-g&#34;, &#34;--group&#34;,
        action=&#39;store_const&#39;,
        const=True,
        help=&#34;Apply the action to the whole group&#34;)

    output = parser.add_mutually_exclusive_group()
    output.add_argument(
        &#34;-o&#34;, &#34;--verbose&#34;,
        action=&#39;store_const&#39;,
        const=True,
        help=&#34;Display feedback about current actions&#34;)

    output.add_argument(
        &#34;-b&#34;, &#34;--bitbar&#34;,
        action=&#39;store_const&#39;,
        const=True,
        help=&#34;Display bitbar controls&#34;)

    args = parser.parse_args()

    if args.ip:
        args.ip = parse_ip(args.ip)

    if args.ipjoin:
        args.ipjoin = parse_ip(args.ipjoin)

    return args

def output_for_bitbar(zones):
    &#34;&#34;&#34;Prints the topology display&#34;&#34;&#34;
    print(&#34;ðŸ”ŠSonos&#34;)
    print(&#34;---&#34;)
    for zone in zones:
        print_zone(zone)

def print_zone(zone):
    &#34;&#34;&#34;Prints basic info about the zone and calls functions to
    print more detailed info&#34;&#34;&#34;
    print(&#34;---&#34;)
    print(&#34;Zone:&#34;)
    print(&#34;{0}: {1}&#34;.format(zone[&#34;kind&#34;], zone[&#34;master&#34;].player_name))
    if zone[&#34;kind&#34;] == &#34;P&#34;:
        print_single_player(zone[&#34;master&#34;])
    else:
        print_group(zone[&#34;master&#34;])

def print_single_player(player):
    &#34;&#34;&#34;Controls printing of control elements for a single-player zone&#34;&#34;&#34;
    print_music_controls(player, &#34;--&#34;)
    print_player_controls(player, &#34;--&#34;)
    print_top_level_controls(player, &#34;&#34;)

def print_group(master):
    &#34;&#34;&#34;Controls printing of control elements for a multi-player zone&#34;&#34;&#34;
    print_music_controls(master, &#34;--&#34;)
    print_top_level_controls(master, &#34;&#34;)
    for player in master.group.members:
        print(&#34;âž¤ {0}&#34;.format(player.player_name))
        print_player_controls(player, &#34;--&#34;)
        print(&#34;--Volume&#34;)
        print_volume_controls(player, &#34;--&#34;)

def create_command(player, *params):
    &#34;&#34;&#34;Creates the Bitbar specific command&#34;&#34;&#34;
    string = &#34;bash={0} param1=-i param2={1}&#34;
    i = 3
    for param in params:
        string &#43;= &#34; param{0}={1}&#34;.format(i, param)
        i &#43;= 1
    string &#43;= &#34; terminal=false refresh=true&#34;
    return string.format(PATH_TO_SCRIPT, player.ip_address)

def print_player_controls(player, indent):
    &#34;&#34;&#34;Prints Player controls for Bitbar&#34;&#34;&#34;

    print(&#34;{0}Join&#34;.format(indent))
    for single_player in player.all_zones:
        if single_player != player:
            print(&#34;{0}--{1} | &#34;.format(indent, single_player.player_name) &#43;
                  create_command(player, &#34;--ipjoin&#34;, single_player.ip_address)
                 )
    print(&#34;{0}Unjoin | &#34;.format(indent) &#43;
          create_command(player, &#34;--unjoin&#34;)
         )

def print_music_controls(player, indent):
    &#34;&#34;&#34;Prints Music controls for Bitbar&#34;&#34;&#34;
    print(&#34;{0}Playlists&#34;.format(indent))
    for playlist in player.get_sonos_playlists():
        print(&#34;{0}--{1} | &#34;.format(indent, playlist.title) &#43;
              create_command(player, &#34;-gl&#34;, &#39;&#34;&#39; &#43; playlist.title &#43; &#39;&#34;&#39;)
             )

    print(&#34;{0}Radios&#34;.format(indent))
    for station in player.get_favorite_radio_stations()[&#34;favorites&#34;]:
        print(&#34;{0}--{1} | &#34;.format(indent, station[&#34;title&#34;]) &#43;
              create_command(player, &#34;-gr&#34;, &#39;&#34;&#39; &#43; station[&#34;uri&#34;] &#43; &#39;&#34;&#39;)
            )

def print_top_level_controls(player, indent):
    &#34;&#34;&#34;Prints the controls that are displayed on the base level for each
    player / group&#34;&#34;&#34;
    playing = player.get_current_transport_info()[&#34;current_transport_state&#34;]
    if playing == &#34;PLAYING&#34;:
        print(&#34;{0}â”œ Pause | &#34;.format(indent) &#43;
              create_command(player, &#34;pause&#34;, &#34;-g&#34;))
        print(&#34;{0}â”œ Next | &#34;.format(indent) &#43;
              create_command(player, &#34;next&#34;, &#34;-g&#34;))
    else:
        print(&#34;{0}â”œ Play | &#34;.format(indent) &#43;
              create_command(player, &#34;play&#34;, &#34;-g&#34;))

    print(&#34;{0}â”” Volume | &#34;.format(indent))
    print_volume_controls(player, indent)

def print_volume_controls(player, indent):
    &#34;&#34;&#34;Prints controls to adjust the volume&#34;&#34;&#34;
    for vol in range(0, 11):
        if (vol-1) * 10 &lt; player.volume and vol*10 &gt;= player.volume:
            # print checkmark
            print((&#34;{0}--{1}{2}&#34;).format(indent, u&#39;\u2713&#39;.encode(&#34;utf-8&#34;), vol))
        else:
            print(&#34;{0}--{1} | &#34;.format(indent, vol) &#43;
                  create_command(player, &#34;--vol&#34;, vol*10)
                 )

# soco prints some usage warnings about functions where the output
# will change in the future
# Those warnings don&#39;t work well with the output for Bitbar
warnings.filterwarnings(&#34;ignore&#34;)

PATH_TO_SCRIPT = os.path.realpath(__file__)
ARGUMENTS = parse_cli_arguments()
GROUP = ARGUMENTS.group

def get_player_by_name(name):
    &#34;&#34;&#34;Returns a SoCo object for the given name (if it exists)&#34;&#34;&#34;
    for device in soco.discover():
        if device.player_name == name:
            return device

def define_player(ip_address, name):
    &#34;&#34;&#34;Returning a SoCo object of the chosen player&#34;&#34;&#34;
    player = None
    if ip_address:
        player = soco.SoCo(ip_address)
    if name:
        player = get_player_by_name(name)

    if player and GROUP:
        # Change player to be the coordinator of the group
        player = player.group.coordinator

    return player

def find_random_player():
    &#34;&#34;&#34;Searches the network for Sonos zones and picks one randomly&#34;&#34;&#34;
    zones = soco.discover()

    if zones:
        # picking a random player
        player = next(iter(zones))
        return player

    return None

def parse_zone_groups(player):
    &#34;&#34;&#34;Creates a list of all Zones with attrbute
    whether they are a group or a single player&#34;&#34;&#34;
    all_zones = []
    for group in player.all_groups:
        if len(group.members) &gt; 1:
            all_zones.append({&#34;kind&#34;:&#34;G&#34;, &#34;master&#34;:group.coordinator})
        else:
            all_zones.append({&#34;kind&#34;:&#34;P&#34;, &#34;master&#34;:group.coordinator})
    return all_zones



def verbose_output(string):
    &#34;&#34;&#34;Printing the passed commands to stdout&#34;&#34;&#34;
    if ARGUMENTS.verbose:
        print(&#34;{0}: {1}&#34;.format(
            (&#34;Group &#34; if GROUP else &#34;Player &#34;), string))

def group_coordinate(function):
    &#34;&#34;&#34;Wrapper function to ensure unjoining for single players&#34;&#34;&#34;
    def inner_function(*arguments):
        &#34;&#34;&#34;Inner function&#34;&#34;&#34;
        if GROUP:
            function(*arguments)
        else:
            # First argument always has to be the player SoCo object
            arguments[0].unjoin()
            function(*arguments)
    return inner_function

def get_songs_from_playlist(player, playlist_name):
    &#34;&#34;&#34;Returns a list of songs from the given playlist&#34;&#34;&#34;
    lists = player.get_sonos_playlists()
    for playlist in lists:
        if playlist.title == playlist_name:
            return player.music_library.browse(playlist)

@group_coordinate
def play_playlist(player, playlist_name):
    &#34;&#34;&#34;Replaces the queue with the selected playlist&#34;&#34;&#34;
    verbose_output(&#34;Play playlist {0}&#34;.format(playlist_name))
    songs = get_songs_from_playlist(player, playlist_name)
    player.clear_queue()
    for song in songs:
        player.add_to_queue(song)
    player.play_from_queue(0)

@group_coordinate
def play_radio_station(player, uri):
    &#34;&#34;&#34;Plays the selected radio station. The URI must be in the
    format as it is currently returned from soco:
        x-sonosapi-stream:s25111?sid=254&amp;flags=32
    &#34;&#34;&#34;
    verbose_output(&#34;Switching to radio station {0}&#34;.format(uri))
    service = MusicService(&#39;TuneIn&#39;)
    didl = DidlItem(
        title=&#34;DUMMY&#34;, parent_id=&#34;DUMMY&#34;, item_id=&#34;DUMMY&#34;, desc=service.desc)
    meta = to_didl_string(didl)
    player.avTransport.SetAVTransportURI(
        [(&#39;InstanceID&#39;, 0), (&#39;CurrentURI&#39;, uri), (&#39;CurrentURIMetaData&#39;, meta)])
    player.play()

@group_coordinate
def play(player):
    &#34;&#34;&#34;Play the selected song&#34;&#34;&#34;
    verbose_output(&#34;Play&#34;)
    player.play()

@group_coordinate
def pause(player):
    &#34;&#34;&#34;Pause the current playback&#34;&#34;&#34;
    verbose_output(&#34;Pause&#34;)
    player.pause()

@group_coordinate
def next_track(player):
    &#34;&#34;&#34;Play the next track&#34;&#34;&#34;
    verbose_output(&#34;Next track&#34;)
    player.next()

@group_coordinate
def previous_track(player):
    &#34;&#34;&#34;Play the previous track&#34;&#34;&#34;
    verbose_output(&#34;Previous track&#34;)
    player.previous()

@group_coordinate
def turn_on_shuffle(player):
    &#34;&#34;&#34;Turn on shuffle&#34;&#34;&#34;
    verbose_output(&#34;Shuffle ON&#34;)
    player.play_mode = &#34;SHUFFLE_NOREPEAT&#34;

@group_coordinate
def turn_off_shuffle(player):
    &#34;&#34;&#34;Turn off shuffle&#34;&#34;&#34;
    verbose_output(&#34;Shuffle OFF&#34;)
    player.play_mode = &#34;NORMAL&#34;

def set_volume(player, volume):
    &#34;&#34;&#34;Sets the volume&#34;&#34;&#34;
    verbose_output(&#34;Setting the volume to {0}&#34;.format(volume))
    player.volume = volume

def join(source, target):
    &#34;&#34;&#34;Joining another group&#34;&#34;&#34;
    if target is None:
        return invalid_command(&#34;Target to join is not known&#34;)
    if GROUP:
        for single_player in source.group.members:
            single_player.join(target.group.coordinator)
    else:
        source.join(target.group.coordinator)

def invalid_command(err):
    &#34;&#34;&#34;Handles errors and prints error messages&#34;&#34;&#34;
    print(&#34;ERROR: {0}&#34;.format(err))
    return

def main(args):
    &#34;&#34;&#34;Main function&#34;&#34;&#34;
    player = define_player(args.ip, args.player)

    if player is None or args.bitbar:
        player = player or find_random_player()
        print_bitbar_controls(player)
        return

    if GROUP:
        # Change player to the coordinator of the group
        player = player.group.coordinator

    if args.playlist:
        return play_playlist(player, args.playlist)

    if args.radio:
        return play_radio_station(player, args.radio)

    if args.vol is not None:
        return set_volume(player, args.vol)

    if args.join:
        verbose_output(&#34;Joining {0}&#34;.format(args.join))
        to_join = define_player(None, args.join)
        return join(player, to_join)

    if args.ipjoin:
        verbose_output(&#34;Joining {0}&#34;.format(args.ipjoin))
        to_join = define_player(args.ipjoin, None)
        return join(player, to_join)

    if args.unjoin:
        verbose_output(&#34;Unjoin&#34;)
        player.unjoin()
        return

    if args.action is None:
        return

    if args.action.lower() == &#34;play&#34;:
        play(player)
        return

    if args.action.lower() == &#34;pause&#34;:
        pause(player)
        return

    if args.action.lower() == &#34;next&#34;:
        next_track(player)
        return

    if args.action.lower() == &#34;previous&#34;:
        previous_track(player)
        return

    if args.action.lower() == &#34;shuffle&#34;:
        turn_on_shuffle(player)
        return

    if args.action.lower() == &#34;normal&#34;:
        turn_off_shuffle(player)
        return

def print_bitbar_controls(player):
    &#34;&#34;&#34;Prints the lines used for Bitbar to stdout&#34;&#34;&#34;
    if player is None:
        print(&#34;ðŸ”‡ Sonos&#34;)
        print(&#34;---&#34;)
        print(&#34;No Sonos Zone present&#34;)
    else:
        output_for_bitbar(parse_zone_groups(player))

if __name__ == &#34;__main__&#34;:
    main(ARGUMENTS)
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						â€¢
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors â€¢ <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
