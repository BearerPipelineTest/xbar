{
	"plugin": {
		"files": [
			{
				"path": "Sports/cricket_bar.1m.php",
				"filename": "cricket_bar.1m.php",
				"content": "#!/usr/bin/env php\n\u003c?php\n\n# \u003cbitbar.title\u003eCricket Bar\u003c/bitbar.title\u003e\n# \u003cbitbar.version\u003ev1.1\u003c/bitbar.version\u003e\n# \u003cbitbar.author\u003eAdi\u003c/bitbar.author\u003e\n# \u003cbitbar.author.github\u003egomedia-adi\u003c/bitbar.author.github\u003e\n# \u003cbitbar.desc\u003eDisplays live cricket score of a selected match, using data from ESPNcricinfo or Cricbuzz.\u003c/bitbar.desc\u003e\n# \u003cbitbar.image\u003ehttp://www.greatoceanmedia.com.au/images/62.png\u003c/bitbar.image\u003e\n# \u003cbitbar.dependencies\u003ephp\u003c/bitbar.dependencies\u003e\n# \u003cbitbar.abouturl\u003ehttp://www.greatoceanmedia.com.au/bitbar\u003c/bitbar.abouturl\u003e\n\n// Inspired by, and respect to Anup Sam Abraham's Live Cricket Scores v1.1 (https:getbitbar.com/plugins/Sports/live_cricket.2m.py)\n// BitBar plugin help: https:github.com/matryer/bitbar\n//\n// Plugin updated 25/11/17\n//\n// Version history\n// 1.1\t- option to set timezone\n//\t\t- selected match ID reset on feed change\n//\t\t- timeout set on Curl connect\n// 1.0\t- initial release\n\n//TODO \n// user specific config/log files\n// option to hide scores in menubar\n// weather link?\n// score format option - Standard, Australia\n// check out [break] in ESPNcricinfo - more informative than live_state (\"Stumps\" vs \"Stumps - Day 3\")?\n\n//??? KNOWN ISSUES\n//\n// General\n// - long menubar displays (e.g. matches with two innings \u0026 scores per team) may \"disappear\" due to lack of room with other menubar items and application menus\n//\t\t- workaround: switch to application with fewer menus, e.g. Finder\n//\t\t- future enhancement: option to hide scores in menubar\n//\n// ESPNcricinfo\n// - home team not always first in summary\n//\t\t- workaround: none\n//\t\t- fix: home team info in detailed feed\n// - summary score doesn't keep pace with detailed feed score (not sure of bug or deliberate on ESPNcricinfo's part)\n//\t\t- workaround: none\n//\t\t- fix: only use detailed feed (ties in with previous fix)\n//\n// Cricbuzz\n// - last wicket dismissal information not available\n// \t\t- workaround/fix: none\n// - duplicate entries in current match list\n//\t\t- workaround: none\n//\t\t- fix: may be difficult - a completed match can have two match IDs\n// - full team names rarely supplied\n//\t\t- workaround/fix: hardcode translations\n// - feed only provides limited match types: TEST, ODI, T20\n//\t\t- workaround/fix: none\n\n\ndefine('UA', 'Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.1 Safari/603.1.30');\ndefine('CONFIG_FILE', \"/var/tmp/bitbar.cricket_bar.config.php\");\ndefine('LOG_FILE', \"/var/tmp/bitbar.cricket_bar.log\");\ndefine('DEBUG_FILE', \"/var/tmp/bitbar.cricket_bar.debug.log\");\n\nglobal $abbrev_map;\n\nfunction update_config($selected_match_id, $feed, $timezone) {\n// rewrite config file with given values\n\tfile_put_contents(CONFIG_FILE, \"\u003c?php\\n\");\n\tfile_put_contents(CONFIG_FILE, \"// CRICKET_BAR CONFIGURATION\\n\", FILE_APPEND);\n\tfile_put_contents(CONFIG_FILE, \"\\$feed = '$feed';\\n\", FILE_APPEND);\n\tfile_put_contents(CONFIG_FILE, \"\\$selected_match_id = '$selected_match_id';\\n\", FILE_APPEND);\n\tfile_put_contents(CONFIG_FILE, \"\\$timezone = '$timezone';\\n\", FILE_APPEND);\n\tfile_put_contents(CONFIG_FILE, \"?\u003e\\n\", FILE_APPEND);\n}\n\nfunction tz_error_handler($errno, $errstr) {\n// fix for PHP timezone config problem\n\t$mac_timezone_abbr = exec('date +%Z'); // get local Mac timezone abbreviation, e.g. AEST\n\tfile_put_contents(LOG_FILE, '**('.__FUNCTION__.') MAC TIMEZONE ABBR: '.$mac_timezone_abbr.\"\\n\", FILE_APPEND);\n\t$mac_timezone_name = timezone_name_from_abbr(exec('date +%Z')); // convert timezone abbreviation to name, e.g. Australia/Melbourne\n\tfile_put_contents(LOG_FILE, '**('.__FUNCTION__.') SET PHP TO MAC TIMEZONE NAME: '.$mac_timezone_name.\"\\n\", FILE_APPEND);\n\tdate_default_timezone_set($mac_timezone_name); // set PHP timezone\n}\n\nfunction curl_obj($url) {\n// curly whirly\n\t$ch = curl_init();\n\tcurl_setopt($ch, CURLOPT_URL, $url);\n\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n\tcurl_setopt($ch, CURLOPT_USERAGENT, UA);\n\tcurl_setopt($ch, CURLOPT_FAILONERROR, TRUE);\n\tcurl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 10); // set connection timeout (workaround for long connection delays - seen during 1st Ashes Test on Cricbuzz - data is still received though)\n\t$output = curl_exec($ch);\n\tfile_put_contents(LOG_FILE, \"**(\".__FUNCTION__.\") CURL: \".$url.\"\\n\", FILE_APPEND);\n\tif (curl_errno($ch)) // may not pick up website problems though\n\t\tfile_put_contents(LOG_FILE, \"**CURL ERROR: \".curl_error($ch).\"\\n\", FILE_APPEND);\n\tcurl_close($ch);\n\t// use URL extension to determine decode action\n\t$path_parts = pathinfo($url);\n\tfile_put_contents(LOG_FILE, \"**(\".__FUNCTION__.\") DATA FORMAT: \", FILE_APPEND);\n\tif ($path_parts['extension'] == 'json') {\n\t\tfile_put_contents(LOG_FILE, \"JSON\\n\", FILE_APPEND);\n\t\treturn json_decode($output);\n\t}\n\telse if ($path_parts['extension'] == 'xml') {\n\t\tfile_put_contents(LOG_FILE, \"XML\\n\", FILE_APPEND);\n\t\treturn @simplexml_load_string($output); // suppress warnings/errors, otherwise everything goes pear shaped - can occur if XML feed contains badly formatted data (e.g. \u0026 instead of \u0026amp;)\n\t}\n\telse {\n\t\tfile_put_contents(LOG_FILE, \"UNKNOWN\\n\", FILE_APPEND);\n\t\treturn '';\n\t}\n}\n\nfunction get_batsman($detailed_feed, $player_id) {\n// return batsman's name from given player ID (ESPNcricinfo)\n\t$name = '';\n\tforeach($detailed_feed-\u003eteam as $team) {\n\t\tforeach ($team-\u003eplayer as $player) {\n\t\t\tif ($player-\u003eplayer_id == $player_id) {\n\t\t\t\t$name = $player-\u003ecard_long;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif ($name) break;\n\t}\n\treturn ($name ? $name : '?');\n}\n\nfunction translate_name($abbrev) {\n// replace given abbreviation with translation if exists (ESPNcricinfo \u0026 Cricbuzz)\n\tglobal $abbrev_map;\n\n\t$this_abbrev = strtoupper($abbrev);\n\tif (array_key_exists($this_abbrev, $abbrev_map))\n\t\treturn $abbrev_map[$this_abbrev];\n\telse\n\t\treturn $abbrev;\n}\n\nfunction translate_names($string) {\n// translate all abbreviations in a string (Cricbuzz)\n\t$words = explode(' ', $string);\n\tforeach ($words as $index =\u003e $word)\n\t\t$words[$index] = translate_name($word);\n\treturn implode(' ', $words);\n}\n\nfunction projected_score($noofovers, $overs, $score) {\n// calculate projected score based on no. of overs in match, current over \u0026 current score (ESPNcricinfo \u0026 Cricbuzz)\n\tif (strpos($overs,'.') === FALSE)\n\t\t$balls = (int)$overs * 6;\n\telse {\n\t\t$parts = explode('.',$overs);\n\t\t$balls = $parts[0] * 6 + $parts[1];\n\t}\n\t$proj_score = round($score / ($balls / 6) * $noofovers);\n\treturn \" Proj Scr $proj_score\";\n}\n\n//-------------------------------------------------------------------------------------------------\n\n//??? CONFIG FILE\n\n// initialise config file\nif (!file_exists(CONFIG_FILE))\n\ttouch(CONFIG_FILE);\n\n// read config file\ninclude(CONFIG_FILE);\n\n// provide defaults\nif (!isset($feed))\n\t$feed = 'espncricinfo';\nif (!isset($selected_match_id))\n\t$selected_match_id = '';\nif (!isset($timezone))\n\t$timezone = '';\n\n// update config (value supplied as argument, update config file, exit script)\nif (isset($argv[1])) { // match, feed or timezone\n\tif (isset($argv[2])) { // feed or timezone\n\t\tif (isset($argv[3])) { // timezone\n\t\t\tupdate_config($selected_match_id, $feed, $argv[3]);\n\t\t}\n\t\telse { // feed\n\t\t\tupdate_config('unknown', $argv[2], $timezone); // reset selected match when changing feed\n\t\t}\n\t}\n\telse { // match\n\t\tupdate_config($argv[1], $feed, $timezone);\n\t}\n\texit;\n}\n\n//??? INITIALISE\n\n// initialise logfile\nfile_put_contents(LOG_FILE, '**CRICKET_BAR BITBAR PLUGIN'.\"\\n\");\nfile_put_contents(LOG_FILE, '**CONFIG FEED: '.$feed.\"\\n\", FILE_APPEND);\nfile_put_contents(LOG_FILE, '**CONFIG SELECTED_MATCH_ID: '.$selected_match_id.\"\\n\", FILE_APPEND);\nfile_put_contents(LOG_FILE, '**CONFIG TIMEZONE: '.$timezone.\"\\n\", FILE_APPEND);\n\nif ($timezone) { // set PHP timezone from config\n\tdate_default_timezone_set($timezone);\n\tfile_put_contents(LOG_FILE, '**TIMEZONE SET FROM CONFIG'.\"\\n\", FILE_APPEND);\n}\nelse { // trap \u0026 fix PHP timezone config warning problem (not an issue in PHP7)\n\tset_error_handler(\"tz_error_handler\");\n\t@date_default_timezone_get();\n\trestore_error_handler();\n}\n\nfile_put_contents(LOG_FILE, '**PHP VERSION: '.phpversion().\"\\n\", FILE_APPEND);\nfile_put_contents(LOG_FILE, '**PHP TIMEZONE: '.date_default_timezone_get().\"\\n\", FILE_APPEND);\nfile_put_contents(LOG_FILE, '**MAC TIMEZONE ABBR: '.exec('date +%Z').\"\\n\", FILE_APPEND);\nfile_put_contents(LOG_FILE, '**MAC TIMEZONE NAME: '.timezone_name_from_abbr(exec('date +%Z')).\"\\n\", FILE_APPEND);\n\n//??? FEED INFO\n\n$feed_info = array(\n\t'espncricinfo' =\u003e\n\t\tarray(\n\t\t\t'name' =\u003e 'ESPNcricinfo',\n\t\t\t'site_url' =\u003e 'http://www.espncricinfo.com',\n\t\t\t'base_url' =\u003e 'http://api.espncricinfo.com',\n\t\t\t'summary_path' =\u003e '/netstorage/summary.json'\n\t\t),\n\t'cricbuzz' =\u003e\n\t\tarray(\n\t\t\t'name' =\u003e 'Cricbuzz',\n\t\t\t'site_url' =\u003e 'http://www.cricbuzz.com',\n\t\t\t'base_url' =\u003e 'http://synd.cricbuzz.com',\n\t\t\t'summary_path' =\u003e '/j2me/1.0/livematches.xml'\n\t\t)\n);\n\n//??? ABBREVIATIONS\n\n$abbrev_map = array();\nif ($feed == 'espncricinfo')\n\t// to fix dodgy country abbreviations (menubar summary only)\n\t$abbrev_map = array(\n\t\t'BDESH' =\u003e 'BAN',\n\t\t'INDIA' =\u003e 'IND',\n\t\t'SCOT' =\u003e 'SCO',\n\t);\nelse if ($feed == 'cricbuzz')\n\t// Cricbuzz doesn't seem to be keen on providing full names so here's a partial translation\n\t$abbrev_map = array(\n\t\t'AFG' =\u003e 'Afganistan',\n\t\t'AUS' =\u003e 'Australia',\n\t\t'BAN' =\u003e 'Bangladesh',\n\t\t'DERBY' =\u003e 'Derbyshire',\n\t\t'DUR' =\u003e 'Durham',\n\t\t'ENG' =\u003e 'England',\n\t\t'ESS' =\u003e 'Essex',\n\t\t'GLAM' =\u003e 'Glamorgan',\n\t\t'GLOUCS' =\u003e 'Gloucestershire',\n\t\t'HAM' =\u003e 'Hampshire',\n\t\t'HK' =\u003e 'Hong Kong',\n\t\t'IND' =\u003e 'India',\n\t\t'IRE' =\u003e 'Ireland',\n\t\t'KENT' =\u003e 'Kent',\n\t\t'KEN' =\u003e 'Kenya',\n\t\t'LEIC' =\u003e 'Leicestershire',\n\t\t'LANCS' =\u003e 'Lancashire',\n\t\t'MDX' =\u003e 'Middlesex',\n\t\t'NED' =\u003e 'Netherlands',\n\t\t'NEP' =\u003e 'Nepal',\n\t\t'NAM' =\u003e 'Namibia',\n\t\t'NOR' =\u003e 'Northamptonshire',\n\t\t'NOTTS' =\u003e 'Nottinghamshire',\n\t\t'NSW' =\u003e 'New South Wales',\n\t\t'NZ' =\u003e 'New Zealand',\n\t\t'PAK' =\u003e 'Pakistan',\n\t\t'PNG' =\u003e 'Papua New Guinea',\n\t\t'QL' =\u003e 'Queensland',\n\t\t'RSA' =\u003e 'South Africa',\n\t\t'SAUS' =\u003e 'South Australia',\n\t\t'SL' =\u003e 'Sri Lanka',\n\t\t'SCO' =\u003e 'Scotland',\n\t\t'SOM' =\u003e 'Somerset',\n\t\t'SUS' =\u003e 'Sussex',\n\t\t'SUR' =\u003e 'Surrey',\n\t\t'TAS' =\u003e 'Tasmania',\n\t\t'UAE' =\u003e 'United Arab Emirates',\n\t\t'VIC' =\u003e 'Victoria',\n\t\t'WA' =\u003e 'Western Australia',\n\t\t'WARKS' =\u003e 'Warwickshire',\n\t\t'WI' =\u003e 'West Indies',\n\t\t'WORCS' =\u003e 'Worcestershire',\n\t\t'YORKS' =\u003e 'Yorkshire',\n\t\t'ZIM' =\u003e 'Zimbabwe',\n\t);\n\n//??? SUMMARY FEED\n\n$summary_url = $feed_info[$feed]['base_url'].$feed_info[$feed]['summary_path'];\n$summary_feed = curl_obj($summary_url);\nfile_put_contents(LOG_FILE, \"**SUMMARY FEED ($summary_url):\\n\", FILE_APPEND);\nif ($summary_feed)\n\tfile_put_contents(LOG_FILE, print_r($summary_feed, TRUE), FILE_APPEND);\nelse\n\tfile_put_contents(LOG_FILE, \"--EMPTY\\n\", FILE_APPEND);\n\n//??? CURRENT MATCHES\n\n$matches = array();\nif ($summary_feed) {\n\tif ($feed == 'espncricinfo')\n\t\tforeach ($summary_feed-\u003ematches as $index =\u003e $this_match_obj)\n\t\t\t$matches[$index] = $this_match_obj;\n\telse if ($feed == 'cricbuzz') {\n\t\tforeach ($summary_feed-\u003ematch as $this_match_obj) {\n\t\t\t$this_match_id = (int)$this_match_obj-\u003eattributes()['id'];\n\t\t\t// summary of finished matches lacks some detail, so get try to get detailed instead\n\t\t\t$this_detailed_feed_url = (string)$this_match_obj-\u003eattributes()['datapath'].'commentary.xml';\n\t\t\t$this_detailed_feed_obj = curl_obj($this_detailed_feed_url);\n\t\t\tif ($this_detailed_feed_obj)\n\t\t\t\t$matches[$this_match_id] = $this_detailed_feed_obj-\u003ematch; // includes batsmen\n\t\t\telse\n\t\t\t\t$matches[$this_match_id] = $this_match_obj;\n\t\t}\n\t}\n}\nfile_put_contents(LOG_FILE, \"**MATCHES ARRAY:\\n\", FILE_APPEND);\nfile_put_contents(LOG_FILE, print_r($matches, TRUE), FILE_APPEND);\n\n// retrieve selected match from \"current matches\" array\n$selected_match_obj = NULL;\nif ($selected_match_id !== '') {\n\tif (isset($matches[$selected_match_id]))\n\t\t$selected_match_obj = $matches[$selected_match_id];\n\telse\n\t\tfile_put_contents(LOG_FILE, \"**SELECTED MATCH (ID $selected_match_id) NOT FOUND IN SUMMARY FEED\\n\", FILE_APPEND);\n}\nelse\n\tfile_put_contents(LOG_FILE, \"**NO MATCH SELECTED\\n\", FILE_APPEND);\n\n//??? MENUBAR -------------------------------------------------------------------------------------------------\n\nif ($selected_match_obj) { // display selected match information\n\n\tfile_put_contents(LOG_FILE, \"**SELECTED MATCH SUMMARY (MATCH ID $selected_match_id):\\n\", FILE_APPEND);\n\tfile_put_contents(LOG_FILE, print_r($selected_match_obj, TRUE), FILE_APPEND);\n\n\tif ($feed == 'espncricinfo') {\n\t\t$team1_abbrev = translate_name($selected_match_obj-\u003eteam1_abbrev);\n\t\t$team2_abbrev = translate_name($selected_match_obj-\u003eteam2_abbrev);\n\t\t$team1_score = html_entity_decode($selected_match_obj-\u003eteam1_score); // lose \u0026amp; \u0026nbsp; etc\n\t\t$team1_score = trim(strtok($team1_score, '(')); // lose \"(31.4 ov)*\" text\n\t\t$team2_score = html_entity_decode($selected_match_obj-\u003eteam2_score);\n\t\t$team2_score = trim(strtok($team2_score, '('));\n\t\techo\n\t\t\tstrtoupper($team1_abbrev).($team1_score ? ' '.$team1_score : '')\n\t\t\t.' v '\n\t\t\t.strtoupper($team2_abbrev).($team2_score ? ' '.$team2_score : '')\n\t\t\t.\"\\n\"\n\t\t;\n\t}\n\n\telse if ($feed == 'cricbuzz') {\n\t\t$team1_abbrev = (string)$selected_match_obj-\u003eTm[0]-\u003eattributes()['sName'];\n\t\t$team2_abbrev = (string)$selected_match_obj-\u003eTm[1]-\u003eattributes()['sName'];\n\t\t$team1_score1 = $team1_score2 = $team2_score1 = $team2_score2 = '';\n\t\t$team1_batting = $team2_batting = FALSE;\n\t\tif (isset($selected_match_obj-\u003emscr)) { // no scores for games yet to start\n\t\t\t$scores = $overs = array();\n\t\t\t$this_team = (string)$selected_match_obj-\u003emscr-\u003ebtTm-\u003eattributes()['sName'];\n\t\t\tforeach ($selected_match_obj-\u003emscr-\u003ebtTm-\u003eInngs as $innings_obj) {\n\t\t\t\t$scores[] =\n\t\t\t\t\t(int)$innings_obj-\u003eattributes()['r']\n\t\t\t\t\t.((int)$innings_obj-\u003eattributes()['wkts'] == 10 ? '' : '/'.(int)$innings_obj-\u003eattributes()['wkts'])\n\t\t\t\t\t.((int)$innings_obj-\u003eattributes()['Decl'] ? 'd' : '')\n\t\t\t\t;\n\t\t\t\t$overs[] = (string)$innings_obj-\u003eattributes()['ovrs'];\n\t\t\t}\n\t\t\t$scores = array_reverse($scores); // force second innings score to be last\n\t\t\tif ($this_team == $team1_abbrev) {\n\t\t\t\t$team1_batting = TRUE;\n\t\t\t\t$team1_score1 = (isset($scores[0]) ? $scores[0] : '');\n\t\t\t\t$team1_score2 = (isset($scores[1]) ? $scores[1] : '');\n\t\t\t\t$team1_overs = $overs[0];\n\t\t\t\tfile_put_contents(LOG_FILE, \"**BATTING TEAM(1): $this_team\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, \"--team1_score1=$team1_score1, team1_score2=$team1_score2, team1_overs=$team1_overs\\n\", FILE_APPEND);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$team2_batting = TRUE;\n\t\t\t\t$team2_score1 = (isset($scores[0]) ? $scores[0] : '');\n\t\t\t\t$team2_score2 = (isset($scores[1]) ? $scores[1] : '');\n\t\t\t\t$team2_overs = $overs[0];\n\t\t\t\tfile_put_contents(LOG_FILE, \"**BATTING TEAM(2): $this_team\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, \"--team2_score1=$team2_score1, team2_score2=$team2_score2, team2_overs=$team2_overs\\n\", FILE_APPEND);\n\t\t\t}\n\t\t\t$scores = array();\n\t\t\t$this_team = (string)$selected_match_obj-\u003emscr-\u003eblgTm-\u003eattributes()['sName'];\n\t\t\tforeach ($selected_match_obj-\u003emscr-\u003eblgTm-\u003eInngs as $innings_obj) {\n\t\t\t\t$scores[] =\n\t\t\t\t\t(int)$innings_obj-\u003eattributes()['r']\n\t\t\t\t\t.((int)$innings_obj-\u003eattributes()['wkts'] == 10 ? '' : '/'.(int)$innings_obj-\u003eattributes()['wkts'])\n\t\t\t\t\t.((int)$innings_obj-\u003eattributes()['Decl'] ? 'd' : '')\n\t\t\t\t;\n\t\t\t}\n\t\t\t$scores = array_reverse($scores); // test match scores have 2nd innings first\n\t\t\tif ($this_team == $team1_abbrev) {\n\t\t\t\t$team1_score1 = (isset($scores[0]) ? $scores[0] : '');\n\t\t\t\t$team1_score2 = (isset($scores[1]) ? $scores[1] : '');\n\t\t\t\tfile_put_contents(LOG_FILE, \"**BOWLING TEAM(1): $this_team\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, \"--team1_score1=$team1_score1, team1_score2=$team1_score2\\n\", FILE_APPEND);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$team2_score1 = (isset($scores[0]) ? $scores[0] : '');\n\t\t\t\t$team2_score2 = (isset($scores[1]) ? $scores[1] : '');\n\t\t\t\tfile_put_contents(LOG_FILE, \"**BOWLING TEAM(2): $this_team\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, \"--team2_score1=$team2_score1, team2_score2=$team2_score2\\n\", FILE_APPEND);\n\t\t\t}\n\t\t}\n\t\techo\n\t\t\t$team1_abbrev.($team1_score1 ? ' '.$team1_score1 : '').($team1_score2 ? ' \u0026 '.$team1_score2 : '')\n\t\t\t.' v '\n\t\t\t.$team2_abbrev.($team2_score1 ? ' '.$team2_score1 : '').($team2_score2 ? ' \u0026 '.$team2_score2 : '')\n\t\t\t.\"\\n\"\n\t\t;\n\t}\n}\n\nelse { // display icon - 32x32 png, 144 DPI, base64 encoded using \"openssl base64 -A -in icon.png\" (recommended 36px dimension too big)\n\tif ($summary_feed) // normal icon\n\t\techo \"|image=iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4QMOAi05yhhp7QAAASNJREFUWMPt1ztKBEEUheGvB0UnECcYQXQE3YAyCIK4BVeiiJswMtDcwA2IgbmRGzBxB4IoGijoKL7apEaKtuYBCiZ1oIK6fe65f3d1UvTWPHZwhzJarzhCO/gWcYKHiu8a+5juM8NIn2dTWMNLCIvVxhzOMYMlPKITeT6wgolE/7eKRG0MdbzhCctohLcqQv0sBI+Hwc/RsK7vBheYxCjecT/oC6xjKwQUuMJGAIm1G8C6vlPsBZCuWjjEQoB6wzEO+h3JZeUcS2wnIKvn3cFq5KlhM5F1Wx1Yq+xbCajZyr6Z6KuHFec2ElnNQQDD/id/ppp/VgbIABkgA2SADJABMkAGyAAZoApQ/iJrmPvD56C7YZkITUGVUb1I9BY96j+yvgC5iURRySFvJAAAAABJRU5ErkJggg==\\n\";\n\telse // warning icon\n\t\techo \"|image=iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4QgYCQ84FFrJ6AAABC9JREFUWMPll01sVFUUgL87P7UzUDqdn6bQob8DLWpTbIeWFrCIDdIC2poYDYq2gI3QWjFYFWJCNWlrIhsNooEoCmI0qBt/Nizc6YYdi5qgIVGwTa0lYNtpZ96Pi7kz8+Y5Zcb+JCae5Oa9uffMO98795xzz4P/uGQD3cCvgG4Yk8AQ4JF6HwG/mXSuAv3pDNjSrGtS5xowIecEMCuvupxTDTq6XJsArOkAxBzzVmC1XB+Rv1cY/jMD3AJqgIh8Ww3IMwCMAV4gX85dydTtRcCwyZ0PmXQqTesh4EGTTo/0TEznptzSJLGkAKiQBozSafr9bIpYedjkwe2m57uAHZkAZCI6QJ7LgRDCGC/G52qZbPl8AVSA3v1B3joe97x9Pg+aD4AN2FNW7KLjiWqO9DVRdXc+QCsQWHIAIRgA/K/0bKJkrQ+mwlx4tw27zVIKHF5qgGpdp3NrYzFd+4MQioCmc0+Fj8Nd9ciiVSdTc0kAjgiB7/PTj6KEIoRmFEIzCqqq0fV0DaVFLoCvjIG6WABhYCuwd+jYNvLzlzP09g+U1Z1kbeMpul76jsAGPwc7agEKBQxm6oVMAdzAp1Xr8tm3Zz0Af96cZnRskuu/32Z0bApmFfqeb6SmqgAdDsgquWgArTabZWVfdwO+ghwZjImUtlhEvN59+eFjAD6gfDEBxKa61ex9phYiaiwbjJkhS5FOSbGLYy9sXtwscDhsfPZ+O8wkttWT54jfe90O0PU4xKHOWtaUuRcP4L03WylYmQOqNKLrlJfkJQ6Pck9iDSj059KzbwM2q2XhAPdvLKKtpSLJADqURFMOIPq2qqH0Kxq9BzdSEfAsDOCuLBt9hxrINbg7JjnLsrDZLAkA7Z9pf+FU28IAdjYH2LWzMvntYnGRbcfndqbcAgAiKtX3raK/r2l+AFaLhXMnH0lpPApgw+OOeibb40wEYVL5UunpDFIZ8P4rgDKAs+/sZpkrO6VrAZwOO2vKPDQE/XNCAni8Tl7ubsAaDchgugbBDfzSsi3g+vr841itYm7f2a3cmphGVTXcq3LRp8JJtcFoIRLWaGo/x4+Xr4eAemN/aPbAeVdututob+OdjQvBmbOXCW7/gM27P6b/9UsIp33O3snusHH6RCuAAxgw2jUCtAOtbTsq2LKlNG0v/cf4ND9fm2D46jg3RibBcgdgRePeWj8vPlePbHBbzABeYNDrdnLieDNoWvrjUVHj97MRde4GPyZTYQaPPkCg1J0FvBFr4YQcrwKDly4+SfOudTCrpAW4PT7FyOgkQoA7z4nXvyJ1wOrJnvv2m2HaOi6iKNprwIAACoGfvG7n8gNPrUfXEqEp4lsuDNsvkg6g6FWkOKBS64VCET754go3Rv8CKAY4Y/i4mJGfXappKHI+LK+KbLuNI6anyHvjWuzjxDz3Pf97+Rtb1UL3NeDX6QAAAABJRU5ErkJggg==\\n\";\n}\n\n//??? SUBMENU -------------------------------------------------------------------------------------------------\n\n// no data\nif (!$summary_feed) {\n\techo \"---\\n\";\n\techo \"Unable to get \".$feed_info[$feed]['name'].\" data\\n\";\n}\n\n// detailed match information\nif ($selected_match_obj) {\n\n\techo \"---\\n\";\n\n\t//??? DETAILED - ESPNcricinfo\n\n\tif ($feed == 'espncricinfo') {\n\t\tif (array_key_exists($selected_match_id, $matches)) {\n\n\t\t\t// get detailed match feed data\n\t\t\t$match_url = $feed_info[$feed]['site_url'].$selected_match_obj-\u003eurl; // note: site url NOT base url\n\t\t\t$detailed_url = str_replace('.html', '.json', $match_url);\n\t\t\t$detailed_feed = curl_obj($detailed_url);\n\t\t\tfile_put_contents(LOG_FILE, \"**DETAILED FEED:\\n\", FILE_APPEND);\n\t\t\tfile_put_contents(LOG_FILE, print_r($detailed_feed, TRUE), FILE_APPEND);\n\n\t\t\tif ($detailed_feed) {\n\n\t\t\t\t// output match overview\n\t\t\t\techo\n\t\t\t\t\tstrtoupper($selected_match_obj-\u003eteam1_name).' v '.strtoupper($selected_match_obj-\u003eteam2_name) // e.g. \"SRI LANKA v BANGLADESH\"\n\t\t\t\t\t.($detailed_feed-\u003eseries[0]-\u003ematch_title ? ' – '.$detailed_feed-\u003eseries[0]-\u003ematch_title : '') // e.g. \"1st Test\"\n\t\t\t\t\t.', '.($detailed_feed-\u003ematch-\u003etown_aka ? $detailed_feed-\u003ematch-\u003etown_aka : $detailed_feed-\u003ematch-\u003etown_name) // e.g. \"Galle\"\n\t\t\t\t\t.' | color=black'.\"\\n\"\n\t\t\t\t;\n\n\t\t\t\t// option key alternative: display series \u0026 match dates, e.g. \"West Indies in England ODI Series (Sep 21, 2017)\"\n\t\t\t\techo\n\t\t\t\t\t$detailed_feed-\u003eseries[0]-\u003eseries_name\n\t\t\t\t\t.(($detailed_feed-\u003eseries[0]-\u003etrophy_name !== $detailed_feed-\u003eseries[0]-\u003eseries_name) ? ' – '.$detailed_feed-\u003eseries[0]-\u003etrophy_name : '') // \"The Ashes\" is both the series \u0026 the trophy name\n\t\t\t\t\t.' ('.$detailed_feed-\u003ematch-\u003edate.')'\n\t\t\t\t\t.\" | alternate=true \\n\";\n\n\t\t\t\t// team id/team name/score array\n\t\t\t\t$teams = array();\n\t\t\t\t$teams[$detailed_feed-\u003ematch-\u003eteam1_id] = array('name' =\u003e $detailed_feed-\u003ematch-\u003eteam1_name, 'score' =\u003e '');\n\t\t\t\t$teams[$detailed_feed-\u003ematch-\u003eteam2_id] = array('name' =\u003e $detailed_feed-\u003ematch-\u003eteam2_name, 'score' =\u003e '');\n\t\t\t\tfile_put_contents(LOG_FILE, \"**TEAMS ARRAY:\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, print_r($teams, TRUE), FILE_APPEND);\n\n\t\t\t\tif (isset($detailed_feed-\u003ematch-\u003ehome_team_id)) {\n\t\t\t\t\t$home_team_id = $detailed_feed-\u003ematch-\u003ehome_team_id;\n\t\t\t\t\tfile_put_contents(LOG_FILE, \"**HOME_TEAM_ID (SUPPLIED) = $home_team_id\\n\", FILE_APPEND);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$home_team_id = $detailed_feed-\u003ematch-\u003eteam1_id;\n\t\t\t\t\tfile_put_contents(LOG_FILE, \"**HOME_TEAM_ID (TEAM1) = $home_team_id\\n\", FILE_APPEND);\n\t\t\t\t}\n\t\t\t\tif (isset($detailed_feed-\u003ematch-\u003eaway_team_id)) {\n\t\t\t\t\t$away_team_id = $detailed_feed-\u003ematch-\u003eaway_team_id;\n\t\t\t\t\tfile_put_contents(LOG_FILE, \"**AWAY_TEAM_ID (SUPPLIED) = $away_team_id\\n\", FILE_APPEND);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$away_team_id = $detailed_feed-\u003ematch-\u003eteam2_id;\n\t\t\t\t\tfile_put_contents(LOG_FILE, \"**AWAY_TEAM_ID (TEAM2) = $away_team_id\\n\", FILE_APPEND);\n\t\t\t\t}\n\n\t\t\t\t// make sure home team listed first\n\t\t\t\treset($teams);\n\t\t\t\t$first_team_id = key($teams);\n\t\t\t\tif ($home_team_id != $first_team_id)\n\t\t\t\t\t$teams = array_reverse($teams, TRUE);\n\n\t\t\t\t// get innings data\n\t\t\t\t$match_started = FALSE;\n\t\t\t\t$winner = $detailed_feed-\u003ematch-\u003ewinner_team_id;\n\t\t\t\tfile_put_contents(LOG_FILE, \"**WINNER: \".$winner.\"\\n\", FILE_APPEND);\n\t\t\t\tif ($detailed_feed-\u003einnings) {\n\t\t\t\t\t$match_started = TRUE;\n\t\t\t\t\tforeach ($detailed_feed-\u003einnings as $innings) {\n\n\t\t\t\t\t\tfile_put_contents(LOG_FILE, \"**INNINGS:\\n\", FILE_APPEND);\n\t\t\t\t\t\tfile_put_contents(LOG_FILE, print_r($innings, TRUE), FILE_APPEND);\n\n\t\t\t\t\t\tif ($teams[$innings-\u003ebatting_team_id]['score'])\n\t\t\t\t\t\t\t// if team's second innings add '\u0026'\n\t\t\t\t\t\t\t$teams[$innings-\u003ebatting_team_id]['score'] .= ' \u0026 ';\n\t\t\t\t\t\t$innings_score = $innings-\u003eruns.'/'.$innings-\u003ewickets;\n\t\t\t\t\t\tif ($innings-\u003elive_current \u0026\u0026 ($innings-\u003eevent_name != 'complete') \u0026\u0026 !$winner) {\n\t\t\t\t\t\t\t$innings_score .= ' ('.$innings-\u003eovers.' ov)';\n\t\t\t\t\t\t\t$innings_score .= ' CRR '.$detailed_feed-\u003elive-\u003einnings-\u003erun_rate;\n\t\t\t\t\t\t\tfile_put_contents(LOG_FILE, \"**TARGET: \".$detailed_feed-\u003elive-\u003einnings-\u003etarget.\"\\n\", FILE_APPEND);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$teams[$innings-\u003ebatting_team_id]['score'] .= $innings_score;\n\t\t\t\t\t\t$teams[$innings-\u003ebatting_team_id]['batted'] = $innings-\u003ebatted; // make a note if team has batted yet\n\n\t\t\t\t\t\tfile_put_contents(LOG_FILE, \"**OVER_LIMIT \".$innings-\u003eover_limit.\"\\n\", FILE_APPEND);\n\t\t\t\t\t\tfile_put_contents(LOG_FILE, \"**TEAM DATA (TEAM ID \".$innings-\u003ebatting_team_id.\"):\\n\", FILE_APPEND);\n\t\t\t\t\t\tfile_put_contents(LOG_FILE, print_r($teams[$innings-\u003ebatting_team_id], TRUE), FILE_APPEND);\n\n\t\t\t\t\t\tif ($innings-\u003elive_current \u0026\u0026 !$winner) {\n\t\t\t\t\t\t\t// required run rate\n\t\t\t\t\t\t\t$required_runrate = $detailed_feed-\u003elive-\u003einnings-\u003erequired_run_rate;\n\t\t\t\t\t\t\tif ($required_runrate)\n\t\t\t\t\t\t\t\t$teams[$innings-\u003ebatting_team_id]['score'] .= ' RRR '.$required_runrate;\n\t\t\t\t\t\t\t// projected score\n\t\t\t\t\t\t\tif (($innings-\u003eevent_name != 'complete') \u0026\u0026 ($innings-\u003eevent_name != 'all out')) {\n\t\t\t\t\t\t\t\t$noofovers = (int)$innings-\u003eover_limit;\n\t\t\t\t\t\t\t\tif ((int)$innings-\u003eball_limit \u0026\u0026 ($innings-\u003eovers \u003e $noofovers / 2))\n\t\t\t\t\t\t\t\t\t$teams[$innings-\u003ebatting_team_id]['score'] .= projected_score($noofovers, $innings-\u003eovers, $innings-\u003eruns);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// get names/scores of batsmen at crease\n\t\t\t\t$batsmen = array();\n\t\t\t\tforeach ($detailed_feed-\u003elive-\u003ebatting as $batsman) {\n\t\t\t\t\t$batsman_name = get_batsman($detailed_feed,$batsman-\u003eplayer_id);\n\t\t\t\t\t$batsman_score = $batsman-\u003eruns . ' (' . $batsman-\u003eballs_faced . ')';\n\t\t\t\t\tif ($batsman-\u003elive_current_name == 'striker')\n\t\t\t\t\t\t$batsman_name .= '*';\n\t\t\t\t\t$batsmen[] = $batsman_name . ': ' . $batsman_score;\n\t\t\t\t}\n\t\t\t\tfile_put_contents(LOG_FILE, \"**BATSMEN:\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, print_r($batsmen, TRUE), FILE_APPEND);\n\n\t\t\t\t// the match status\n\t\t\t\t$match_status = $detailed_feed-\u003elive-\u003estatus;\n\t\t\t\tfile_put_contents(LOG_FILE, \"**MATCH STATUS: \".$match_status.\"\\n\", FILE_APPEND);\n\t\t\t\techo \"$match_status... | href=$match_url \\n\"; // e.g. \"Day 1: South Africa elected to bat first\" which links to Cricinfo website\n\n\t\t\t\t// neutral ground?\n\t\t\t\t$neutral_ground = FALSE;\n\t\t\t\tif (isset($detailed_feed-\u003ematch-\u003eneutral_match))\n\t\t\t\t\t$neutral_ground = $detailed_feed-\u003ematch-\u003eneutral_match;\n\n\t\t\t\t// work out match type\n\t\t\t\t$limited_overs = $detailed_feed-\u003ematch-\u003escheduled_overs;\n\t\t\t\t$type_desc = '';\n\t\t\t\tif (strpos($detailed_feed-\u003ematch-\u003einternational_class_card,'Test') !== FALSE) // \"Test\" or \"Women's Test\"\n\t\t\t\t\t$type_desc .= 'Test match, '.$detailed_feed-\u003ematch-\u003escheduled_days.' days';\n\t\t\t\telse if (strpos($detailed_feed-\u003ematch-\u003einternational_class_card,'ODI') !== FALSE)\n\t\t\t\t\t$type_desc = 'ODI';\n\t\t\t\telse if (strpos($detailed_feed-\u003ematch-\u003einternational_class_card,'Twenty20') !== FALSE)\n\t\t\t\t\t$type_desc = 'T20 international';\n\t\t\t\telse if ($detailed_feed-\u003ematch-\u003egeneral_class_card) { // county matches, some T20 etc\n\t\t\t\t\tif (strpos($detailed_feed-\u003ematch-\u003egeneral_class_name,'Twenty20') !== FALSE)\n\t\t\t\t\t\t$type_desc .= 'T20';\n\t\t\t\t\telse {\n\t\t\t\t\t\t$type_desc = $detailed_feed-\u003ematch-\u003egeneral_class_card.' match, '.$detailed_feed-\u003ematch-\u003escheduled_days.' day'.($detailed_feed-\u003ematch-\u003escheduled_days \u003e 1 ? 's' : '');\n\t\t\t\t\t\tif ($detailed_feed-\u003ematch-\u003escheduled_overs)\n\t\t\t\t\t\t\t$type_desc .= ', '.$detailed_feed-\u003ematch-\u003escheduled_overs.' overs';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (strpos($detailed_feed-\u003ematch-\u003egeneral_class_name,'Twenty20') !== FALSE) // e.g. \"Other Twenty20 matches\"\n\t\t\t\t\t\t$type_desc .= 'T20';\n\t\t\t\tfile_put_contents(LOG_FILE, \"**MATCH TYPE: $type_desc (international_class_card=\".$detailed_feed-\u003ematch-\u003einternational_class_card.\", general_class_card=\".$detailed_feed-\u003ematch-\u003egeneral_class_card.\", general_class_name=\".$detailed_feed-\u003ematch-\u003egeneral_class_name.', scheduled days='.$detailed_feed-\u003ematch-\u003escheduled_days.', scheduled overs='.$detailed_feed-\u003ematch-\u003escheduled_overs.\")\\n\", FILE_APPEND);\n\n\t\t\t\t// option key alternative - display ground name, country \u0026 match type\n\t\t\t\techo $detailed_feed-\u003ematch-\u003eground_name.', '.$detailed_feed-\u003ematch-\u003ecountry_name.($neutral_ground ? ' - neutral ground' : '').($type_desc ? \" ($type_desc)\" : '').\" | alternate=true \\n\"; // e.g. \"P Sara Oval, Columbo, Sri Lanka\"\n\n\t\t\t\t// match live state (not really usable for \"innings in progress\" - seems to be free text, i.e. no standardised values)\n\t\t\t\t$known_live_state = array('Drinks', 'Lunch', 'Innings break', 'Match delayed by a wet outfield', 'Match delayed by rain', 'Match delayed - Rain', 'Match start delayed (No play before Lunch, wet outfield)', 'Match delayed - Wet outfield', 'Stumps'); // ALSO SOMETIMES NOT SET (= MATCH NOT STARTED/ENDED/IN PLAY?)\n\t\t\t\t$live_state == NULL;\n\t\t\t\tif (isset($selected_match_obj-\u003elive_state)) {\n\t\t\t\t\t$live_state = $selected_match_obj-\u003elive_state;\n\t\t\t\t\techo $live_state;\n\t\t\t\t\tif ($match_started) {\n\t\t\t\t\t\t// get kickoff time\n\t\t\t\t\t\t$next_timestamp = strtotime($detailed_feed-\u003ematch-\u003enext_datetime_gmt.' UTC'); // may take a while to be updated after end of day's play\n\t\t\t\t\t\tfile_put_contents(LOG_FILE, \"**NEXT_DATETIME_GMT: \".$detailed_feed-\u003ematch-\u003enext_datetime_gmt.\"\\n\", FILE_APPEND);\n\t\t\t\t\t\tfile_put_contents(LOG_FILE, \"**NEXT_TIMESTAMP: \".$next_timestamp.' '.date('Y-m-d H:i',$next_timestamp).\"\\n\", FILE_APPEND);\n\t\t\t\t\t\tfile_put_contents(LOG_FILE, \"**TIME(): \".time().\"\\n\", FILE_APPEND);\n\t\t\t\t\t\tif ($next_timestamp \u003e time())  // still waiting for kickoff (according to published next start time)\n\t\t\t\t\t\t\techo \" (resumes \".date(\"l, H:i T\", $next_timestamp).\")\";\n\t\t\t\t\t}\n\t\t\t\t\techo \"\\n\";\n\t\t\t\t}\n\n\t\t\t\t// match yet to begin so provide local start date/time\n\t\t\t\tif (strpos($match_status, 'Match scheduled to begin') === 0) { // add local time translation\n\t\t\t\t\t// translate start date/time to local time\n\t\t\t\t\t$start_datetime_gmt = $detailed_feed-\u003ematch-\u003estart_datetime_gmt;\n\t\t\t\t\tfile_put_contents(LOG_FILE, \"**START_DATETIME_GMT: \".$detailed_feed-\u003ematch-\u003estart_datetime_gmt.\"\\n\", FILE_APPEND);\n\t\t\t\t\t$start_timestamp = strtotime($detailed_feed-\u003ematch-\u003estart_datetime_gmt.' UTC');\n\t\t\t\t\tfile_put_contents(LOG_FILE, \"**START_TIMESTAMP: \".$start_timestamp.' '.date('Y-m-d H:i',$start_timestamp).\"\\n\", FILE_APPEND);\n\t\t\t\t\t$start_local = date(\"jS M g:ia T\", $start_timestamp);\n\t\t\t\t\techo \"Scheduled start $start_local\\n\";\n\t\t\t\t}\n\t\t\t\telse // toss done, use countdown timer instead\n\t\t\t\t\tif (isset($selected_match_obj-\u003ematch_clock))\n\t\t\t\t\t\tif (!$detailed_feed-\u003einnings) // countdown can linger for a while after play starts\n\t\t\t\t\t\t\techo \"Starting in \".$selected_match_obj-\u003ematch_clock.\"\\n\";\n\n\t\t\t\t// show teams and scores\n\t\t\t\tif ($match_started) {\n\t\t\t\t\tforeach ($teams as $team_id =\u003e $team_info) {\n\t\t\t\t\t\techo $team_info['name'] .': ';\n\t\t\t\t\t\tif ($team_info['batted']) {\n\t\t\t\t\t\t\t$score = str_replace('/10', '', $team_info['score']); // lose wicket count if 10 (i.e. all out)\n\t\t\t\t\t\t\tif ($winner)\n\t\t\t\t\t\t\t\t$score = str_replace('*', '', $score); // lose \"currently batting\" asterisk if match over\n\t\t\t\t\t\t\techo $score;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\techo 'yet to bat';\n\t\t\t\t\t\techo \" | color=black size=12 \\n\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// innings still in progress and not innings break?\n\t\t\t\tif (!$winner \u0026\u0026 ($detailed_feed-\u003ematch-\u003elive_state != 'Innings break')) {\n\t\t\t\t\t// show batsmen\n\t\t\t\t\tforeach ($batsmen as $batsman)\n\t\t\t\t\t\techo \"$batsman | size=12 \\n\";\n\n\t\t\t\t\t// last wicket\n\t\t\t\t\t$fow = $detailed_feed-\u003elive-\u003efow;\n\t\t\t\t\tforeach ($fow as $item) {\n\t\t\t\t\t\tif ($item-\u003elive_current_name == 'current partnership') {\n\t\t\t\t\t\t\techo\n\t\t\t\t\t\t\t\t'Partnership: '\n\t\t\t\t\t\t\t\t.$item-\u003epartnership_runs\n\t\t\t\t\t\t\t\t.' ('\n\t\t\t\t\t\t\t\t.$item-\u003epartnership_overs\n\t\t\t\t\t\t\t\t.' ov) '\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ($item-\u003elive_current_name == 'last wicket') {\n\t\t\t\t\t\t\techo\n\t\t\t\t\t\t\t\t'Last wicket: '\n\t\t\t\t\t\t\t\t.get_batsman($detailed_feed,$item-\u003eout_player-\u003eplayer_id)\n\t\t\t\t\t\t\t\t.' '\n\t\t\t\t\t\t\t\t.html_entity_decode($item-\u003eout_player-\u003edismissal_string)\n\t\t\t\t\t\t\t\t.' '\n\t\t\t\t\t\t\t\t.$item-\u003eout_player-\u003eruns\n\t\t\t\t\t\t\t\t.\" | size=12\"\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tfile_put_contents(LOG_FILE, \"**LAST WICKET (PLAYER ID = \".$item-\u003eout_player-\u003eplayer_id.\"):\\n\", FILE_APPEND);\n\t\t\t\t\t\t\tfile_put_contents(LOG_FILE, print_r($item-\u003eout_player, TRUE), FILE_APPEND);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ($fow)\n\t\t\t\t\t\techo \"\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\techo \"Detailed feed not available... | href=$match_url \\n\";\n\n\t\t\t// debuggery\n\t\t\tfile_put_contents(LOG_FILE, \"**URL: $detailed_url\\n\", FILE_APPEND);\n\t\t\tfile_put_contents(LOG_FILE, '**MATCH STARTED: '.($match_started ? 'YES' : 'NO').\"\\n\", FILE_APPEND);\n\t\t\tfile_put_contents(LOG_FILE, \"**LIVE_STATE: \".($live_state === NULL ? 'NOT SET' : $live_state).\"\\n\", FILE_APPEND);\n\t\t\tif ($winner) file_put_contents(LOG_FILE, \"**WINNER TEAM ID: $winner\\n\", FILE_APPEND);\n\n\t\t}\n\t\telse // else selected match not found\n\t\t\tfile_put_contents(LOG_FILE, \"**SELECTED MATCH NOT FOUND IN DETAILED FEED: \".$selected_match_id.\"\\n\", FILE_APPEND);\n\t}\n\n\t//??? DETAILED - CRICBUZZ\n\n\telse if ($feed == \"cricbuzz\") {\n\t\t// output match overview\n\t\tif (isset($selected_match_obj-\u003eTm)) { // these are generally abbreviated names anyway!\n\t\t\t$team1_name = $selected_match_obj-\u003eTm[0]-\u003eattributes()['Name'];\n\t\t\t$team2_name = $selected_match_obj-\u003eTm[1]-\u003eattributes()['Name'];\n\t\t\tfile_put_contents(LOG_FILE, \"**TEAM NAMES FROM -\u003eTm: team1_name=$team1_name, team2_name=$team2_name\\n\", FILE_APPEND);\n\t\t}\n\t\telse {\n\t\t\t$team_names = explode(' vs ', (string)$selected_match_obj-\u003eattributes()['mchDesc']); // e.g. \"Ess vs WI\"\n\t\t\t$team1_name = $team_names[0];\n\t\t\t$team2_name = $team_names[1];\n\t\t\tfile_put_contents(LOG_FILE, \"**TEAM NAMES FROM -\u003emchDesc: team1_name=$team1_name, team2_name=$team2_name\\n\", FILE_APPEND);\n\t\t}\n\t\t$description = strtoupper(translate_name($team1_name)).' v '.strtoupper(translate_name($team2_name)); // translate abbreviated team names \u0026 use \"v\" instead of \"vs\"\n\t\techo\n\t\t\t$description // e.g. \"Essex vs West Indies\"\n\t\t\t.' – '.(string)$selected_match_obj-\u003eattributes()['mnum'] // e.g. \"1st 3-day practice match\"\n\t\t\t.', '.(string)$selected_match_obj-\u003eattributes()['vcity'] // e.g. Chelmsford\n\t\t\t.' | color=black size=14'\n\t\t\t.\"\\n\"\n\t\t;\n\n\t\tif (isset($selected_match_obj-\u003eTme)) { // note -\u003eTme may not exist: e.g. mchState=nextlive, status=\"Coming up on Sep 15 at 13:30 GMT\"\n\t\t\t// option key alternative - display match tour \u0026 dates, e.g. \"West Indies tour of England, 2017; 1st August - 3rd August\"\n\t\t\t$start_date = date(\"jS F\", strtotime((string)$selected_match_obj-\u003eTme-\u003eattributes()['Dt']));\n\t\t\t$end_date = date(\"jS F\", strtotime((string)$selected_match_obj-\u003eTme-\u003eattributes()['enddt']));\n\t\t\techo\n\t\t\t\t(string)$selected_match_obj-\u003eattributes()['srs']\n\t\t\t\t.' ('\n\t\t\t\t.$start_date\n\t\t\t\t.($start_date != $end_date ? \" – $end_date\" : '')\n\t\t\t\t.')'\n\t\t\t\t.\" | alternate=true \\n\"\n\t\t\t;\n\n\t\t\t// local start date/time\n\t\t\t$start_gmt = (string)$selected_match_obj-\u003eTme-\u003eattributes()['Dt'].' '.(string)$selected_match_obj-\u003eTme-\u003eattributes()['stTme'].' GMT';\n\t\t\t$start_local = date(\"jS M g:ia T\", strtotime($start_gmt));\n\t\t}\n\n\t\t// output match status\n\t\t$status_message = array();\n\t\t$status = (string)$selected_match_obj-\u003estate-\u003eattributes()['status']; // e.g. \"Day 1: Stumps\", \"Ess trail by 291 runs\", \"No result\"\n\t\t$status_message[] = translate_names($status); // translate abbreviated team names\n\t\tif ((string)$selected_match_obj-\u003estate-\u003eattributes()['addnStatus'])\n\t\t\t$status_message[] = (string)$selected_match_obj-\u003estate-\u003eattributes()['addnStatus']; // e.g. \"Day 2: Rain stops play\", \"No result\"\n\t\tif (strpos($status_message[1], 'Day ') !== FALSE) // sometimes \"Day x: ...\" message is in 'addnStatus'\n\t\t\t$status_message = array_reverse($status_message);\n\t\t$status_message = array_unique($status_message); // to get rid of duplicate messages, e.g. \"Day 1: 2nd Session\", \"No result\"\n\t\techo implode(' - ', $status_message).\" | color=black size=14 \\n\";\n\n\t\t// work out if innings in progress\n\t\t// mchState values... NOTE: still 'lunch' \u0026 'tea' for day/night tests, i.e. no 'dinner'\n\t\t//???CHECK WHAT HAPPENS IF INNINGS BREAK \u0026 LUNCH/TEA COINCIDE\n\t\t$known_mchState = array('nextlive', 'preview', 'delay', 'inprogress', 'lunch', 'tea', 'stump', 'innings break', 'rain', 'wetoutfield', 'badlight', 'unforeseen', 'complete', 'Result', 'abandon');\n\t\t$match_state = (string)$selected_match_obj-\u003estate-\u003eattributes()['mchState'];\n\t\t$in_progress = (array_search($match_state, array('inprogress', 'lunch', 'tea', 'stump', 'rain', 'badlight', 'wetoutfield', 'unforeseen')) !== FALSE);\n\t\tfile_put_contents(LOG_FILE, \"**MATCH STATE: \".$match_state.\" (\".($in_progress ? '' : 'NOT ').\"IN PROGRESS)\\n\", FILE_APPEND);\n\n// record unknown match states\nif (array_search($match_state, $known_mchState) === FALSE)\n\tfile_put_contents(DEBUG_FILE, $match_state.\"\\n\", FILE_APPEND);\n\n\t\t// match type: \"TEST\", \"ODI\", \"T20\"\n\t\t$type = (string)$selected_match_obj-\u003eattributes()['type'];\n\t\t$limited_overs = (($type == 'ODI') || ($type == 'T20'));\n\t\t$noofovers = NULL;\n\t\tif ($limited_overs) { // note: mscr-\u003einngsdetail-\u003eattributes()['noofovers'] can be incorrect (e.g. 50 given for T20 match)\n\t\t\t$noofovers = 50;\n\t\t\tif ($type == 'T20')\n\t\t\t\t$noofovers = 20;\n\t\t}\n\t\tfile_put_contents(LOG_FILE, \"**MATCH TYPE: $type\\n\", FILE_APPEND);\n\t\tfile_put_contents(LOG_FILE, \"**LIMITED OVERS: $limited_overs\\n\", FILE_APPEND);\n\t\tif (isset($selected_match_obj-\u003emscr-\u003einngsdetail))\n\t\t\tfile_put_contents(LOG_FILE, \"**NO OF OVERS (SUPPLIED): \".$selected_match_obj-\u003emscr-\u003einngsdetail-\u003eattributes()['noofovers'].\"\\n\", FILE_APPEND);\n\t\tfile_put_contents(LOG_FILE, \"**NO OF OVERS (DEDUCED): $noofovers\\n\", FILE_APPEND);\n\n\t\t// option key alternative - display ground name, country \u0026 match type\n\t\techo\n\t\t\t(string)$selected_match_obj-\u003eattributes()['grnd'] // e.g. \"County Ground\"\n\t\t\t.', '.(string)$selected_match_obj-\u003eattributes()['vcity'] // e.g. \"Chelmsford\"\n\t\t\t.', '.(string)$selected_match_obj-\u003eattributes()['vcountry'] // e.g. \"England\"\n\t\t\t.($type ? \" ($type)\" : '')\n\t\t\t.\" | alternate=true \\n\"\n\t\t;\n\n\t\tif (strpos($status, 'Starts on') === 0) // add local start time\n\t\t\techo \"Scheduled start $start_local\\n\";\n\n\t\t// if match has started (or ended) show teams \u0026 scores, checking that there's some scores to look at (plus if innings in progress: overs, CRR, RRR, Proj Scr)\n\t\tif (((string)$selected_match_obj-\u003estate-\u003eattributes()['mchState'] != 'preview') \u0026\u0026 isset($selected_match_obj-\u003emscr)) {\n\t\t\tif (isset($selected_match_obj-\u003emscr-\u003einngsdetail-\u003eattributes()['crr'])) {\n\t\t\t\t$ov_crr_rrr = '';\n\t\t\t\tif ($in_progress) {\n\t\t\t\t\t$ov_crr_rrr = ' CRR '.(string)$selected_match_obj-\u003emscr-\u003einngsdetail-\u003eattributes()['crr'];\n\t\t\t\t\tif ((int)$selected_match_obj-\u003emscr-\u003einngsdetail-\u003eattributes()['rrr'])\n\t\t\t\t\t\t$ov_crr_rrr .= ' RRR '.(string)$selected_match_obj-\u003emscr-\u003einngsdetail-\u003eattributes()['rrr'];\n\t\t\t\t\tif ($team1_batting) {\n\t\t\t\t\t\t$overs = \" ($team1_overs ov)\";\n\t\t\t\t\t\tif ($team1_score2)\n\t\t\t\t\t\t\t$team1_score2 .= $overs.$ov_crr_rrr;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t$team1_score1 .= $overs.$ov_crr_rrr;\n\t\t\t\t\t\t// projected score\n\t\t\t\t\t\tif ($limited_overs \u0026\u0026 ((int)$team1_overs \u003e ($noofovers / 2)))\n\t\t\t\t\t\t\t$team1_score1 .= projected_score($noofovers, $team1_overs, $team1_score1);\n\t\t\t\t\t}\n\t\t\t\t\telse if ($team2_batting) {\n\t\t\t\t\t\t$overs = \" ($team2_overs ov)\";\n\t\t\t\t\t\tif ($team2_score2)\n\t\t\t\t\t\t\t$team2_score2 .= $overs.$ov_crr_rrr;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t$team2_score1 .= $overs.$ov_crr_rrr;\n\t\t\t\t\t\t// projected score\n\t\t\t\t\t\tif ($limited_overs \u0026\u0026 ((int)$team2_overs \u003e ($noofovers / 2)))\n\t\t\t\t\t\t\t$team2_score1 .= projected_score($noofovers, $team2_overs, $team2_score1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\techo\n\t\t\t\ttranslate_name($team1_abbrev)\n\t\t\t\t.\": \"\n\t\t\t\t.($team1_score1 ?  $team1_score1 : 'yet to bat')\n\t\t\t\t.($team1_score2 ? ' \u0026 ' . $team1_score2 : '')\n\t\t\t\t.' | color=black size=12'\n\t\t\t\t.\"\\n\"\n\t\t\t;\n\t\t\techo\n\t\t\t\ttranslate_name($team2_abbrev)\n\t\t\t\t.\": \"\n\t\t\t\t.($team2_score1 ?  $team2_score1 : 'yet to bat')\n\t\t\t\t.($team2_score2 ? ' \u0026 ' . $team2_score2 : '')\n\t\t\t\t.' | color=black size=12'\n\t\t\t\t.\" \\n\"\n\t\t\t;\n\t\t}\n\n\t\t// show batsmen, scores, current partnership, last wicket (if innings still in progress)\n\t\tif ($in_progress) {\n\t\t\tif (isset($selected_match_obj-\u003emscr-\u003ebtsmn)) { // not available if datapath (\u0026 hence detailed feed) not set\n\t\t\t\tforeach ($selected_match_obj-\u003emscr-\u003ebtsmn as $batsman) // works for single obj or array of obj\n\t\t\t\t\techo\n\t\t\t\t\t\t(string)$batsman-\u003eattributes()['sName']\n\t\t\t\t\t\t.\": \"\n\t\t\t\t\t\t.(string)$batsman-\u003eattributes()['r']\n\t\t\t\t\t\t.' ('\n\t\t\t\t\t\t.(string)$batsman-\u003eattributes()['b']\n\t\t\t\t\t\t.')'\n\t\t\t\t\t\t.\" | size=12 \\n\"\n\t\t\t\t\t;\n\t\t\t\t$partnership = (string)$selected_match_obj-\u003emscr-\u003einngsdetail-\u003eattributes()['cprtshp'];\n\t\t\t\tif ($partnership)\n\t\t\t\t\techo\n\t\t\t\t\t\t'Partnership: '\n\t\t\t\t\t\t.str_replace('(', ' (', (string)$selected_match_obj-\u003emscr-\u003einngsdetail-\u003eattributes()['cprtshp'])\n\t\t\t\t\t\t.' '\n\t\t\t\t\t;\n\t\t\t\t// get current scoreboard\n\t\t\t\t$selected_scorecard_url = (string)$selected_match_obj-\u003eattributes()['datapath'].'scorecard.xml';\n\t\t\t\t$selected_scorecard_obj = curl_obj($selected_scorecard_url);\n\t\t\t\tfile_put_contents(LOG_FILE, \"**SCORECARD:\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, print_r($selected_scorecard_obj, TRUE), FILE_APPEND);\n\t\t\t\t// get current innings\n\t\t\t\t$current_innings = $selected_scorecard_obj-\u003escrs-\u003eInngs[0]; // current innings comes first\n\t\t\t\tfile_put_contents(LOG_FILE, \"**CURRENT INNINGS:\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, print_r($current_innings, TRUE), FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, \"**TARGET: \".$current_innings-\u003eattributes()['Target'].\"\\n\", FILE_APPEND);\n\t\t\t\t// look at fall of wickets\n\t\t\t\t$last_wicket= '';\n\t\t\t\tforeach ($current_innings-\u003eFOW-\u003ewkt as $wicket) // go through wickets \u0026 get last one\n\t\t\t\t\t$last_wicket = $wicket;\n\t\t\t\tfile_put_contents(LOG_FILE, \"**LAST WICKET:\\n\", FILE_APPEND);\n\t\t\t\tfile_put_contents(LOG_FILE, print_r($last_wicket, TRUE), FILE_APPEND);\n\t\t\t\tif ($last_wicket) {\n\t\t\t\t\t$last_wicket_player_id = str_replace(',', '', (string)$last_wicket-\u003eattributes()['id']); // the ID here is formatted 9,585 !!!!\n\t\t\t\t\t$last_wicket_player = (string)$last_wicket-\u003eattributes()['btsmn'];\n\t\t\t\t\techo 'Last wicket: '.$last_wicket_player;\n\t\t\t\t\tfile_put_contents(LOG_FILE, \"**LAST WICKET PLAYER ID: $last_wicket_player_id\\n\", FILE_APPEND);\n\t\t\t\t\t// get last wicket's runs \u0026 balls\n\t\t\t\t\tforeach ($current_innings-\u003ebtTm-\u003eplyr as $player) {\n\t\t\t\t\t\tif ((string)$player-\u003eattributes()['Id'] == $last_wicket_player_id) // the ID here is formatted 9585\n\t\t\t\t\t\t\techo ' '.(int)$player-\u003eattributes()['r'].' ('.(int)$player-\u003eattributes()['b'].')';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ($partnership || $last_wicket)\n\t\t\t\t\techo \" | size=12 \\n\";\n\t\t\t}\n\t\t}\n\t}\n}\n//else no match selected\n\n//??? REFRESH AREA\n\nif ($selected_match_obj) {\n\techo \"---\\n\";\n\techo\n\t\t'Refresh now'\n\t\t.\" | terminal=false bash=\\\"\".$argv[0] . \"\\\" refresh=true\"\n\t\t.\"\\n\"\n\t;\n}\n\n//??? CURRENT MATCHES/MATCH SELECTION AREA\n\nif ($summary_feed) {\n\techo \"---\\n\";\n\techo \"Current matches\\n\";\n\tforeach ($matches as $index =\u003e $this_match_obj) {\n\t\t$description = '';\n\t\tif ($feed == 'espncricinfo')\n\t\t\t$description = $this_match_obj-\u003eteam1_name .' v ' .$this_match_obj-\u003eteam2_name;\n\t\telse if ($feed == 'cricbuzz') {\n\t\t\tif (isset($this_match_obj-\u003eTm)) { // these are generally abbreviated names anyway!\n\t\t\t\t$team1_name = $this_match_obj-\u003eTm[0]-\u003eattributes()['Name'];\n\t\t\t\t$team2_name = $this_match_obj-\u003eTm[1]-\u003eattributes()['Name'];\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$team_names = explode(' vs ', (string)$this_match_obj-\u003eattributes()['mchDesc']); // e.g. \"Ess vs WI\"\n\t\t\t\t$team1_name = $team_names[0];\n\t\t\t\t$team2_name = $team_names[1];\n\t\t\t}\n\t\t\t$description = translate_name($team1_name).' v '.translate_name($team2_name); // translate abbreviated team names \u0026 use \"v\" instead of \"vs\"\n\t\t}\n\t\t// sub-submenu item\n\t\techo\n\t\t\t'--'\n\t\t\t.$description\n\t\t\t.($index === (int)$selected_match_id ? ' ✓' : '')\n\t\t\t.\" | terminal=false bash=\\\"\".$argv[0] . \"\\\" param1=\\\"$index\\\" refresh=true\" // run this PHP script with one argument (match ID)\n\t\t\t.\"\\n\"\n\t\t;\n\t}\n\tif (!count($matches))\n\t\techo \"-- none\\n\";\n}\n\n// \"clear match selection\" menu option\nif ($selected_match_obj) {\n\techo\n\t\t'Clear match selection'\n\t\t.\" | terminal=false bash=\\\"\".$argv[0] . \"\\\" param1=unknown refresh=true\" // reset match ID\n\t\t.\"\\n\"\n\t;\n}\n\n//??? FEED AREA\n\necho \"---\\n\";\n// \"link to site\" menu item\necho $feed_info[$feed]['name'].\" website... | href=\".$feed_info[$feed]['site_url'].\"\\n\";\n\n// \"change feed\" submenu\necho \"Change feed\\n\";\nforeach (array('espncricinfo', 'cricbuzz') as $this_feed) {\n\techo\n\t\t'--' // sub-submenu item\n\t\t.$feed_info[$this_feed]['name']\n\t\t.($this_feed == $feed ? ' ✓' : '')\n\t\t.\" | terminal=false bash=\\\"\".$argv[0] . \"\\\" param1=filler param2=\\\"$this_feed\\\" refresh=true\" // run this PHP script with two arguments (second is feed name)\n\t\t.\"\\n\"\n\t;\n}\n\n//??? TIMEZONE AREA\n\necho \"---\\n\";\n\n// make up list of timezones of format \"blah/blahblah\"\n$timezones = array();\nforeach (timezone_abbreviations_list() as $abbr =\u003e $tz)\n\tforeach ($tz as $val)\n\t\tif (isset($val['timezone_id']))\n\t\t\tif (strpos($val['timezone_id'],'/') !== FALSE)\n\t\t\t\t$timezones[] = $val['timezone_id'];\n// sort and strip duplicates\nsort($timezones);\n$timezones = array_unique($timezones);\n\n// \"set timezone\" submenu\necho \"Your timezone (\".($timezone ? $timezone : date_default_timezone_get()).\")\\n\";\nforeach ($timezones as $this_timezone) {\n\techo\n\t\t'--' // sub-submenu item\n\t\t.$this_timezone\n\t\t.($this_timezone == $timezone ? ' ✓' : '')\n\t\t.\" | terminal=false bash=\\\"\".$argv[0] . \"\\\" param1=filler param2=filler param3=\\\"$this_timezone\\\" refresh=true\" // run this PHP script with three arguments (third is timezone name)\n\t\t.\"\\n\"\n\t;\n}\n\n?\u003e\n"
			}
		],
		"path": "Sports/cricket_bar.1m.php",
		"filename": "cricket_bar.1m.php",
		"dir": "Sports",
		"docsPlugin": "Sports/cricket_bar.1m.php.html",
		"docsCategory": "Sports.html",
		"pathSegments": [
			"Sports"
		],
		"categoryPathSegments": [
			{
				"path": "Sports",
				"text": "Sports",
				"isLast": true
			}
		],
		"title": "Cricket Bar",
		"version": "v1.1",
		"author": "Adi",
		"authors": [
			{
				"name": "gomedia-adi",
				"githubUsername": "gomedia-adi",
				"imageURL": "https://avatars.githubusercontent.com/u/13227940?v=4",
				"bio": "",
				"primary": true
			}
		],
		"desc": "Displays live cricket score of a selected match, using data from ESPNcricinfo or Cricbuzz.",
		"imageURL": "http://www.greatoceanmedia.com.au/images/62.png",
		"dependencies": [
			"php"
		],
		"aboutURL": "http://www.greatoceanmedia.com.au/bitbar",
		"lastUpdated": "2021-03-08T15:22:01.258819Z",
		"vars": null
	}
}