
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>Live Cricket Scores in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='Show live scores of cricket matches happening around the world using Cricinfo api.  - install xbar for free to get started.'>
	<meta name='author' content='Anup Sam Abraham'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='http://i.imgur.com/xiQTWZ4.png'>
	<meta itemprop='name' content='Live Cricket Scores in your macOS menu bar'>
	<meta itemprop='description' content='Show live scores of cricket matches happening around the world using Cricinfo api.  - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='Live Cricket Scores in your macOS menu bar'>
	<meta name='twitter:description' content='Show live scores of cricket matches happening around the world using Cricinfo api.  - install xbar for free to get started.'>
	<meta name='twitter:image' content='http://i.imgur.com/xiQTWZ4.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='Live Cricket Scores in your macOS menu bar'>
	<meta property='og:description' content='Show live scores of cricket matches happening around the world using Cricinfo api.  - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Sports/live_cricket.2m.py.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='http://i.imgur.com/xiQTWZ4.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='http://i.imgur.com/xiQTWZ4.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='http://i.imgur.com/xiQTWZ4.png'>
	<link rel='shortcut icon' href='http://i.imgur.com/xiQTWZ4.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>💜</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>Live Cricket Scores</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/anupsabraham.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/2144142?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/anupsabraham.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Anup Sam Abraham (<code style='color:white;'>@anupsabraham</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						Show live scores of cricket matches happening around the world using Cricinfo api. 
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Sports%2flive_cricket.2m.py'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>🖥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='http://i.imgur.com/xiQTWZ4.png' 
				alt='Image preview of Live Cricket Scores plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>live_cricket.2m.py</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Sports/live_cricket.2m.py'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Sports/live_cricket.2m.py'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env python
# -*- coding: utf-8 -*-

# &lt;bitbar.title&gt;Live Cricket Scores&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.3&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Anup Sam Abraham&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;anupsabraham&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;Show live scores of cricket matches happening around the world using Cricinfo api. &lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;http://i.imgur.com/xiQTWZ4.png&lt;/bitbar.image&gt;
# &lt;bitbar.dependencies&gt;python&lt;/bitbar.dependencies&gt;
# &lt;bitbar.abouturl&gt;&lt;/bitbar.abouturl&gt;

import os
import sys
import getopt
import re
import urllib2
import json
from datetime import datetime
from time import tzname


FAVORITE_TEAMS_FILE = &#34;/var/tmp/bitbar_cricket.data&#34;

if len(sys.argv) &gt; 1:
    opts, args = getopt.getopt(sys.argv[1:], &#34;i:d:&#34;, [])
    for opt, arg in opts:
        if opt == &#34;-i&#34;:
            # this is for inserting the team name into our file
            with open(FAVORITE_TEAMS_FILE, &#34;a&#34;) as f:
                f.write(arg&#43;&#34;\n&#34;)

        elif opt == &#34;-d&#34;:
            # this option is for deleting a team name from the file
            if os.path.exists(FAVORITE_TEAMS_FILE):
                with open(FAVORITE_TEAMS_FILE, &#34;r&#34;) as f:
                    current_teamnames = [x.strip() for x in f.readlines()]
                    if arg in current_teamnames:
                        current_teamnames.remove(arg)
                with open(FAVORITE_TEAMS_FILE, &#34;w&#34;) as f:
                    f.writelines([x&#43;&#34;\n&#34; for x in current_teamnames])
    exit()

if os.path.exists(FAVORITE_TEAMS_FILE):
    with open(FAVORITE_TEAMS_FILE, &#34;r&#34;) as f:
        favorite_teams = [x.strip() for x in f.readlines()]
else:
    # create an empty file if it doesn&#39;t exist
    open(FAVORITE_TEAMS_FILE, &#34;a&#34;).close()
    favorite_teams = []

untracked_teams = []
if &#34;*&#34; in favorite_teams:
    track_all_teams = True
else:
    track_all_teams = False

TIME_DELTA = datetime.utcnow() - datetime.now()  # for converting gmt to local time

# fetch the json feed listing all the matches
cricinfo_base_url = &#34;http://api.espncricinfo.com&#34;
summary_url = cricinfo_base_url &#43; &#39;/netstorage/summary.json&#39;
summary_response = urllib2.urlopen(summary_url)
summary_data = json.load(summary_response)

# fetch the url for matches that needs to be shown in the plugin
matches = 0
live_matches = 0
list_links = []
for match_number, match in summary_data[&#39;matches&#39;].iteritems():
    if match[&#39;team1_name&#39;] not in favorite_teams:
        untracked_teams.append(match[&#39;team1_name&#39;])
    if match[&#39;team2_name&#39;] not in favorite_teams:
        untracked_teams.append(match[&#39;team2_name&#39;])
    team_names = [match[&#39;team1_name&#39;], match[&#39;team2_name&#39;]]
    if track_all_teams or (set(favorite_teams) &amp; set(team_names)):
        # At least one team in the favorite team list is playing
        matches &#43;= 1
        if match[&#39;live_match&#39;] == &#34;Y&#34;:
            live_matches &#43;= 1
        list_links.append(cricinfo_base_url &#43; match[&#39;url&#39;])

if matches:
    print &#39;🏏&#39; &#43; str(matches) &#43; &#39; | dropdown=false&#39;
    print &#39;---&#39;
    print &#34;%s/%s matches live&#34; % (live_matches, matches)
    print &#34;---&#34;
    for match_html_url in list_links:
        match_url = match_html_url.split(&#39;.html&#39;)[0] &#43; &#39;.json&#39;
        match_data_response = urllib2.urlopen(match_url)
        match_data = json.load(match_data_response)

        # get team_data
        teams = {}
        for loop_counter, team_info in enumerate(match_data[&#39;team&#39;]):
            if &#39;team_id&#39; in team_info:
                team_id = team_info[&#39;team_id&#39;]
            else:
                team_id = &#34;TBA&#34; &#43; str(loop_counter)

            if &#39;team_short_name&#39; in team_info:
                team_short_name = team_info[&#39;team_short_name&#39;]
            else:
                team_short_name = &#34;TBA&#34;
            teams[team_id] = {
                &#39;name&#39;: team_short_name,
                &#39;score&#39;: &#39;&#39;
            }

        if match_data[&#39;match&#39;][&#39;international_class_card&#39;] == &#34;Test&#34;:
            test_match = True
        elif match_data[&#39;match&#39;][&#39;general_class_card&#39;] == &#34;First-class&#34;:
            test_match = True
        else:
            test_match = False

        # get innings data
        remaining_balls = None
        required_runrate = None
        if match_data[&#39;innings&#39;]:
            match_started = True
            for innings in match_data[&#39;innings&#39;]:
                if teams[innings[&#39;batting_team_id&#39;]][&#39;score&#39;]:
                    # if its a test match and this is the second innings
                    # of the team add &#39;&amp;&#39;&#39; before adding the score
                    teams[innings[&#39;batting_team_id&#39;]][&#39;score&#39;] &#43;= &#39; &amp; &#39;
                innings_score = innings[&#39;runs&#39;] &#43; &#39;/&#39; &#43; innings[&#39;wickets&#39;] &#43; &#39; (&#39; &#43; \
                                    innings[&#39;overs&#39;] &#43; &#39; ov)&#39;
                if innings[&#39;live_current&#39;] == &#39;1&#39;:
                    innings_score &#43;= &#39;*&#39;
                teams[innings[&#39;batting_team_id&#39;]][&#39;score&#39;] &#43;= innings_score
                if innings[&#39;live_current&#39;] == &#39;1&#39;:
                    batting_team = teams[innings[&#39;batting_team_id&#39;]][&#39;name&#39;]
                    lead = innings[&#39;lead&#39;]
                    # my guess is that the below two lines should throw error
                    # for test matches. Lets see
                    if not test_match:
                        remaining_balls = match_data[&#39;live&#39;][&#39;innings&#39;][&#39;remaining_balls&#39;]
                        required_runrate = match_data[&#39;live&#39;][&#39;innings&#39;][&#39;required_run_rate&#39;]
                    break
        else:
            match_started = False

        # get the scores of batsmen at crease
        batsmen = []
        for batsman in match_data[&#39;live&#39;][&#39;batting&#39;]:
            # get batsman name from team info
            # That&#39;s right. The live batsman name is not in this
            # dictionary. Have to go through each players of each team
            # in the match_data to fetch the batsman&#39;s name
            batsman_name = &#39;&#39;
            for team in match_data[&#39;team&#39;]:
                if team[&#39;team_id&#39;] == batsman[&#39;team_id&#39;]:
                    if &#39;player&#39; in team:
                        for player in team[&#39;player&#39;]:
                            if player[&#39;player_id&#39;] == batsman[&#39;player_id&#39;]:
                                batsman_name = player[&#39;card_long&#39;]
                                break
                    elif &#39;squad&#39; in team:
                        for player in team[&#39;squad&#39;]:
                            if player[&#39;player_id&#39;] == batsman[&#39;player_id&#39;]:
                                batsman_name = player[&#39;card_long&#39;]
                                break
                    break
            batsman_score = batsman[&#39;runs&#39;] &#43; &#39;(&#39; &#43; batsman[&#39;balls_faced&#39;] &#43; &#39;)&#39;
            if batsman[&#39;live_current_name&#39;] == &#39;striker&#39;:
                batsman_score &#43;= &#39;*&#39;
            batsmen.append(batsman_name &#43; &#39;: &#39; &#43; batsman_score)

        # get the match status.
        match_status = match_data[&#39;live&#39;][&#39;status&#39;]
        if test_match:
            if &#39;actual_days&#39; in match_data[&#39;match&#39;]:
                status_text = &#39;Day &#39; &#43; match_data[&#39;match&#39;][&#39;actual_days&#39;] &#43; &#39;: &#39;
            else:
                status_text = &#39;Day 0: &#39;
        else:
            status_text = &#39;&#39;
        if &#39;scheduled&#39; in match_status.lower():
            # match hasn&#39;t started yet. Show the start time of the match in local time
            gmt = match_data[&#39;match&#39;][&#39;start_datetime_gmt&#39;]
            local_datetime = datetime.strptime(gmt, &#39;%Y-%m-%d %H:%M:%S&#39;) - TIME_DELTA
            local_time_string = local_datetime.strftime(&#39;%I:%M %p&#39;)
            status_text &#43;=  &#39;Starting at: &#39; &#43; local_time_string &#43; &#34; (&#34; &#43; tzname[0] &#43; &#34;)&#34;
        elif &#39;elected to&#39; in match_status.lower():
            # first innings started. show who won the toss
            if match_data[&#39;match&#39;][&#39;toss_choice_team_id&#39;] != &#34;0&#34;:
                toss_winner = match_data[&#39;match&#39;][&#39;toss_choice_team_id&#39;]
            else:
                toss_winner = match_data[&#39;match&#39;][&#39;toss_winner_team_id&#39;]
            status_text &#43;= teams[toss_winner][&#39;name&#39;] &#43; &#39; elected to &#39; &#43; match_data[&#39;match&#39;][&#39;toss_decision_name&#39;] &#43; &#39; first&#39;
        elif &#39;trail by&#39; in match_status.lower() or &#39;lead by&#39; in match_status.lower():
            # batting team is either trailing or leading which means it is
            # either 2nd or 3rd innings of a test match
            if int(lead) &gt;= 0:
                status_text &#43;= batting_team &#43; &#34; lead by &#34; &#43; lead &#43; &#34; runs&#34;
            else:
                status_text &#43;= batting_team &#43; &#34; trail by &#34; &#43; str(abs(int(lead))) &#43; &#34; runs&#34;
        elif &#39;require another&#39; in match_status.lower():
            # last innings of the match
            status_text &#43;= batting_team &#43; &#34; need &#34; &#43; str(abs(int(lead)) &#43; 1) &#43; &#34; runs to win&#34;
            if remaining_balls and required_runrate:
                status_text &#43;= &#34; from &#34; &#43; remaining_balls &#43; &#34; balls(RRR: &#34; &#43; required_runrate &#43; &#34;)&#34;
        elif &#39;won by&#39; in match_status.lower():
            # match is over. show who won the match
            winner = teams[match_data[&#39;match&#39;][&#39;winner_team_id&#39;]][&#39;name&#39;]
            win_status = re.match(&#34;^.*(won by (an innings and )?\d* (runs?|wickets?))( \(.*\))?&#34;, match_status)
            status_text &#43;= winner &#43; &#34; &#34; &#43; win_status.group(1)
            if match_data[&#39;match&#39;][&#39;rain_rule&#39;] == &#39;1&#39;:
                # It can be confusing if the score doesn&#39;t look complete
                # and the match result is decided using something like D/L method
                status_text &#43;= &#39; (D/L)&#39;
            # I also wanted to show the Man of the Match info. But can&#39;t find it anywhere in the json
        else:
            status_text &#43;= match_status

        # print teams and score
        print_params = {
            &#39;team_name&#39;: &#34; size=14 &#34;,
            &#39;status_text&#39;: &#34; color=blue &#34;,
            &#39;batsman_score&#39;: &#34; size=12 &#34;
        }
        if match_started:
            for team_id, each_team in teams.iteritems():
                if each_team[&#39;score&#39;]:
                    print each_team[&#39;name&#39;] &#43; &#39;: &#39; &#43; each_team[&#39;score&#39;] &#43; &#39; |&#39; &#43; print_params[&#39;team_name&#39;]
                else:
                    print each_team[&#39;name&#39;] &#43; &#39;: Yet to bat |&#39; &#43; print_params[&#39;team_name&#39;]
        else:
            match_desc = &#34;&#34;
            for team_data in match_data[&#39;team&#39;]:
                if match_desc:
                    match_desc &#43;= &#34; vs &#34;
                if &#39;team_name&#39; in team_data:
                    match_desc &#43;= team_data[&#39;team_name&#39;]
                else:
                    match_desc &#43;= &#34;TBA&#34;
            print match_desc &#43; &#39; | &#39; &#43;print_params[&#39;team_name&#39;]

        print status_text &#43; &#39; | href=&#39; &#43; match_html_url &#43; print_params[&#39;status_text&#39;]
        for batsman in batsmen:
            print batsman &#43; &#39; |&#39; &#43; print_params[&#39;batsman_score&#39;]
        print &#39;---&#39;
else:
    # no matches are live
    print &#39;🏏&#39;
    print &#39;---&#39;
    print &#39;No matches live&#39;
    print &#34;---&#34;

print &#34;Favorite Teams | color=green&#34;
print &#34;--Click on any to remove from favorites&#34;
print &#34;-----&#34;
if favorite_teams:
    for each_team in favorite_teams:
        print &#34;--%s | terminal=false bash=\&#34;%s\&#34; param1=\&#34;-d\&#34; param2=\&#34;%s\&#34; refresh=true&#34; % (
            each_team if each_team != &#34;*&#34; else &#34;TRACK ALL TEAMS&#34;,
            sys.argv[0],
            each_team
        )
else:
    print &#34;--You don&#39;t have any favorite teams set&#34;

print &#34;Other Teams | color=red&#34;
print &#34;--Click on any to add to favorites&#34;
print &#34;-----&#34;
for each_team in untracked_teams:
    print &#34;--%s | terminal=false bash=\&#34;%s\&#34; param1=\&#34;-i\&#34; param2=\&#34;%s\&#34; refresh=true&#34; % (each_team, sys.argv[0], each_team)
if not track_all_teams:
    print &#34;--TRACK ALL TEAMS | terminal=false bash=\&#34;%s\&#34; param1=\&#34;-i\&#34; param2=\&#34;*\&#34; refresh=true&#34; % sys.argv[0]
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						•
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors • <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
