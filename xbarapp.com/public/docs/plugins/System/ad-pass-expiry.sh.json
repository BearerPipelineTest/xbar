{
	"plugin": {
		"files": [
			{
				"path": "System/ad-pass-expiry.sh",
				"filename": "ad-pass-expiry.sh",
				"content": "#!/bin/bash\n# \u003cbitbar.title\u003eActive Directory Password Expiration Check\u003c/bitbar.title\u003e\n# \u003cbitbar.version\u003ev1.0\u003c/bitbar.version\u003e\n# \u003cbitbar.author\u003eGalen Sprague\u003c/bitbar.author\u003e\n# \u003cbitbar.author.github\u003egsprague\u003c/bitbar.author.github\u003e\n# \u003cbitbar.desc\u003eShows Active Directory Password Expiration in days\u003c/bitbar.desc\u003e\n# \u003cbitbar.image\u003e\u003c/bitbar.image\u003e\n# \u003cbitbar.dependencies\u003ebash\u003c/bitbar.dependencies\u003e\n# \u003cbitbar.abouturl\u003e\u003c/bitbar.abouturl\u003e\n\n# Set environment vars\nDOMAIN=\"yourDomain\"\n# Set password policy in days\nPWPOLICY=\"90\"\n\n# Get logged in user\n#CURRENTUSER=$(ls -l /dev/console | cut -d \" \" -f4)\nCURRENTUSER=$(id -un)\n\n# Get data from AD\nLASTPWDMS=$(dscl /Active\\ Directory/\"$DOMAIN\"/All\\ Domains -read /Users/\"$CURRENTUSER\" | grep -i \"SMBPasswordLastSet\" | cut -d ' ' -f 2 | tail -1)\nif [[ $LASTPWDMS == \"\" ]]\nthen\n\t# No access to AD\n\techo \"AD NA\"\nelse\n\t# Get the current UNIX date\n\tTODAYUNIX=$(date +%s)\n\n\t# Convert last set value\n\tLASTPWDUNIX=$((LASTPWDMS/10000000-11644473600))\n\n\t# Subtract last set value from current UNIX date\n\tDIFFUNIX=$((TODAYUNIX-LASTPWDUNIX))\n\n\t# Calculate in days\n\tDIFFDAYS=$((DIFFUNIX/86400))\n\n\t# Subtract password policy from days\n\tPASSWORDEXPIRATION=$((PWPOLICY-DIFFDAYS))\n\n\techo \"Password expires in $PASSWORDEXPIRATION days\"\nfi\n\nexit 0\n"
			}
		],
		"path": "System/ad-pass-expiry.sh",
		"filename": "ad-pass-expiry.sh",
		"dir": "System",
		"docsPlugin": "System/ad-pass-expiry.sh.html",
		"docsCategory": "System.html",
		"pathSegments": [
			"System"
		],
		"categoryPathSegments": [
			{
				"path": "System",
				"text": "System",
				"isLast": true
			}
		],
		"title": "Active Directory Password Expiration Check",
		"version": "v1.0",
		"author": "Galen Sprague",
		"authors": [
			{
				"name": "Galen Sprague",
				"githubUsername": "gsprague",
				"imageURL": "https://avatars.githubusercontent.com/u/810706?v=4",
				"bio": "",
				"primary": true
			}
		],
		"desc": "Shows Active Directory Password Expiration in days",
		"imageURL": "https://xbarapp.com/public/img/xbar-2048.png",
		"dependencies": [
			"bash"
		],
		"aboutURL": "",
		"lastUpdated": "2021-03-08T15:22:02.451134Z",
		"vars": null
	}
}