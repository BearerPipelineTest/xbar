
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>Disk Usage in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='Disk usage statistics - install xbar for free to get started.'>
	<meta name='author' content='Ganesh V'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='https://raw.github.com/ganeshv/mtop/master/screenshots/mdf2.jpg'>
	<meta itemprop='name' content='Disk Usage in your macOS menu bar'>
	<meta itemprop='description' content='Disk usage statistics - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='Disk Usage in your macOS menu bar'>
	<meta name='twitter:description' content='Disk usage statistics - install xbar for free to get started.'>
	<meta name='twitter:image' content='https://raw.github.com/ganeshv/mtop/master/screenshots/mdf2.jpg'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='Disk Usage in your macOS menu bar'>
	<meta property='og:description' content='Disk usage statistics - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/System/mdf.1m.sh.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='https://raw.github.com/ganeshv/mtop/master/screenshots/mdf2.jpg'>
	<link rel='apple-touch-icon' sizes='180x180' href='https://raw.github.com/ganeshv/mtop/master/screenshots/mdf2.jpg'>
	<link rel='icon' type='image/png' sizes='32x32' href='https://raw.github.com/ganeshv/mtop/master/screenshots/mdf2.jpg'>
	<link rel='shortcut icon' href='https://raw.github.com/ganeshv/mtop/master/screenshots/mdf2.jpg'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>ðŸ’œ</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>Disk Usage</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/ganeshv.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/827790?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/ganeshv.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Ganesh V (<code style='color:white;'>@ganeshv</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						Disk usage statistics
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=System%2fmdf.1m.sh'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>ðŸ–¥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='https://raw.github.com/ganeshv/mtop/master/screenshots/mdf2.jpg' 
				alt='Image preview of Disk Usage plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>mdf.1m.sh</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/System/mdf.1m.sh'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/System/mdf.1m.sh'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env bash

# &lt;bitbar.title&gt;Disk Usage&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.0&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Ganesh V&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;ganeshv&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;Disk usage statistics&lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;https://raw.github.com/ganeshv/mtop/master/screenshots/mdf2.jpg&lt;/bitbar.image&gt;
# &lt;bitbar.about&gt;https://github.com/ganeshv/mtop&lt;/bitbar.about&gt;

# Bash builtins are used as much as possible to reduce performance impact.

#!/usr/bin/env bash

## bmplib.sh v1.0
#
# Make your own BMP from scratch, no external dependencies.
# Useful in BitBar plugins.
#
# pixels=()             # set pixels to empty or with background of same size
#                       # as will be declared in init_bmp
# curcol=(bb 66 44 aa)  # set current color, BGRA, hex (%02x)
# init_bmp 1 25 16      # initialize BMP, version 1 width 25 height 16
#                       # if pixels not valid, initialize to $curcol
# curcol=(00 00 00 ff)  # set current color to fully opaque black
# point $x $y           # set ($x, $y) to $curcol. (0, 0) is bottom left
# line $x1 $y1 $x2 $y2  # draw horizontal or vertical line
# rect $x $y $w $h      # draw rectangle. ($x, $y) is bottom left
# fill $x $y $w $h      # draw filled rectangle. ($x, $y) is bottom left
# output_bmp            # output BMP to stdout

bmp_ver=5               # set to 1 if you want most compatible BMP. no alpha.
width=25                # width of image
height=16               # height of image
curcol=(00 00 00 00)    # current color

# No user-servicable parts below
# We avoid subshells for performance reasons

bpp=4
rowbytes=$((width * bpp))
pixbytes=$((width * height * bpp))

OLDIFS=$IFS
bmp_header=()
pixels=()

# Takes number, prints hex bytes in little endian
# e.g. hexle32 3142 will output 46 0c 00 00
hexle32() {
    local num
    printf -v num &#34;%08x&#34; &#34;$1&#34;
    retval=&#34;${num:6:2} ${num:4:2} ${num:2:2} ${num:0:2}&#34;
}

errmsg() {
    &gt;&amp;2 echo &#34;$@&#34;
}

# make_bmp_header
# version can be 1 or 5
# v1 is the most compatible, but the graph will be opaque - no alpha support.
# v5 supports alpha channel.
make_bmp_header() {
    local headerbytes comp pixoffset filebytes _filebytes _pixoffset
    local _headerbytes _width _height _pixbytes
    bmp_header=()
    headerbytes=40
    comp=&#34;00&#34;
    if [ &#34;$bmp_ver&#34; -eq 5 ]; then
        headerbytes=124
        comp=&#34;03&#34;
    fi
    pixoffset=$((headerbytes &#43; 14))
    filebytes=$((pixbytes &#43; pixoffset))

    hexle32 $filebytes
    _filebytes=$retval
    hexle32 $pixoffset
    _pixoffset=$retval
    hexle32 $headerbytes
    _headerbytes=$retval
    hexle32 $width
    _width=$retval
    hexle32 $height
    _height=$retval
    hexle32 $pixbytes
    _pixbytes=$retval

    # Common bits for version 1 and 5
    bmp_header&#43;=(
        42 4d                   # &#34;BM&#34; magic
        &#34;$_filebytes&#34;             # size of file
        00 00                   # reserved
        00 00                   # reserved
        &#34;$_pixoffset&#34;             # offset of pixel data
        &#34;$_headerbytes&#34;           # remaining bytes in header
        &#34;$_width&#34;                 # width
        &#34;$_height&#34;                # height
        01 00                   # 1 color plane
        20 00                   # 32 bits per pixel
        &#34;$comp&#34; 00 00 00          # compression
        &#34;$_pixbytes&#34;              # size of pixel data
        13 0b 00 00             # ~72 dpi horizontal
        13 0b 00 00             # ~72 dpi vertical
        00 00 00 00             # colors in palette
        00 00 00 00             # all colors are important
    )
    if [ &#34;$bmp_ver&#34; -eq 5 ]; then
        bmp_header&#43;=(
            00 00 ff 00             # red channel mask (BGRA)
            00 ff 00 00             # green channel mask
            ff 00 00 00             # blue channel mask
            00 00 00 ff             # alpha channel mask
            42 47 52 73             # sRGB
            00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
            00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
            00 00 00 00             # red gamma
            00 00 00 00             # green gamma
            00 00 00 00             # blue gamma
            00 00 00 00             # intent
            00 00 00 00             # profile data
            00 00 00 00             # profile size
            00 00 00 00             # reserved
        )
    fi
}

# point x y
point() {
    local off
    off=$(($2 * rowbytes &#43; $1 * bpp))
    pixels[$off]=${curcol[0]}
    pixels[$((off &#43; 1))]=${curcol[1]}
    pixels[$((off &#43; 2))]=${curcol[2]}
    pixels[$((off &#43; 3))]=${curcol[3]}
}

# line x1 y1 x2 y2
line() {
    local x1 y1 x2 y2 x y
    if [ &#34;$1&#34; -eq &#34;$3&#34; ]; then
        if [ &#34;$2&#34; -gt &#34;$4&#34; ]; then y1=$4; y2=$2; else y1=$2; y2=$4; fi
        for ((y = y1; y &lt;= y2; y&#43;&#43;)); do
            point &#34;$1&#34; $y
        done
    elif [ &#34;$2&#34; -eq &#34;$4&#34; ]; then
        if [ &#34;$1&#34; -gt &#34;$3&#34; ]; then x1=$3; x2=$1; else x1=$1; x2=$3; fi
        for ((x = x1; x &lt;= x2; x&#43;&#43;)); do
            point $x &#34;$2&#34;
        done
    else
        errmsg &#34;Only vertical and horizontal lines supported&#34; &#34;$@&#34;
    fi
}

# fill x y w h
function fill() {
    local x2 y2 y
    x2=$(($1 &#43; $3 - 1))
    y2=$(($2 &#43; $4 - 1))
    for ((y = $2; y &lt;= y2; y&#43;&#43;)); do
        line &#34;$1&#34; $y $x2 $y
    done
}

# rect x y w h
function rect() {
    local x2 y2
    x2=$(($1 &#43; $3 - 1))
    y2=$(($2 &#43; $4 - 1))
    line &#34;$1&#34; &#34;$2&#34; $x2 &#34;$2&#34;
    line &#34;$1&#34; $y2 $x2 $y2
    line &#34;$1&#34; &#34;$2&#34; &#34;$1&#34; $y2
    line $x2 &#34;$2&#34; $x2 $y2
}

output_bmp() {
    local _bmp=(&#34;${bmp_header[@]/#/&#39;\x&#39;}&#34;)
    _bmp&#43;=(&#34;${pixels[@]/#/&#39;\x&#39;}&#34;)

    local IFS=&#39;&#39;
    #echo -ne &#34;${_bmp[*]}&#34; &gt;/tmp/mtop.bmp
    echo -ne &#34;${_bmp[*]}&#34;
    IFS=$OLDIFS
}

# init_bmp bmp_ver width height
init_bmp() {
    local i
    bmp_ver=${1:-$bmp_ver}
    width=${2:-$width}
    height=${3:-$height}

    rowbytes=$((width * bpp))
    pixbytes=$((width * height * bpp))

    make_bmp_header
    if [ ${#pixels[@]} -ne $pixbytes ]; then
        pixels=()
        for ((i = 0; i &lt; width * height; i&#43;&#43;)); do
            pixels&#43;=(&#34;${curcol[@]}&#34;);
        done
    fi
}

## End of bmplib.sh
# Common functions and globals for m* plugins
# Assumes bmplib.sh already loaded

osver=$(sw_vers -productVersion)

# Colors in BGRA format
fgcol=(00 00 00 ff)
fgcol_alert=(00 00 00 88)  # semi-transparent.
bgcol=(00 00 00 00)
bmp_ver=5
icontype=templateImage

if [[ $osver == 10.8.* ]]; then
    bmp_ver=1
    bgcol=(d0 d0 d0 7f)
    icontype=image
fi

# return the alert colour if alert condition is met.
# else return foreground colour.
# alert condition: free capacity &lt; 2%. 
determine_col() {
  if (( $1 &lt; 98 )); then
  	retval=(&#34;${fgcol[@]}&#34;)
  else
  	retval=(&#34;${fgcol_alert[@]}&#34;)
  fi
}

# Routines to draw simple progress-bar-like buckets for showing
# capacity of disks, batteries etc.

init_bar() {
    pixels=()
    curcol=(&#34;${bgcol[@]}&#34;)
    init_bmp $bmp_ver &#34;$1&#34; &#34;$2&#34;
    determine_col &#34;$root_capacity&#34;; col=(&#34;${retval[@]}&#34;)
    curcol=(&#34;${col[@]}&#34;)
    rect 0 0 &#34;$1&#34; &#34;$2&#34;
}

# Horizontal bar
# hbar width height capacity
hbar() {
    local w=$((($1 - 4) * $3 / 100))
    init_bar &#34;$1&#34; &#34;$2&#34;
    fill 2 2 $w $(($2 - 4))
}


# Vertical bar
# vbar width height capacity
vbar() {
    local h=$((($2 - 4) * $3 / 100))
    init_bar &#34;$1&#34; &#34;$2&#34;
    fill 2 2 $(($1 - 4)) $h
}

OLDIFS=$IFS

disk=()
used=()
free=()
capacity=()
root_capacity=0

get_disk_stats() {
    local IFS=$&#39;\n&#39;
    local i dfdata dudata diskname

    dfdata=(&#34;$(df -H)&#34;)

    IFS=$OLDIFS
    for ((i = 0; i &lt; &#34;${#dfdata[@]}&#34;; i&#43;&#43;)); do
        line=(&#34;${dfdata[$i]}&#34;)
        if [ &#34;${line[8]}&#34; = &#34;/&#34; ]; then
            root_capacity=&#34;${line[4]/\%}&#34;            
        fi
        if [[ &#34;${line[0]}&#34; == /dev/* ]]; then
            dudata=(&#34;$(diskutil info &#34;${line[0]}&#34; | grep &#34;Volume Name&#34;)&#34;)
            diskname=&#34;${dudata[*]:2}&#34;
            disk&#43;=(&#34;${diskname:-Untitled}&#34;)
            used&#43;=(&#34;${line[2]}&#34;)
            free&#43;=(&#34;${line[3]}&#34;)
            capacity&#43;=(&#34;${line[4]/\%}&#34;)
        fi
    done
}

if [ &#34;$1&#34; = &#39;disk_utility&#39; ]; then
    osascript &lt;&lt; END
    tell application &#34;Disk Utility&#34;
        reopen
        activate
    end tell
END
    exit 0
elif [ &#34;$1&#34; = &#39;perf&#39; ]; then
    PERF=1
fi

[ -z &#34;$PERF&#34; ] &amp;&amp; get_disk_stats

vbar 10 16 &#34;$root_capacity&#34;

echo -n &#34;| $icontype=&#34;
output_bmp | base64
echo &#34;---&#34;
for ((i = 0; i &lt; ${#capacity[@]}; i&#43;&#43;)); do
    echo &#34;Disk   ${disk[$i]} | size=12 refresh=true font=Menlo&#34;
    echo &#34;Used   ${used[$i]}| size=12 refresh=true font=Menlo&#34;
    echo &#34;Free   ${free[$i]}| size=12 refresh=true font=Menlo&#34;
    hbar 128 10 &#34;${capacity[$i]}&#34;
    echo -n &#34;| refresh=true $icontype=&#34;
    output_bmp | base64
    echo &#34;---&#34;
done
echo &#34;Open Disk Utility | bash=&#39;$0&#39; param1=disk_utility terminal=false&#34;
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						â€¢
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors â€¢ <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
