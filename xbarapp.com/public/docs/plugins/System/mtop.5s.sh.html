
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>CPU Usage Graph in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='CPU usage bar graph - install xbar for free to get started.'>
	<meta name='author' content='Ganesh V'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='https://raw.github.com/ganeshv/mtop/master/screenshots/mtop2.png'>
	<meta itemprop='name' content='CPU Usage Graph in your macOS menu bar'>
	<meta itemprop='description' content='CPU usage bar graph - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='CPU Usage Graph in your macOS menu bar'>
	<meta name='twitter:description' content='CPU usage bar graph - install xbar for free to get started.'>
	<meta name='twitter:image' content='https://raw.github.com/ganeshv/mtop/master/screenshots/mtop2.png'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='CPU Usage Graph in your macOS menu bar'>
	<meta property='og:description' content='CPU usage bar graph - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/System/mtop.5s.sh.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='https://raw.github.com/ganeshv/mtop/master/screenshots/mtop2.png'>
	<link rel='apple-touch-icon' sizes='180x180' href='https://raw.github.com/ganeshv/mtop/master/screenshots/mtop2.png'>
	<link rel='icon' type='image/png' sizes='32x32' href='https://raw.github.com/ganeshv/mtop/master/screenshots/mtop2.png'>
	<link rel='shortcut icon' href='https://raw.github.com/ganeshv/mtop/master/screenshots/mtop2.png'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>ðŸ’œ</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>CPU Usage Graph</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/ganeshv.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/827790?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/ganeshv.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Ganesh V (<code style='color:white;'>@ganeshv</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						CPU usage bar graph
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=System%2fmtop.5s.sh'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>ðŸ–¥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='https://raw.github.com/ganeshv/mtop/master/screenshots/mtop2.png' 
				alt='Image preview of CPU Usage Graph plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>mtop.5s.sh</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/System/mtop.5s.sh'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/System/mtop.5s.sh'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env bash

# &lt;bitbar.title&gt;CPU Usage Graph&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.0&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Ganesh V&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;ganeshv&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;CPU usage bar graph&lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;https://raw.github.com/ganeshv/mtop/master/screenshots/mtop2.png&lt;/bitbar.image&gt;
# &lt;bitbar.about&gt;https://github.com/ganeshv/mtop&lt;/bitbar.about&gt;

# CPU utilization bar graph is rendered onto a 25x16 BMP file created from
# scratch with no external dependencies. The dropdown contains current usage,
# load average and the top 5 CPU-hogs as reported by `top`.
#
# Tested on Mountain Lion through El Capitan. Works with Dark Mode (though
# you have to restart Bitbar if you change mode).
#
# Mountain Lion does not interpret the BITMAPV5HEADER variant of the BMP
# format, which has alpha channel support. We fall back to a basic version
# (BITMAPINFOHEADER).
#
# Bash builtins are used as much as possible to reduce performance impact.

if [ &#34;$1&#34; = &#39;activity_monitor&#39; ]; then
    osascript &lt;&lt; END
    tell application &#34;Activity Monitor&#34;
        reopen
        activate
    end tell
END
    exit 0
fi

HISTORY_FILE=$HOME/.bitbar.mtop
[ ! -r &#34;$HISTORY_FILE&#34; ] &amp;&amp; touch &#34;$HISTORY_FILE&#34;
[ X&#34;$(find &#34;$HISTORY_FILE&#34; -mtime -2m)&#34; != X&#34;$HISTORY_FILE&#34; ] &amp;&amp; echo -n &gt;&#34;$HISTORY_FILE&#34; # Discard history if older than 2 minutes

OLDIFS=$IFS
bmp=()
width=25
height=16

osver=$(sw_vers -productVersion)

# Colors in BGRA format
fgcol=&#34;00 00 00 ff&#34;
bgcol=&#34;00 00 00 00&#34;
bmp_ver=5
icontype=templateImage

if [[ $osver == 10.8.* ]]; then
    bmp_ver=1
    bgcol=&#34;d0 d0 d0 7f&#34;
    icontype=image
fi

border=$fgcol
foreground=$fgcol
background=$bgcol
border_height=3

# Takes number, prints hex bytes in little endian
# e.g. hexle32 3142 will output 46 0c 00 00
hexle32() {
    printf -v _num &#34;%08x&#34; &#34;$1&#34;
    echo &#34;${_num:6:2}&#34; &#34;${_num:4:2}&#34; &#34;${_num:2:2}&#34; &#34;${_num:0:2}&#34;
}

# make_bmp_header version
# version can be 1 or 5
# v1 is the most compatible, but the graph will be opaque - no alpha support.
# v5 supports alpha channel.
make_bmp_header() {
    headertype=$1
    headerbytes=40
    comp=&#34;00&#34;
    if [ &#34;$headertype&#34; -eq 5 ]; then
        headerbytes=124
        comp=&#34;03&#34;
    fi
    pixoffset=$((headerbytes &#43; 14))
    pixbytes=$((width * height * 4))
    filebytes=$((pixbytes &#43; pixoffset))
        
    # Common bits for version 1 and 5
    bmp&#43;=(
        42 4d                   # &#34;BM&#34; magic
        $(hexle32 $filebytes)   # size of file
        00 00                   # reserved
        00 00                   # reserved
        $(hexle32 $pixoffset)   # offset of pixel data
        $(hexle32 $headerbytes) # remaining bytes in header
        $(hexle32 $width)       # width
        $(hexle32 $height)      # height
        01 00                   # 1 color plane
        20 00                   # 32 bits per pixel
        $comp 00 00 00          # Compression
        $(hexle32 $pixbytes)    # size of pixel data
        13 0b 00 00             # ~72 dpi horizontal
        13 0b 00 00             # ~72 dpi vertical
        00 00 00 00             # colors in palette
        00 00 00 00             # all colors are important
    )
    if [ &#34;$headertype&#34; -eq 5 ]; then
        bmp&#43;=(
            00 00 ff 00             # red channel mask (BGRA)
            00 ff 00 00             # green channel mask
            ff 00 00 00             # blue channel mask
            00 00 00 ff             # alpha channel mask
            42 47 52 73             # sRGB
            00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
            00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
            00 00 00 00             # red gamma
            00 00 00 00             # green gamma
            00 00 00 00             # blue gamma
            00 00 00 00             # intent
            00 00 00 00             # profile data
            00 00 00 00             # profile size
            00 00 00 00             # reserved
        )
    fi
}


# add_row thickness &#34;b g r a&#34;
add_row() {
    thickness=$1
    for ((i = 0; i &lt; thickness; i&#43;&#43;)); do
        for ((j = 0; j &lt; width; j&#43;&#43;)); do
            bmp&#43;=($2)
        done
    done
}

# add_pixel &#34;b g r a&#34;
add_pixel() {
    bmp&#43;=($1)
}

output_bmp() {
    bmp=(${bmp[@]/#/&#39;\x&#39;})
    local IFS=&#39;&#39;
    #echo -ne &#34;${bmp[*]}&#34; &gt;/tmp/mtop.bmp
    echo -ne &#34;${bmp[*]}&#34;
}

get_cpu_stats() {
    local IFS=$&#39;\n&#39;
    topdata=($(top -F -R -l2 -o cpu -n 5 -s 2 -stats pid,command,cpu))
    nlines=${#topdata[@]}
    histdata=($(tail -$((width - 1)) &#34;$HISTORY_FILE&#34;))

    IFS=$OLDIFS
    for ((i = nlines / 2; i &lt; nlines; i&#43;&#43;)); do
        line=(${topdata[$i]})
        word=${line[0]}
        if [ &#34;$word&#34; = Load ]; then
            loadstr=${topdata[$i]}
        elif [ &#34;$word&#34; = CPU ]; then
            cpustr=${line[*]}
            histdata&#43;=(&#34;${line[2]/&#39;%&#39;/} ${line[4]/&#39;%&#39;/} ${line[6]/&#39;%&#39;/}&#34;)
        elif [ &#34;$word&#34; = PID ]; then
            top5=(&#34;${topdata[@]:$i}&#34;)
        fi
    done

    IFS=$&#39;\n&#39;
    echo &#34;${histdata[*]}&#34; &gt;&#34;$HISTORY_FILE&#34;
}

render_graph() {
    start=$((width - ${#histdata[@]}))

    heights=()
    for ((i = 0; i &lt; ${#histdata[@]}; i&#43;&#43;)); do
        comps=(${histdata[$i]})
        heights[$i]=$(((100 - $(printf &#34;%.0f&#34; &#34;${comps[2]}&#34;)) * (height - border_height) / 100))
    done 

    for ((i = 0; i &lt; $((height - border_height)); i&#43;&#43;)); do
        h=0
        for ((j = 0; j &lt; width; j&#43;&#43;)); do
            if [ $j -lt $start ]; then
                add_pixel &#34;$background&#34;
            elif [ ${heights[$h]} -gt $i ]; then
                add_pixel &#34;$foreground&#34;
                h=$((h &#43; 1))
            else
                add_pixel &#34;$background&#34;
                h=$((h &#43; 1))
            fi
        done
    done
}

get_cpu_stats

make_bmp_header $bmp_ver
add_row 2 &#34;$border&#34;
render_graph
add_row 1 &#34;$border&#34;

echo -n &#34;| $icontype=&#34;
output_bmp | base64
echo &#34;---&#34;
echo &#34;$cpustr | refresh=true&#34;
echo &#34;$loadstr | refresh=true&#34;
echo &#34;---&#34;
top5=(&#34;${top5[@]/%/| font=Menlo}&#34;)
IFS=$&#39;\n&#39;
echo &#34;${top5[*]}&#34;
IFS=$OLDIFS
echo &#34;---&#34;
echo &#34;Open Activity Monitor | bash=&#39;$0&#39; param1=activity_monitor terminal=false&#34;
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						â€¢
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors â€¢ <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
