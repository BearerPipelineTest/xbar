{
	"plugin": {
		"files": [
			{
				"path": "Tools/BitBar/version.12h.rb",
				"filename": "version.12h.rb",
				"content": "#!/usr/bin/env ruby\n#\n# \u003cbitbar.title\u003eBitBar Version\u003c/bitbar.title\u003e\n# \u003cbitbar.version\u003ev0.2.0\u003c/bitbar.version\u003e\n# \u003cbitbar.author\u003eOlivier Tille\u003c/bitbar.author\u003e\n# \u003cbitbar.author.github\u003eoliviernt\u003c/bitbar.author.github\u003e\n# \u003cbitbar.image\u003ehttp://i.imgur.com/9BrFhSJ.png\u003c/bitbar.image\u003e\n# \u003cbitbar.desc\u003eChecks the current BitBar version against the latest from GitHub\u003c/bitbar.desc\u003e\n# \u003cbitbar.dependencies\u003eRuby\u003c/bitbar.dependencies\u003e\n#\n# BitBar version plugin\n# by Olivier Tille (@oliviernt)\n#\n# Checks the current BitBar version against the latest from GitHub\n\nrequire 'net/http'\nrequire 'json'\nrequire 'nokogiri'\n\n# if you're seeing errors saying you've reached the API request limit you will need to\n# create a new application at https://github.com/settings/developers and add client_id and client_secret here:\n# GITHUB_CLIENT_ID=\"\"\n# GITHUB_CLIENT_SECRET=\"\"\n#\n# then add the following query params to the github URL\n# ?client_id=#{GITHUB_CLIENT_ID}\u0026client_secret=#{GITHUB_CLIENT_SECRET}\n\ndef get_json\n  url = URI(\"https://api.github.com/repos/matryer/bitbar/releases/latest\")\n  json_result = nil\n  sleep_time = 0.5\n  sleep_until = 16 # sleep 5x (0,5 * 2 ^ 5 == 16)\n  while json_result.nil?\n    begin\n      json_result = JSON.parse(Net::HTTP.get(url))\n    rescue =\u003e e\n      sleep_time *= 2\n      if sleep_time \u003c sleep_until\n        sleep sleep_time\n      else\n        throw e\n      end\n    end\n  end\n  json_result\nend\n\ndef get_xml\n  bitbar_path = `osascript -e 'tell application \"System Events\" to POSIX path of (file of process \"BitBar\" as alias)'`.chomp\n  bitbar_path += \"/Contents/Info.plist\"\n  File.open(bitbar_path) { |f| Nokogiri::XML(f) }\nend\n\ndef get_current_version(xml)\n  current_version = \"0.0.0\"\n  xml.search(\"//key\").each do |node|\n    if (node.content.eql?\"CFBundleVersion\")\n      current_version = node.next_element.content\n    end\n  end\n  current_version\nend\n\nbegin\n  json_val = get_json\n  current_version = get_current_version(get_xml)\n  latest_version = json_val[\"tag_name\"]\n  outdated = Gem::Version.new(current_version) \u003c Gem::Version.new(latest_version.sub!(\"v\", \"\"))\n  color = outdated ? \"red\" : \"green\"\n\n  puts current_version + \" | color=\" + color\n\n  if outdated\n    puts \"---\"\n    puts \"Download latest (#{latest_version}) | href=\" + json_val[\"assets\"][0][\"browser_download_url\"]\n  end\nrescue =\u003e _\n  puts \"BitBar Version Error | color=red\"\n  puts \"---\"\n  puts \"Content is currently unavailable. Please try resetting or check your internet connection. | color=red\"\nend\n"
			}
		],
		"path": "Tools/BitBar/version.12h.rb",
		"filename": "version.12h.rb",
		"dir": "Tools/BitBar",
		"docsPlugin": "Tools/BitBar/version.12h.rb.html",
		"docsCategory": "Tools/BitBar.html",
		"pathSegments": [
			"Tools",
			"BitBar"
		],
		"categoryPathSegments": [
			{
				"path": "Tools",
				"text": "Tools",
				"isLast": false
			},
			{
				"path": "Tools/BitBar",
				"text": "BitBar",
				"isLast": true
			}
		],
		"title": "BitBar Version",
		"version": "v0.2.0",
		"author": "Olivier Tille",
		"authors": [
			{
				"name": "Olivier Tille",
				"githubUsername": "oliviernt",
				"imageURL": "https://avatars.githubusercontent.com/u/162120?v=4",
				"bio": "Software Developer at @lexoffice, Loving the WWW. \r\nPGP: https://keybase.io/oliviernt ",
				"primary": true
			}
		],
		"desc": "Checks the current BitBar version against the latest from GitHub",
		"imageURL": "http://i.imgur.com/9BrFhSJ.png",
		"dependencies": [
			"Ruby"
		],
		"aboutURL": "",
		"lastUpdated": "2021-03-08T15:22:06.960528Z",
		"vars": null
	}
}