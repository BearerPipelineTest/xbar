
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>Yahoo Weather in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='It tells you the current weather condition of the location where your computer is located at.  It knows the location of the computer by using its public IP.  You can also manually set the city and region through modifying the file.  - install xbar for free to get started.'>
	<meta name='author' content='mgjo5899'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='https://i.imgur.com/YNypf0P.jpg'>
	<meta itemprop='name' content='Yahoo Weather in your macOS menu bar'>
	<meta itemprop='description' content='It tells you the current weather condition of the location where your computer is located at.  It knows the location of the computer by using its public IP.  You can also manually set the city and region through modifying the file.  - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='Yahoo Weather in your macOS menu bar'>
	<meta name='twitter:description' content='It tells you the current weather condition of the location where your computer is located at.  It knows the location of the computer by using its public IP.  You can also manually set the city and region through modifying the file.  - install xbar for free to get started.'>
	<meta name='twitter:image' content='https://i.imgur.com/YNypf0P.jpg'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='Yahoo Weather in your macOS menu bar'>
	<meta property='og:description' content='It tells you the current weather condition of the location where your computer is located at.  It knows the location of the computer by using its public IP.  You can also manually set the city and region through modifying the file.  - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Weather/yahoo-weather.5m.py.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='https://i.imgur.com/YNypf0P.jpg'>
	<link rel='apple-touch-icon' sizes='180x180' href='https://i.imgur.com/YNypf0P.jpg'>
	<link rel='icon' type='image/png' sizes='32x32' href='https://i.imgur.com/YNypf0P.jpg'>
	<link rel='shortcut icon' href='https://i.imgur.com/YNypf0P.jpg'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>ðŸ’œ</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>Yahoo Weather</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/mgjo5899.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/17048946?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/mgjo5899.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Joseph (<code style='color:white;'>@mgjo5899</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						It tells you the current weather condition of the location where your computer is located at.  It knows the location of the computer by using its public IP.  You can also manually set the city and region through modifying the file. 
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Weather%2fyahoo-weather.5m.py'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>ðŸ–¥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='https://i.imgur.com/YNypf0P.jpg' 
				alt='Image preview of Yahoo Weather plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>yahoo-weather.5m.py</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Weather/yahoo-weather.5m.py'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Weather/yahoo-weather.5m.py'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/env LC_ALL=en_US.UTF-8 /usr/local/bin/python3
#
# &lt;bitbar.title&gt;Yahoo Weather&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v3.0&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;mgjo5899&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;mgjo5899&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;It tells you the current weather condition of the location where your computer is located at.  It knows the location of the computer by using its public IP.  You can also manually set the city and region through modifying the file. &lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;https://i.imgur.com/YNypf0P.jpg&lt;/bitbar.image&gt;
# &lt;bitbar.dependencies&gt;python&lt;/bitbar.dependencies&gt;
#
# by mgjo5899

import json, uuid, time, hmac, hashlib

from base64 import b64encode
from urllib.request import urlopen, Request
from urllib.parse import urlencode, quote

# Change unit to &#39;c&#39; for celsius and &#39;f&#39; for fahrenheit
unit = &#39;c&#39;

# General Placeholders
url = &#39;https://weather-ydn-yql.media.yahoo.com/forecastrss&#39;
method = &#39;GET&#39;
concat = &#39;&amp;&#39;

# Credentials
app_id = &#39;f776QQ32&#39;
consumer_key = &#39;dj0yJmk9RlJhbUVpUEpsSUxEJmQ9WVdrOVpqYzNObEZSTXpJbWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmc3Y9MCZ4PTk0&#39;
consumer_secret = &#39;75c592717d22c5cce623d2c2a1d5a5b36786d865&#39;

# Query and authentication related
query = {&#39;location&#39;: &#39;seoul,korea&#39;, &#39;format&#39;: &#39;json&#39;, &#39;u&#39;: unit}
oauth = {
    &#39;oauth_consumer_key&#39;: consumer_key,
    &#39;oauth_nonce&#39;: uuid.uuid4().hex,
    &#39;oauth_signature_method&#39;: &#39;HMAC-SHA1&#39;,
    &#39;oauth_timestamp&#39;: str(int(time.time())),
    &#39;oauth_version&#39;: &#39;1.0&#39;
}


# Error handling decorator
def exception_handler(msg=&#34;Something is wrong&#34;):
    def decorator(func):
        def new_func(*args, **kwargs):
            try:
                return func(*args, **kwargs)
            except:
                print(f&#34;Error: {msg}&#34;)
                exit(1)
        return new_func
    return decorator


@exception_handler(msg=&#34;Location service&#34;)
def get_location_using_ip():
    service_endpoint = &#39;http://ip-api.com/json&#39;
    r = urlopen(service_endpoint).read()
    j = json.loads(r)
    city = j[&#39;city&#39;]
    region = j[&#39;region&#39;]

    return f&#34;{city},{region}&#34;


def get_auth_header():
    global oauth
    merged_params = query.copy()
    merged_params.update(oauth)
    sorted_params = [k &#43; &#39;=&#39; &#43; quote(merged_params[k], safe=&#39;&#39;) for k in sorted(merged_params.keys())]
    signature_base_str =  method &#43; concat &#43; quote(url, safe=&#39;&#39;) &#43; concat &#43; quote(concat.join(sorted_params))
    composite_key = quote(consumer_secret, safe=&#39;&#39;) &#43; concat
    oauth_signature = b64encode(hmac.new(composite_key.encode(), msg=signature_base_str.encode(), digestmod=hashlib.sha1).digest()).decode()
    oauth[&#39;oauth_signature&#39;] = oauth_signature
    auth_header = &#39;OAuth &#39; &#43; &#39;, &#39;.join([&#39;{}=&#34;{}&#34;&#39;.format(k,v) for k,v in oauth.items()])

    return auth_header


@exception_handler(msg=&#34;Yahoo Weather API&#34;)
def get_weather(auth_header):
    request_url = url &#43; &#39;?&#39; &#43; urlencode(query)
    request = Request(request_url)
    request.add_header(&#39;Authorization&#39;, auth_header)
    request.add_header(&#39;X-Yahoo-App-Id&#39;, app_id)
    r = urlopen(request).read()
    j = json.loads(r)
    condition_data = j[&#39;current_observation&#39;][&#39;condition&#39;]
    condition = condition_data[&#39;text&#39;]
    temperature = condition_data[&#39;temperature&#39;]

    return (condition, temperature)

location = get_location_using_ip()
query[&#39;location&#39;] = location
auth_header = get_auth_header()
condition, temperature = get_weather(auth_header)

if unit == &#39;c&#39;:
  print(str(condition) &#43; &#39; : &#39; &#43; str(int(temperature)) &#43; &#39;Â°C&#39;)
elif unit == &#39;f&#39;:
  print(str(condition) &#43; &#39; : &#39; &#43; str(int(temperature)) &#43; &#39;Â°F&#39;)
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						â€¢
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors â€¢ <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
